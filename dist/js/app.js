!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=4)}([function(module,exports,__webpack_require__){var require,require;!function(e){module.exports=e()}(function(){var define,module,exports;return function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return require(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(require,module,exports){!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.LivelyAuthClient=t():e.LivelyAuthClient=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(1),u=n(2),c=r(u),h=n(3),d=r(h),f=n(43),p=r(f),v=n(46),y=r(v),m=n(47),b=r(m),_=n(48),g=r(_),w=n(49),E=r(w),k=n(50),O=r(k),P=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(!e)throw new Error("chat configuration is required");if(!e.room)throw new Error("chat room is required");if(!e.apiHost)throw new Error("chat REST API server host is required");if(0!==e.apiHost.indexOf("https://")&&0!==e.apiHost.indexOf("http://")&&0!==e.apiHost.indexOf("//"))throw new Error("chat REST API server host must start with ws://, wss:// or //");if(!e.websocketHost)throw new Error("chat websocket server host is required");var s=null;if(0===e.websocketHost.indexOf("wss://"))s=!0;else if(0===e.websocketHost.indexOf("ws://"))s=!1;else if(0!==e.websocketHost.indexOf("//"))throw new Error("chat websocket server host must start with ws://, wss:// or //");var a=e.apiHost+"/chat/v1/rooms/"+e.room+"/command",l=e.apiHost+"/chat/v1/manifests/say/rooms/"+e.room+"/version",u=e.websocketHost+"/chat/ws/v1/rooms/"+e.room,h="/chat/http/v1/rooms/"+e.room;if(r._rosterUrl=e.apiHost+"/chat/v1/rooms/"+e.room+"/roster",r._changeroleUrl=e.apiHost+"/chat/v1/rooms/"+e.room+"/changeroles",r._routeStart=e.apiHost+"/chat/v1",n){if(!n.url)throw new Error("authorization configuration url is required");r._auth=new c.default("chat",n.url,n.options)}var f=new b.default(l);if(r._parser=f,r._auth&&(r._http=new O.default(r._auth),r._command=new y.default(r._auth,a)),window.WebSocket)r._socketInterface=new d.default(u,r._auth);else{var v="";v=s===!0?"https://"+e.websocketHost.slice(6)+h:s===!1?"http://"+e.websocketHost.slice(5)+h:""+e.websocketHost+h,r._socketInterface=new p.default(v,r._auth)}return r._socketInterface.on("error",function(e){r.emit("error",e)}),r._socketInterface.on("ready",function(){r.emit("ready")}),r._historyEmitted=!1,r._socketInterface.on("unauthorized",function(){if(r._historyEmitted)return void r.emit("me",null);var e=function(){r.emit("me",null)},t=window.setTimeout(function(){e(),e=null},3e3);r.once("history",function(){e&&e(),window.clearTimeout(t)})}),r._socketInterface.on("disconnect",function(){r._historyEmitted=!1,r.emit("disconnect")}),r._socketInterface.on("message",function(e){f.parseMessage(e,r._emitCommand.bind(r))}),r._sayDedupe=[],r._me=null,r._room=null,r}return s(t,e),a(t,[{key:"getDefaultAvatars",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/avatars",e)}},{key:"setDefaultUserAvatar",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execPatch(this._routeStart+"/users/"+e+"/avatar",{default:t},n)}},{key:"getUserEmoticons",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/users/"+e+"/emoticons",t)}},{key:"getAllEmoticons",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/rooms/"+e+"/users/"+t+"/emoticons/all",n)}},{key:"postUserEmoticon",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execPost(this._routeStart+"/users/"+e+"/emoticons",t,n)}},{key:"deleteUserEmoticon",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execDelete(this._routeStart+"/users/"+e+"/emoticons/"+t,n)}},{key:"getUserAvatar",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/users/"+e+"/avatar",t)}},{key:"putUserAvatar",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execPut(this._routeStart+"/users/"+e+"/avatar",t,n)}},{key:"getUser",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/users/"+e,t)}},{key:"patchUser",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execPatch(this._routeStart+"/users/"+e,t,n)}},{key:"getRoomUser",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/rooms/"+e+"/users/"+t,n)}},{key:"patchRoomUser",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};this._httpCheckAuth(),this._http.execPatch(this._routeStart+"/rooms/"+e+"/users/"+t,n,r)}},{key:"getRoom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/rooms/"+e,t)}},{key:"patchRoom",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execPatch(this._routeStart+"/rooms/"+e,t,n)}},{key:"getChangeroles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._auth)throw new Error("Changeroles calls require authentication");var t=Object.assign({},{limit:100,role:""},e);return new E.default(this._auth,this._changeroleUrl,t)}},{key:"getRoster",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},{limit:100,role:""},e);return new g.default(this._rosterUrl,t)}},{key:"command",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(!this._auth)throw new Error("Command calls require authentication");this._command.run(e,function(e,r){if(e)return void n(e);for(var i=r.length-1;i>=0;i--)r[i].data&&r[i].data&&r[i].data.command&&(t._parser.parseMessage(r[i].data.command,t._emitCommand.bind(t)),r.splice(0,1));n(null,r)})}},{key:"destroy",value:function(){this._auth.destroy(),this._socketInterface.destroy()}},{key:"_emitCommand",value:function(e,t,n){if(e)return void this.emit("error",e);switch(t){case"SAY":this._emitSay(n);break;case"ME":this._me=n,this.emit("me",n);break;case"ROOM":this._room=n,this.emit("room",n);break;case"MESSAGE":this.emit("message",n);break;case"HISTORY":this.emit("history",n),this._historyEmitted=!0;break;case"DELETE":this.emit("delete",n)}}},{key:"_emitSay",value:function(e){for(var t=this._sayDedupe.length-1;t>=0;t--)if(this._sayDedupe[t]===e.id)return;this._me&&this._me.ignore&&-1!==this._me.ignore.indexOf(e.actor.id)&&(e.ignore=!0),this._sayDedupe.length>50&&this._sayDedupe.splice(0,1),this._sayDedupe.push(e.id),this.emit("chat",e)}},{key:"_httpCheckAuth",value:function(){if(!this._auth)throw new Error("Http calls require authentication")}}]),t}(l.EventEmitter);t.default=P},function(e){function t(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function r(e){return"number"==typeof e}function i(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=t,t.EventEmitter=t,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.prototype.setMaxListeners=function(e){if(!(!r(e)||0>e||isNaN(e)))return this._maxListeners=e,this},t.prototype.emit=function(e){var t,r,s,a,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(r=this._events[e],o(r))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),r.apply(this,a)}else if(i(r))for(a=Array.prototype.slice.call(arguments,1),u=r.slice(),s=u.length,l=0;s>l;l++)u[l].apply(this,a);return!0},t.prototype.addListener=function(e,r){var s;if(n(r))return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(r.listener)?r.listener:r),this._events[e]?i(this._events[e])?this._events[e].push(r):this._events[e]=[this._events[e],r]:this._events[e]=r,i(this._events[e])&&!this._events[e].warned&&(s=o(this._maxListeners)?t.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){function r(){this.removeListener(e,r),i||(i=!0,t.apply(this,arguments))}if(n(t)){var i=!1;return r.listener=t,this.on(e,r),this}},t.prototype.removeListener=function(e,t){var r,o,s,a;if(n(t)){if(!this._events||!this._events[e])return this;if(r=this._events[e],s=r.length,o=-1,r===t||n(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(r)){for(a=s;a-- >0;)if(r[a]===t||r[a].listener&&r[a].listener===t){o=a;break}if(0>o)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this}},t.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],n(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},t.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},t.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},t.listenerCount=function(e,t){return e.listenerCount(t)}},function(module,exports,__webpack_require__){!function(e,t){module.exports=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(module,exports,__webpack_require__){eval("'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _events = __webpack_require__(1);\n\n__webpack_require__(2);\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { return;(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { return;(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { return;(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar defaultOptions = {\n\ttimeout: 5000,\n\theaders: {}\n};\n\nvar defaultHeaders = {\n\tAccept: 'application/json'\n};\n\n/**\n * @class Lively Video authorization client\n */\n\nvar Authorization = function (_EventEmitter) {\n\t_inherits(Authorization, _EventEmitter);\n\n\t/**\n  * @constructs Authorization\n  * @param {string} scope - Scope of the authorization\n  * @param {string} url - Url of your company's authorization endpoint. The expected response is {'token': 'unique token', 'expire': 'RFC3339 expiration time'}\n  * @param {Config} [options] - Configurable options for the Authorization class\n  * @param {string} [options.timeout=5000] - Authenticated request timeout in milliseconds. Timed out errors will return an Error('authorization: timeout')\n  * @param {Object} [options.headers] - Additional headers to use for the request\n  * @throws Will throw an error if no scope or no url is provided\n  */\n\tfunction Authorization(scope, url) {\n\t\tvar options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n\t\t_classCallCheck(this, Authorization);\n\n\t\tvar _this = _possibleConstructorReturn(this, (Authorization.__proto__ || Object.getPrototypeOf(Authorization)).call(this));\n\n\t\tif (!scope) {\n\t\t\tthrow new Error('scope is required');\n\t\t}\n\n\t\tif (!url) {\n\t\t\tthrow new Error('authorization server url is required');\n\t\t}\n\n\t\t// require parameters\n\t\t_this._options = Object.assign({}, defaultOptions, options);\n\n\t\tif (url.indexOf('?') === -1) {\n\t\t\t_this._url = url + '?scope=' + scope;\n\t\t} else {\n\t\t\t_this._url = url + '&scope=' + scope;\n\t\t}\n\n\t\t// internal\n\t\t_this._stopped = false;\n\t\t_this._fatalError = null;\n\t\t_this._token = null;\n\t\t_this._retries = [0, // immediate\n\t\t200, // 200ms\n\t\t1000, // 1s\n\t\t3000 // 3s\n\t\t];\n\t\t_this._retry = 0;\n\t\t_this._autorefresh = null;\n\n\t\t_this._headers = Object.assign({}, defaultHeaders, options.headers);\n\t\t_this._retryRequest();\n\t\treturn _this;\n\t}\n\n\t_createClass(Authorization, [{\n\t\tkey: 'destroy',\n\t\tvalue: function destroy() {\n\t\t\tthis._stopped = true;\n\t\t}\n\n\t\t/**\n   * This callback will execute a request which requires the auth token.\n   * @callback cbRequest\n   * @param {Error} e - Returns a timeout error (Error('authorization: timeout')) or a fatal error\n   * @param {string} token - The authorization bearer token to use in Lively Video API requests\n   */\n\n\t\t/**\n   * Execute a request which requires an authorization token when the token is available\n   * @param {cbRequest} cb - The callback that executes the request.\n   */\n\n\t}, {\n\t\tkey: 'request',\n\t\tvalue: function request() {\n\t\t\tvar _this2 = this;\n\n\t\t\tvar cb = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function () {};\n\n\t\t\tif (this._fatalError) {\n\t\t\t\tcb(this._fatalError);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._token !== null) {\n\t\t\t\tcb(null, this._token);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar done = false;\n\t\t\tvar pass = function pass() {\n\t\t\t\tif (!done) {\n\t\t\t\t\tdone = true;\n\t\t\t\t\tcb(null, _this2._token);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tvar timeout = function timeout() {\n\t\t\t\tif (!done) {\n\t\t\t\t\tdone = true;\n\t\t\t\t\tcb(new Error('authorization: timeout'));\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tvar t = setTimeout(function () {\n\t\t\t\t_this2.removeListener('ready', pass);\n\t\t\t\ttimeout();\n\t\t\t}, this._options.timeout);\n\n\t\t\tthis.once('ready', function () {\n\t\t\t\tclearTimeout(t);\n\t\t\t\tpass();\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Should be called if a Lively Video endpoint returned an 401 error. A new request will be issued to the authorization server's endpoint to get a new token.\n   */\n\n\t}, {\n\t\tkey: 'refreshToken',\n\t\tvalue: function refreshToken() {\n\t\t\tvar _this3 = this;\n\n\t\t\tif (this._token !== null) {\n\t\t\t\tif (this._autorefresh !== null) {\n\t\t\t\t\tclearTimeout(this._autorefresh);\n\t\t\t\t\tthis._autorefresh = null;\n\t\t\t\t}\n\t\t\t\tthis._token = null;\n\t\t\t\t(function () {\n\t\t\t\t\t_this3._retryRequest();\n\t\t\t\t})();\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Make a request or retry after the current retry number's delay\n   * @ignore\n   */\n\n\t}, {\n\t\tkey: '_retryRequest',\n\t\tvalue: function _retryRequest() {\n\t\t\tvar _this4 = this;\n\n\t\t\tvar retry = this._retries[this._retry];\n\t\t\tif (retry) {\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t_this4._makeRequest();\n\t\t\t\t}, retry);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._makeRequest();\n\t\t}\n\n\t\t/**\n   * Make a request to the authorization server.\n   * @ignore\n   */\n\n\t}, {\n\t\tkey: '_makeRequest',\n\t\tvalue: function _makeRequest() {\n\t\t\tvar _this5 = this;\n\n\t\t\tfetch(this._url, {\n\t\t\t\tcredentials: 'same-origin',\n\t\t\t\theaders: this._headers\n\t\t\t}).then(function (response) {\n\t\t\t\tif (response.status >= 200 && response.status < 300) {\n\t\t\t\t\treturn response.json();\n\t\t\t\t}\n\t\t\t\tif (response.status === 401) {\n\t\t\t\t\tvar e = new Error('authorization: unauthorized');\n\t\t\t\t\te.fatal = true;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t\tif (response.status === 403) {\n\t\t\t\t\tvar _e = new Error('authorization: forbidden');\n\t\t\t\t\t_e.fatal = true;\n\t\t\t\t\tthrow _e;\n\t\t\t\t}\n\t\t\t\tthrow new Error('authorization: non-200 response code from auth server');\n\t\t\t}).then(function (json) {\n\t\t\t\t_this5._token = json.token;\n\t\t\t\t_this5._retry = 0;\n\t\t\t\t_this5.emit('ready', {\n\t\t\t\t\ttoken: json.token\n\t\t\t\t});\n\n\t\t\t\t// re-request a minute before expiration\n\t\t\t\tvar retryAfter = new Date(json.expire).getTime() - Date.now() - 60 * 1000;\n\t\t\t\t_this5._autorefresh = setTimeout(function () {\n\t\t\t\t\t_this5._autorefresh = null;\n\t\t\t\t\tif (!_this5._stopped) {\n\t\t\t\t\t\t_this5._retryRequest();\n\t\t\t\t\t}\n\t\t\t\t}, retryAfter);\n\t\t\t}).catch(function (e) {\n\t\t\t\t_this5._token = null;\n\n\t\t\t\tif (e.fatal) {\n\t\t\t\t\t_this5._fatalError = e;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t_this5._retryRequest();\n\t\t\t\tif (_this5._retry < _this5._retries.length - 1) {\n\t\t\t\t\t_this5._retry++;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}]);\n\n\treturn Authorization;\n}(_events.EventEmitter);\n\nexports.default = Authorization;\nmodule.exports = exports['default'];\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/index.js\n// module id = 0\n// module chunks = 0\n//# sourceURL=webpack:///./src/index.js?")},function(module,exports){eval("// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    return;('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    return;('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    return;('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    return;('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/events/events.js\n// module id = 1\n// module chunks = 0\n//# sourceURL=webpack:///./~/events/events.js?")},function(module,exports){eval("(function(self) {\n  'use strict';\n\n  if (self.fetch) {\n    return\n  }\n\n  var support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob: 'FileReader' in self && 'Blob' in self && (function() {\n      try {\n        new Blob()\n        return true\n      } catch(e) {\n        return false\n      }\n    })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name)\n    }\n    if (/[^a-z0-9\\-#$%&'*+.\\^_`|~]/i.test(name)) {\n      return;('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value)\n    }\n    return value\n  }\n\n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function() {\n        var value = items.shift()\n        return {done: value === undefined, value: value}\n      }\n    }\n\n    if (support.iterable) {\n      iterator[Symbol.iterator] = function() {\n        return iterator\n      }\n    }\n\n    return iterator\n  }\n\n  function Headers(headers) {\n    this.map = {}\n\n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value)\n      }, this)\n\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name])\n      }, this)\n    }\n  }\n\n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name)\n    value = normalizeValue(value)\n    var list = this.map[name]\n    if (!list) {\n      list = []\n      this.map[name] = list\n    }\n    list.push(value)\n  }\n\n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)]\n  }\n\n  Headers.prototype.get = function(name) {\n    var values = this.map[normalizeName(name)]\n    return values ? values[0] : null\n  }\n\n  Headers.prototype.getAll = function(name) {\n    return this.map[normalizeName(name)] || []\n  }\n\n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  }\n\n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = [normalizeValue(value)]\n  }\n\n  Headers.prototype.forEach = function(callback, thisArg) {\n    Object.getOwnPropertyNames(this.map).forEach(function(name) {\n      this.map[name].forEach(function(value) {\n        callback.call(thisArg, value, name, this)\n      }, this)\n    }, this)\n  }\n\n  Headers.prototype.keys = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push(name) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.values = function() {\n    var items = []\n    this.forEach(function(value) { items.push(value) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.entries = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push([name, value]) })\n    return iteratorFor(items)\n  }\n\n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result)\n      }\n      reader.onerror = function() {\n        reject(reader.error)\n      }\n    })\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader()\n    reader.readAsArrayBuffer(blob)\n    return fileReaderReady(reader)\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader()\n    reader.readAsText(blob)\n    return fileReaderReady(reader)\n  }\n\n  function Body() {\n    this.bodyUsed = false\n\n    this._initBody = function(body) {\n      this._bodyInit = body\n      if (typeof body === 'string') {\n        this._bodyText = body\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString()\n      } else if (!body) {\n        this._bodyText = ''\n      } else if (support.arrayBuffer && ArrayBuffer.prototype.isPrototypeOf(body)) {\n        // Only support ArrayBuffers for POST method.\n        // Receiving ArrayBuffers happens via Blobs, instead.\n      } else {\n        throw new Error('unsupported BodyInit type')\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8')\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type)\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8')\n        }\n      }\n    }\n\n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      }\n\n      this.arrayBuffer = function() {\n        return this.blob().then(readBlobAsArrayBuffer)\n      }\n\n      this.text = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return readBlobAsText(this._bodyBlob)\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as text')\n        } else {\n          return Promise.resolve(this._bodyText)\n        }\n      }\n    } else {\n      this.text = function() {\n        var rejected = consumed(this)\n        return rejected ? rejected : Promise.resolve(this._bodyText)\n      }\n    }\n\n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      }\n    }\n\n    this.json = function() {\n      return this.text().then(JSON.parse)\n    }\n\n    return this\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT']\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase()\n    return (methods.indexOf(upcased) > -1) ? upcased : method\n  }\n\n  function Request(input, options) {\n    options = options || {}\n    var body = options.body\n    if (Request.prototype.isPrototypeOf(input)) {\n      if (input.bodyUsed) {\n        return;('Already read')\n      }\n      this.url = input.url\n      this.credentials = input.credentials\n      if (!options.headers) {\n        this.headers = new Headers(input.headers)\n      }\n      this.method = input.method\n      this.mode = input.mode\n      if (!body) {\n        body = input._bodyInit\n        input.bodyUsed = true\n      }\n    } else {\n      this.url = input\n    }\n\n    this.credentials = options.credentials || this.credentials || 'omit'\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers)\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET')\n    this.mode = options.mode || this.mode || null\n    this.referrer = null\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      return;('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body)\n  }\n\n  Request.prototype.clone = function() {\n    return new Request(this)\n  }\n\n  function decode(body) {\n    var form = new FormData()\n    body.trim().split('&').forEach(function(bytes) {\n      if (bytes) {\n        var split = bytes.split('=')\n        var name = split.shift().replace(/\\+/g, ' ')\n        var value = split.join('=').replace(/\\+/g, ' ')\n        form.append(decodeURIComponent(name), decodeURIComponent(value))\n      }\n    })\n    return form\n  }\n\n  function headers(xhr) {\n    var head = new Headers()\n    var pairs = (xhr.getAllResponseHeaders() || '').trim().split('\\n')\n    pairs.forEach(function(header) {\n      var split = header.trim().split(':')\n      var key = split.shift().trim()\n      var value = split.join(':').trim()\n      head.append(key, value)\n    })\n    return head\n  }\n\n  Body.call(Request.prototype)\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {}\n    }\n\n    this.type = 'default'\n    this.status = options.status\n    this.ok = this.status >= 200 && this.status < 300\n    this.statusText = options.statusText\n    this.headers = options.headers instanceof Headers ? options.headers : new Headers(options.headers)\n    this.url = options.url || ''\n    this._initBody(bodyInit)\n  }\n\n  Body.call(Response.prototype)\n\n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  }\n\n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''})\n    response.type = 'error'\n    return response\n  }\n\n  var redirectStatuses = [301, 302, 303, 307, 308]\n\n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      return;('Invalid status code')\n    }\n\n    return new Response(null, {status: status, headers: {location: url}})\n  }\n\n  self.Headers = Headers\n  self.Request = Request\n  self.Response = Response\n\n  self.fetch = function(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request\n      if (Request.prototype.isPrototypeOf(input) && !init) {\n        request = input\n      } else {\n        request = new Request(input, init)\n      }\n\n      var xhr = new XMLHttpRequest()\n\n      function responseURL() {\n        if ('responseURL' in xhr) {\n          return xhr.responseURL\n        }\n\n        // Avoid security warnings on getResponseHeader when not allowed by CORS\n        if (/^X-Request-URL:/m.test(xhr.getAllResponseHeaders())) {\n          return xhr.getResponseHeader('X-Request-URL')\n        }\n\n        return\n      }\n\n      xhr.onload = function() {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: headers(xhr),\n          url: responseURL()\n        }\n        var body = 'response' in xhr ? xhr.response : xhr.responseText\n        resolve(new Response(body, options))\n      }\n\n      xhr.onerror = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.ontimeout = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.open(request.method, request.url, true)\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob'\n      }\n\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value)\n      })\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit)\n    })\n  }\n  self.fetch.polyfill = true\n})(typeof self !== 'undefined' ? self : this);\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/whatwg-fetch/fetch.js\n// module id = 2\n// module chunks = 0\n//# sourceURL=webpack:///./~/whatwg-fetch/fetch.js?")}])})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(4),u=r(l),c=n(1),h={MSG:"msg",FIN:"fin"},d={MSG:"msg",ERR:"err",FIN:"fin",ACK:"ack"},f={DEFAULT:"/",AUTH:"/auth"},p=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(!e)throw new Error("url is required for chat");return r._auth=n,r._socket=new u.default(e,"livelyWebsocket",{automaticOpen:!1,reconnectOnError:!0,reconnectOnCleanClose:!0,randomRatio:!1}),r._retries=[0,200,1e3,2e3],r._retry=0,r.ready=!1,r.authed=!1,r._socket.onopen=function(){r._auth&&r._authenticate()},r._socket.onclose=function(e){r.emit("disconnect"),r.ready=!1,r.authed=!1,1003===e.code&&(r._socket._options.reconnectOnCleanClose=!1,r._socket._options.reconnectOnError=!1,r._socket.close(),r.emit("error",new Error("Requested room does not exist")))},r._socket.onmessage=function(e){r._onmessage(e)},r._socket.open(),r}return s(t,e),a(t,[{key:"destroy",value:function(){this._socket._options.reconnectOnCleanClose=!1,this._socket._options.reconnectOnError=!1,this._socket.close()}},{key:"_authenticate",value:function(){var e=this;this._auth.request(function(t,n){return t?void e.emit("error",t):(e._send(e._socket,h.MSG,f.AUTH,n),void e.once("_authed",function(t){return t?void e.emit("unauthorized"):void 0}))})}},{key:"_send",value:function(e,t,n,r){if(e&&e.readyState===e.OPEN){var i=t+" "+n+" "+r;this._socket.send(i)}}},{key:"_onmessage",value:function(e){var t=e.data;if(t){var n=t.indexOf(" "),r=t.indexOf(" ",n+1),i=t.slice(0,n),o=t.slice(n+1,r),s=t.slice(r+1);if(i===d.MSG){var a=void 0;try{a=JSON.parse(s)}catch(e){return void this.emit("error",e)}return void this.emit("message",a)}return this.ready||i!==d.ACK||o!==f.DEFAULT||(this.emit("ready"),this.ready=!0,this._auth||this.emit("unauthorized")),this.authed||i!==d.FIN?i===d.ERR?void this.emit("error",new Error(s)):void 0:void(o===f.AUTH&&(this.emit("_authed"),this.authed=!0))}}}]),t}(c.EventEmitter);t.default=p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return Math.random()*(t-e)+e}Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),s=r(o),a=n(42),l=r(a),u={debug:!1,automaticOpen:!0,reconnectOnError:!1,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:null,randomRatio:3,binaryType:"blob",reconnectOnCleanClose:!1},c=function e(t){var n=this,r=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];l.default(this,e),this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.open=function(){var e=n._socket=new WebSocket(n._url,n._protocols);e.binaryType=n._options.binaryType,n._options.maxReconnectAttempts&&n._options.maxReconnectAttempts<n._reconnectAttempts||(n._syncState(),e.onmessage=n._onmessage.bind(n),e.onopen=n._onopen.bind(n),e.onclose=n._onclose.bind(n),e.onerror=n._onerror.bind(n))},this.send=function(e){n._socket&&n._socket.readyState===WebSocket.OPEN&&0===n._messageQueue.length?n._socket.send(e):n._messageQueue.push(e)},this.close=function(e,t){void 0===e&&(e=1e3),n._socket&&n._socket.close(e,t)},this._onmessage=function(e){n.onmessage&&n.onmessage(e)},this._onopen=function(e){n._syncState(),n._flushQueue(),n._reconnectAttempts=0,n.onopen&&n.onopen(e)},this._onclose=function(e){n._syncState(),n._debug("WebSocket: connection is broken",e),n.onclose&&n.onclose(e),n._tryReconnect(e)},this._onerror=function(e){n._socket.close(),n._debug("WebSocket: error",e),n.onerror&&n.onerror(e),n._options.reconnectOnError&&n._tryReconnect(e)},this._tryReconnect=function(e){(!e.wasClean||n._options.reconnectOnCleanClose)&&setTimeout(function(){(n.readyState===n.CLOSING||n.readyState===n.CLOSED)&&(n._reconnectAttempts++,n.open())},n._getTimeout())},this._flushQueue=function(){for(;0!==n._messageQueue.length;){var e=n._messageQueue.shift();n._socket.send(e)}},this._getTimeout=function(){var e=n._options.reconnectInterval*Math.pow(n._options.reconnectDecay,n._reconnectAttempts);return e=e>n._options.maxReconnectInterval?n._options.maxReconnectInterval:e,n._options.randomRatio?i(e/n._options.randomRatio,e):e},this._syncState=function(){n.readyState=n._socket.readyState},this._url=t,this._protocols=r,this._options=s.default({},u,o),this._messageQueue=[],this._reconnectAttempts=0,this.readyState=this.CONNECTING,this._debug="function"==typeof this._options.debug?this._options.debug:this._options.debug?console.log.bind(console):function(){},o.automaticOpen&&this.open()};t.default=c,e.exports=t.default},function(e,t,n){e.exports={default:n(6),__esModule:!0}},function(e,t,n){n(7),e.exports=n(10).Object.assign},function(e,t,n){var r=n(8);r(r.S+r.F,"Object",{assign:n(23)})},function(e,t,n){var r=n(9),i=n(10),o=n(11),s=n(13),a="prototype",l=function(e,t,n){var u,c,h,d=e&l.F,f=e&l.G,p=e&l.S,v=e&l.P,y=e&l.B,m=e&l.W,b=f?i:i[t]||(i[t]={}),_=b[a],g=f?r:p?r[t]:(r[t]||{})[a];f&&(n=t);for(u in n)(c=!d&&g&&void 0!==g[u])&&u in b||(h=c?g[u]:n[u],b[u]=f&&"function"!=typeof g[u]?n[u]:y&&c?o(h,r):m&&g[u]==h?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t[a]=e[a],t}(h):v&&"function"==typeof h?o(Function.call,h):h,v&&((b.virtual||(b.virtual={}))[u]=h,e&l.R&&_&&!_[u]&&s(_,u,h)))};l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,e.exports=l},function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)},function(e){var t=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=t)},function(e,t,n){var r=n(12);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e){e.exports=function(e){if("function"==typeof e)return e}},function(e,t,n){var r=n(14),i=n(22);e.exports=n(18)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(15),i=n(17),o=n(21),s=Object.defineProperty;t.f=n(18)?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return s(e,t,n)}catch(e){}if(!("get"in n||"set"in n))return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var r=n(16);e.exports=function(e){if(r(e))return e}},function(e){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){e.exports=!n(18)&&!n(19)(function(){return 7!=Object.defineProperty(n(20)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){e.exports=!n(19)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){var r=n(16),i=n(9).document,o=r(i)&&r(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,n){var r=n(16);e.exports=function(e,t){if(!r(e))return e;var n,i;return t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e))?i:("function"!=typeof(n=e.valueOf)||r(i=n.call(e)))&&(t||"function"!=typeof(n=e.toString)||r(i=n.call(e)))?void 0:i}},function(e){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){"use strict";var r=n(24),i=n(39),o=n(40),s=n(41),a=n(28),l=Object.assign;e.exports=!l||n(19)(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=l({},e)[n]||Object.keys(l({},t)).join("")!=r})?function(e){for(var t=s(e),n=arguments.length,l=1,u=i.f,c=o.f;n>l;)for(var h,d=a(arguments[l++]),f=u?r(d).concat(u(d)):r(d),p=f.length,v=0;p>v;)c.call(d,h=f[v++])&&(t[h]=d[h]);return t}:l},function(e,t,n){var r=n(25),i=n(38);e.exports=Object.keys||function(e){return r(e,i)}},function(e,t,n){var r=n(26),i=n(27),o=n(31)(!1),s=n(35)("IE_PROTO");e.exports=function(e,t){var n,a=i(e),l=0,u=[];for(n in a)n!=s&&r(a,n)&&u.push(n);for(;t.length>l;)r(a,n=t[l++])&&(~o(u,n)||u.push(n));return u}},function(e){var t={}.hasOwnProperty;e.exports=function(e,n){return t.call(e,n)}},function(e,t,n){var r=n(28),i=n(30);e.exports=function(e){return r(i(e))}},function(e,t,n){var r=n(29);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e){var t={}.toString;e.exports=function(e){return t.call(e).slice(8,-1)}},function(e){e.exports=function(e){if(void 0!=e)return e}},function(e,t,n){var r=n(27),i=n(32),o=n(34);e.exports=function(e){return function(t,n,s){var a,l=r(t),u=i(l.length),c=o(s,u);if(e&&n!=n){for(;u>c;)if((a=l[c++])!=a)return!0}else for(;u>c;c++)if((e||c in l)&&l[c]===n)return e||c||0;return!e&&-1}}},function(e,t,n){var r=n(33),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e){var t=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:t)(e)}},function(e,t,n){var r=n(33),i=Math.max,o=Math.min;e.exports=function(e,t){return e=r(e),0>e?i(e+t,0):o(e,t)}},function(e,t,n){var r=n(36)("keys"),i=n(37);e.exports=function(e){return r[e]||(r[e]=i(e))}},function(e,t,n){var r=n(9),i="__core-js_shared__",o=r[i]||(r[i]={});e.exports=function(e){return o[e]||(o[e]={})}},function(e){var t=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++t+n).toString(36))}},function(e){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){var r=n(30);e.exports=function(e){return Object(r(e))}},function(e,t){"use strict";t.__esModule=!0,t.default=function(e,t){}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(44);var l=n(1),u=n(45),c=r(u),h=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(r._auth=n,!e)throw new Error("url is required for a command");return r._url=e,r._stopped=!0,r._connectionID=c.default(),r._isConnected=!1,r._retry=0,r._retries=[0,300,1e3],r._run(),r}return s(t,e),a(t,[{key:"destroy",value:function(){this._stopped=!0}},{key:"_retryRun",value:function(e){var t=this;return e?(this._retry=0,void this._run()):(this._retry<this._retries.length-1&&this._retry++,void setTimeout(function(){t._run()},this._retries[this._retry]))}},{key:"_run",value:function(){var e=this;return this._auth?void this._auth.request(function(t,n){return t?void e._disconnected(t):void e._request(n)}):void this._request()}},{key:"_request",value:function(e){var t=this,n={Accept:"application/json","Content-Type":"application/json"};e&&(n.Authorization="Bearer "+e),fetch(this._url+"?cid="+this._connectionID,{method:"GET",headers:n}).then(function(e){if(200===e.status)return e.json();if(401===e.status){t._auth.refreshToken();var n=new Error("chat: unauthorized");throw n.retry=!0,n}if(503===e.status){var r=new Error("chat: server unavailable");throw r.retry=!0,r}if(404===e.status)throw new Error("Room does not exist");if(403===e.status)throw t.emit("unauthorized"),new Error("chat: forbidden");if(409===e.status){t._connectionID=c.default();var i=new Error("chat: connection id conflict");throw i.ignore=!0,i.retry=!0,i}throw new Error("non 200 response")}).then(function(e){t._connected();for(var n=0;n<e.length;n++)t.emit("message",e[n]);t._stopped||t._retryRun(!0)}).catch(function(e){t._disconnected(e),e.retry&&(t._stopped||t._retryRun())})}},{key:"_disconnected",value:function(e){e&&(e.ignore||this.emit("error",e)),this._isConnected&&(this.emit("disconnect"),this._isConnected=!1)}},{key:"_connected",value:function(){this._isConnected||(this.emit("ready"),this._isConnected=!0)}}]),t}(l.EventEmitter);t.default=h},function(){!function(e){"use strict";function t(e){if("string"!=typeof e&&(e=String(e)),!/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))return e.toLowerCase()}function n(e){return"string"!=typeof e&&(e=String(e)),e}function r(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return v.iterable&&(t[Symbol.iterator]=function(){return t}),t}function i(e){this.map={},e instanceof i?e.forEach(function(e,t){this.append(t,e)},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function o(e){return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function s(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function a(e){var t=new FileReader;return t.readAsArrayBuffer(e),s(t)}function l(e){var t=new FileReader;return t.readAsText(e),s(t)}function u(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,"string"==typeof e)this._bodyText=e;else if(v.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(v.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(v.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(e){if(!v.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e))throw new Error("unsupported BodyInit type")}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):v.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},v.blob?(this.blob=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(a)},this.text=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return l(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var e=o(this);return e?e:Promise.resolve(this._bodyText)},v.formData&&(this.formData=function(){return this.text().then(d)}),this.json=function(){return this.text().then(JSON.parse)},this}function c(e){var t=e.toUpperCase();return y.indexOf(t)>-1?t:e}function h(e,t){t=t||{};var n=t.body;if(h.prototype.isPrototypeOf(e)){if(e.bodyUsed)return;this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new i(e.headers)),this.method=e.method,this.mode=e.mode,n||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=e;this.credentials=t.credentials||this.credentials||"omit",(t.headers||!this.headers)&&(this.headers=new i(t.headers)),this.method=c(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"!==this.method&&"HEAD"!==this.method||!n)&&this._initBody(n)}function d(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(i))}}),t}function f(e){var t=new i;return(e.getAllResponseHeaders()||"").trim().split("\n").forEach(function(e){var n=e.trim().split(":"),r=n.shift().trim(),i=n.join(":").trim();t.append(r,i)}),t}function p(e,t){t||(t={}),this.type="default",this.status=t.status,this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText,this.headers=t.headers instanceof i?t.headers:new i(t.headers),this.url=t.url||"",this._initBody(e)}if(!e.fetch){var v={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};i.prototype.append=function(e,r){e=t(e),r=n(r);var i=this.map[e];i||(i=[],this.map[e]=i),i.push(r)},i.prototype.delete=function(e){delete this.map[t(e)]},i.prototype.get=function(e){var n=this.map[t(e)];return n?n[0]:null},i.prototype.getAll=function(e){return this.map[t(e)]||[]},i.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},i.prototype.set=function(e,r){this.map[t(e)]=[n(r)]},i.prototype.forEach=function(e,t){Object.getOwnPropertyNames(this.map).forEach(function(n){this.map[n].forEach(function(r){e.call(t,r,n,this)},this)},this)},i.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),r(e)},i.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),r(e)},i.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),r(e)},v.iterable&&(i.prototype[Symbol.iterator]=i.prototype.entries);var y=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];h.prototype.clone=function(){return new h(this)},u.call(h.prototype),u.call(p.prototype),p.prototype.clone=function(){return new p(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new i(this.headers),url:this.url})},p.error=function(){var e=new p(null,{status:0,statusText:""});return e.type="error",e};var m=[301,302,303,307,308];p.redirect=function(e,t){if(-1!==m.indexOf(t))return new p(null,{status:t,headers:{location:e}})},e.Headers=i,e.Request=h,e.Response=p,e.fetch=function(e,t){return new Promise(function(n,r){function i(){return"responseURL"in s?s.responseURL:/^X-Request-URL:/m.test(s.getAllResponseHeaders())?s.getResponseHeader("X-Request-URL"):void 0}var o;o=h.prototype.isPrototypeOf(e)&&!t?e:new h(e,t);var s=new XMLHttpRequest;s.onload=function(){var e={status:s.status,statusText:s.statusText,headers:f(s),url:i()};n(new p("response"in s?s.response:s.responseText,e))},s.onerror=function(){r(new TypeError("Network request failed"))},s.ontimeout=function(){r(new TypeError("Network request failed"))},s.open(o.method,o.url,!0),"include"===o.credentials&&(s.withCredentials=!0),"responseType"in s&&v.blob&&(s.responseType="blob"),o.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),s.send(void 0===o._bodyInit?null:o._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:this)},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});for(var n=new Array(16),r=function(){for(var e,t=0;16>t;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n},i=function(e,t){var n=t||0,r=o;return r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]},o=[],s={},a=0;256>a;a++)o[a]=(a+256).toString(16).substr(1),s[o[a]]=a;var l=function(){var e=r();return e[6]=15&e[6]|64,e[8]=63&e[8]|128,i(e)};t.default=l},function(e,t,n){"use strict";function r(e,t){}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(44);var o=function(){function e(t,n){if(r(this,e),!t)throw new Error("auth is required for a command");if(this._auth=t,!n)throw new Error("url is required for a command");this._url=n,this._retries=[0,300,1e3]}return i(e,[{key:"run",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(!e)return void n(new Error("command is required for a command"));var r=-1;!function i(){t._auth.request(function(o,s){return o?void n(o):void fetch(t._url,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+s},body:JSON.stringify({command:e})}).then(function(e){if(e.status>=200&&e.status<300)return 204===e.status?null:e.json();if(401===e.status){t._auth.refreshToken();var n=new Error("chat: unauthorized");throw n.retry=!0,n}if(503===e.status){var r=new Error("chat: server unavailable");throw r.retry=!0,r}if(403===e.status)throw new Error("chat: forbidden");if(e.status>=400&&e.status<500)return e.json();throw new Error("chat: non-200 response code from chat server")}).then(function(e){return e&&e.messages?void n(null,e.messages):void n()}).catch(function(e){if(e.retry&&r<t._retries.length-1){r++;var o=t._retries[r];return o?void setTimeout(i,o):void i()}n(e)})})}()}}]),e}();t.default=o},function(e,t,n){"use strict";function r(e,t){}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(44);var o={INDEX:"index",TYPE:"type",NESTED_ITEMS:"nestedItems"},s={KEY:"key",VARS:"vars"},a={NESTED_DATA_ARRAY:"nestedDataArray",NESTED_ARRAY:"nestedArray",NESTED_OBJECT:"nestedObject",TEMPLATE:"template",INT_ARRAY:"intArray",STRING_ARRAY:"stringArray",STRING:"string",INT:"int",BOOL:"bool"},l={emoticons:"emoticon",links:"link",mentions:"mention",tags:"tag"},u=function(){function e(t){if(r(this,e),!t)throw new Error("url is required for parser");this._baseUrl=t,this._manifests={},this._buffer={},this._fetchingManifests={}}return i(e,[{key:"parseMessage",value:function(e,t){var n=this;e&&e instanceof Array&&!(e.length<2)||t(new Error("Invalid data format"));var r=e[0],i=e[1];this._parseMessage(r,i,function(e,i){return e?void t(e):("HISTORY"===r&&i.messages.length&&i.messages.forEach(function(e,t){n._parseMessage("SAY",e,function(e,n){e||(i.messages[t]=n)})}),void t(null,r,i))})}},{key:"_addManifest",value:function(e){this._manifests[e.version]=e}},{key:"_parseMessage",value:function(e,t,n){var r=this,i=t[0],o=void 0;return this._manifests[i]?this._manifests[i].manifests[e]?(o=this._parse(i,this._manifests[i].manifests[e],t),void n(null,o)):void n(new Error("manifest does not have "+e+" command")):(this._buffer[i]?this._buffer[i].push([t,e,n]):this._buffer[i]=[[t,e,n]],void(this._fetchingManifests[i]!==!0&&(this._fetchingManifests[i]=!0,fetch(this._baseUrl+"/"+i).then(function(e){if(200!==e.status)throw new Error("chat: non-200 response code from chat server");return e.json()}).then(function(e){for(r._addManifest(e);r._buffer[e.version].length>0;){var t=r._buffer[e.version].shift();o=r._parse(e.version,e.manifests[t[1]],t[0]),t[2](null,o)}}).catch(function(e){r._buffer[i]=[],n(e)}))))}},{key:"_parse",value:function(e,t,n){for(var r=this,i={},u=Object.keys(t),c=function(c){var h=u[c],d=t[h],f=n[d[o.INDEX]];if(null===f)return i[h]=null,"continue";var p=void 0;switch(d[o.TYPE]){case a.NESTED_ARRAY:p=[];for(var v=0;v<f.length;v++)p.push(r._parse(e,d[o.NESTED_ITEMS],f[v]));break;case a.NESTED_OBJECT:p=r._parse(e,d[o.NESTED_ITEMS],f);break;case a.TEMPLATE:p=r._parseTemplate(e,f[d[o.NESTED_ITEMS][s.KEY].index],f[d[o.NESTED_ITEMS][s.VARS].index]);break;default:p=f}p&&p instanceof Array&&p.forEach(function(e){var t=e;t.positions&&t.positions instanceof Array&&t.positions.forEach(function(e){l[h]&&(t.type=l[h],i.positions||(i.positions={}),i.positions[e]=t)})}),i[h]=p},h=0;h<u.length;h++)c(h);return i}},{key:"_parseTemplate",value:function(e,t,n){return new c(this._manifests[e].templates[t],n).getParsed()}}]),e}(),c=function(){function e(t,n){return r(this,e),this._parsed="",n&&0!==n.length?void(t&&0!==t.length&&(this._parsed="",this._varPos=0,this._curr="",this._template=t,this._templateLength=t.length,this._vars=n,this._next=this._startState.bind(this),this._pos=0,this._skipNext=!1)):void(this._parsed=t)}return i(e,[{key:"getParsed",value:function(){if(this._parsed)return this._parsed;for(var e=0;e<this._templateLength;e++)this._skipNext?this._skipNext=!1:(this._pos=e,this._curr=this._template[e],this._next=this._next().bind(this));return this._parsed}},{key:"_startDelim",value:function(){return!(this._pos>=this._templateLength-1||"{"!==this._curr||"{"!==this._template[this._pos+1]||(this._skipNext=!0,0))}},{key:"_endDelim",value:function(){return!(this._pos>=this._templateLength-1||"}"!==this._curr||"}"!==this._template[this._pos+1]||(this._skipNext=!0,0))}},{key:"_startState",value:function(){return this._startDelim()?this._midState:(this._parsed+=this._curr,this._startState)}},{key:"_midState",value:function(){return"n"===this._curr?this._endState:(this._parsed=this._parsed+"{{"+this._curr,this._startState)}},{key:"_endState",value:function(){return this._endDelim()?(this._parsed+=this._vars[this._varPos],this._varPos++):this._parsed+=this._curr,this._startState}}]),e}();t.default=u},function(e,t,n){"use strict";function r(e,t){}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(44);var o=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r(this,e),!t)throw new Error("url is required for a roster request");this._url=t,this._nextParams="",this._options=n,this._retries=[0,300,1e3]}return i(e,[{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=this._url+"?";this._options.limit&&(t=t+"limit="+this._options.limit+"&"),this._options.role&&(t=t+"role="+this._options.role+"&"),this._request(t,e)}},{key:"next",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(this._nextParams){var t=this._url+"?"+this._nextParams;return void this._request(t,e)}e(null,[])}},{key:"_request",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=-1;!function i(){fetch(e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){if(200===e.status)return e.json();if(503===e.status){var t=new Error("chat: server unavailable");throw t.retry=!0,t}if(403===e.status)throw new Error("chat: forbidden");throw new Error("chat: non-200 response code from chat server")}).then(function(e){t._nextParams=e&&e._links&&e._links.next&&e._links.next.href?e._links.next.href.split("?")[1]:"",n(null,e.users)}).catch(function(e){if(e.retry&&r<t._retries.length-1){r++;var o=t._retries[r];return o?void setTimeout(i,o):void i()}n(e)})}()}}]),e}();t.default=o},function(e,t,n){"use strict";function r(e,t){}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(44);var o=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(r(this,e),!t)throw new Error("auth is required for a changerole request");if(this._auth=t,!n)throw new Error("url is required for a changerole request");this._url=n,this._nextParams="",this._options=i,this._retries=[0,300,1e3]}return i(e,[{key:"get",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=this._url+"?";this._options.limit&&(t=t+"limit="+this._options.limit+"&"),this._request(t,e)}},{key:"next",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(this._nextParams){var t=this._url+"?"+this._nextParams;return void this._request(t,e)}e(null,[])}},{key:"_request",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=-1;!function i(){t._auth.request(function(o,s){return o?void n(o):void fetch(e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+s}}).then(function(e){if(200===e.status)return e.json();if(401===e.status){var t=new Error("chat: unauthorized");throw t.retry=!0,t}if(503===e.status){var n=new Error("chat: server unavailable");throw n.retry=!0,n}if(403===e.status)throw new Error("chat: forbidden");throw new Error("chat: non-200 response code from chat server")}).then(function(e){t._nextParams=e&&e._links&&e._links.next&&e._links.next.href?e._links.next.href.split("?")[1]:"",n(null,e.changeroles)}).catch(function(e){if(e.retry&&r<t._retries.length-1){r++;var o=t._retries[r];return o?void setTimeout(i,o):void i()}n(e)})})}()}}]),e}();t.default=o},function(e,t,n){"use strict";function r(e,t){}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(44);var o=function(){function e(t){if(r(this,e),!t)throw new Error("auth is required for an http request");this._auth=t,this._retries=[0,300,1e3]}return i(e,[{key:"execGet",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(!e)throw new Error("url is required for an http request");this._execute("GET",e,null,t)}},{key:"execPut",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(!e)throw new Error("url is required for an http request");this._execute("PUT",e,t,n)}},{key:"execPost",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(!e)throw new Error("url is required for an http request");this._execute("POST",e,t,n)}},{key:"execPatch",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(!e)throw new Error("url is required for an http request");this._execute("PATCH",e,t,n)}},{key:"execDelete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(!e)throw new Error("url is required for an http request");this._execute("DELETE",e,t)}},{key:"_execute",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},o={method:e,headers:{Accept:"application/json","Content-Type":"application/json"}};n&&(o.body=JSON.stringify(n));var s=-1;!function e(){r._auth.request(function(n,a){return n?void i(n):(o.headers.Authorization="Bearer "+a,void fetch(t,o).then(function(e){if(e.status>=200&&e.status<300)return e.json();if(401===e.status){var t=new Error("chat: unauthorized");throw t.retry=!0,t}if(503===e.status){var n=new Error("chat: server unavailable");throw n.retry=!0,n}if(403===e.status)throw new Error("chat: forbidden");throw new Error("chat: non-200 response code from chat server")}).then(function(e){i(null,e)}).catch(function(t){if(t.retry&&s<r._retries.length-1){s++;var n=r._retries[s];return n?void setTimeout(e,n):void e()}i(t)}))})}()}}]),e}();t.default=o}])})},{}],2:[function(e,t,n){!function(e,r){"object"==typeof n&&"object"==typeof t?t.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof n?n.LivelyLocales=r():e.LivelyLocales=r()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e,t){}function i(e,t){if(t){if("object"!==(void 0===t?"undefined":o(t)))throw new Error("Lively Localization instantiated with something other than a messages object",{messages:t});return new u(e,t)}return e&&l[e]?l[e]:h}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a={},l={},u=function(){function e(t,n){return r(this,e),t&&a[t]||n?(this.data=a[t]||{},void(n&&Object.assign(this.data,n))):void(this.localize=function(e){return e})}return s(e,[{key:"localize",value:function(e){var t=void 0;return(t=this.data[e])?t:e}}]),e}(),c=n(1);c.keys().forEach(function(e){var t=e.split("/");3===t.length&&(a[t[1]]||(a[t[1]]={}),a[t[1]]=Object.assign(a[t[1]],c(e)))});var h=new u;Object.keys(a).forEach(function(e){l[e]=new u(e)}),t.default=i,e.exports=t.default},function(e){function t(e){throw new Error("Cannot find module '"+e+"'.")}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=1}])})},{}],3:[function(){"document"in window.self&&("classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))?function(){"use strict";var e=document.createElement("_");if(e.classList.add("c1","c2"),!e.classList.contains("c2")){var t=function(e){var t=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){var n,r=arguments.length;for(n=0;r>n;n++)e=arguments[n],t.call(this,e)}};t("add"),t("remove")}if(e.classList.toggle("c3",!1),e.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:n.call(this,e)}}e=null}():function(e){"use strict";if("Element"in e){var t="classList",n="prototype",r=e.Element[n],i=Object,o=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},s=Array[n].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},a=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},l=function(e,t){if(""===t)throw new a("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new a("INVALID_CHARACTER_ERR","String contains an invalid character");return s.call(e,t)},u=function(e){for(var t=o.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],r=0,i=n.length;i>r;r++)this.push(n[r]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},c=u[n]=[],h=function(){return new u(this)};if(a[n]=Error[n],c.item=function(e){return this[e]||null},c.contains=function(e){return e+="",-1!==l(this,e)},c.add=function(){var e,t=arguments,n=0,r=t.length,i=!1;do e=t[n]+"",-1===l(this,e)&&(this.push(e),i=!0);while(++n<r);i&&this._updateClassName()},c.remove=function(){var e,t,n=arguments,r=0,i=n.length,o=!1;do for(e=n[r]+"",t=l(this,e);-1!==t;)this.splice(t,1),o=!0,t=l(this,e);while(++r<i);o&&this._updateClassName()},c.toggle=function(e,t){e+="";var n=this.contains(e),r=n?t!==!0&&"remove":t!==!1&&"add";return r&&this[r](e),t===!0||t===!1?t:!n},c.toString=function(){return this.join(" ")},i.defineProperty){var d={get:h,enumerable:!0,configurable:!0};try{i.defineProperty(r,t,d)}catch(e){-2146823252===e.number&&(d.enumerable=!1,i.defineProperty(r,t,d))}}else i[n].__defineGetter__&&r.__defineGetter__(t,h)}}(window.self))},{}],4:[function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!(!i(e)||0>e||isNaN(e)))return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,a,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(n=this._events[e],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(o(n))for(a=Array.prototype.slice.call(arguments,1),u=n.slice(),i=u.length,l=0;i>l;l++)u[l].apply(this,a);return!0},n.prototype.addListener=function(e,t){var i;if(r(t))return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(i=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(r(t)){var i=!1;return n.listener=t,this.on(e,n),this}},n.prototype.removeListener=function(e,t){var n,i,s,a;if(r(t)){if(!this._events||!this._events[e])return this;if(n=this._events[e],s=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(a=s;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){i=a;break}if(0>i)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this}},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utils/isBlurred.js"),a=r(s),l=e("../utils/createElement.js"),u=r(l),c=e("../utils/addEvent.js"),h=r(c),d=function(){function e(t,n,r,o){i(this,e),this.parent=t,this.chatBody=n,this.localize=r,this.options=o,this.closeFlyoutOnBlur=this.closeFlyoutOnBlur.bind(this),this.actionMuteHandler=this.actionMuteHandler.bind(this),this.actionIgnoreHandler=this.actionIgnoreHandler.bind(this),this.actionBanHandler=this.actionBanHandler.bind(this),this.actionModHandler=this.actionModHandler.bind(this),this.render(),this._blurEvent=h.default(document,"click",this.closeFlyoutOnBlur),this._blurEventTouch=h.default(document,"touchend",this.closeFlyoutOnBlur)}return o(e,[{key:"render",value:function(){this.flyout=u.default({tagName:"div",className:"chat__actions-flyout "+this.options.modifierClass}),this.parent.parentElement.appendChild(this.flyout);var e=u.default({tagName:"div",className:"chat__actions-flyout-username",text:this.options.username});if(this.flyout.appendChild(e),this.options.url){var t=u.default({tagName:"a",className:"chat__actions-flyout-button",text:this.localize("View"),attributes:{href:this.options.url}});this.flyout.appendChild(t)}(this.chatBody.isMod()||this.chatBody.isAdmin())&&(this.muteButton=u.default({tagName:"button",className:"chat__actions-flyout-button",text:this.localize("Mute"),events:{click:this.actionMuteHandler}}),this.flyout.appendChild(this.muteButton),this.banButton=u.default({tagName:"button",className:"chat__actions-flyout-button",text:this.localize("Ban IP"),events:{click:this.actionBanHandler}}),this.flyout.appendChild(this.banButton),this.ignoreButton=u.default({tagName:"button",className:"chat__actions-flyout-button",text:this.localize("Ignore"),events:{click:this.actionIgnoreHandler}}),this.flyout.appendChild(this.ignoreButton)),this.chatBody.isAdmin()&&(this.modButton=u.default({tagName:"button",className:"chat__actions-flyout-button",text:this.localize(this.options.role?"Unmod":"Mod"),events:{click:this.actionModHandler}}),this.flyout.appendChild(this.modButton))}},{key:"actionModHandler",value:function(){var e=this;return this.modButton.textContent===this.localize("Unmod")?void this.chatBody.unmodActionHandler(this.options.username,function(){e.modButton.textContent=e.localize("Mod")}):void this.chatBody.modActionHandler(this.options.username,function(){e.modButton.textContent=e.localize("Unmod")})}},{key:"actionMuteHandler",value:function(){return this.muteButton.textContent===this.localize("Unmute")?void this.chatBody.unmuteActionHandler(this.options.username):(this.chatBody.muteActionHandler(this.options.username),void(this.muteButton.textContent=this.localize("Unmute")))}},{key:"actionIgnoreHandler",value:function(){return this.ignoreButton.textContent===this.localize("Unignore")?void this.chatBody.unignoreActionHandler(this.options.username):(this.chatBody.ignoreActionHandler(this.options.username),void(this.ignoreButton.textContent=this.localize("Unignore")))}},{key:"actionBanHandler",value:function(){return this.banButton.textContent===this.localize("Unban IP")?void this.chatBody.unbanActionHandler(this.options.username):(this.chatBody.banActionHandler(this.options.username),void(this.banButton.textContent=this.localize("Unban IP")))}},{key:"closeFlyoutOnBlur",value:function(e){a.default(e,this.flyout,this.parent)&&this.close()}},{key:"close",value:function(){this._blurEvent(),this._blurEventTouch(),this._closed=!0,this.flyout.parentElement.removeChild(this.flyout)}}]),e}();n.default=d},{"../utils/addEvent.js":18,"../utils/createElement.js":19,"../utils/isBlurred.js":21}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../utils/createElement.js"),u=r(l),c=e("./chat-flyout.js"),h=r(c),d=[{name:"rateLimitDuration",value:1,text:"1s"},{name:"rateLimitDuration",value:5,text:"5s"},{name:"rateLimitDuration",value:30,text:"30s"},{name:"rateLimitDuration",value:60,text:"1m"},{name:"rateLimitDuration",value:300,text:"5m"},{name:"rateLimitDuration",value:900,text:"15m"}],f=[{name:"rateLimitMax",value:1,text:"1 chat"},{name:"rateLimitMax",value:5,text:"5 chats"},{name:"rateLimitMax",value:10,text:"10 chats"}],p=[{name:"mode",value:"user",text:"Everyone"},{name:"mode",value:"moderator",text:"Moderators"},{name:"mode",value:"owner",text:"Owner"}],v=function(e){function t(e,n,r,s){i(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"admin",r("admin")));return a.parent=e,a.chat=n,a.localize=r,a.errorHandler=s,a.handleRadioChange=a.handleRadioChange.bind(a),a}return s(t,e),a(t,[{key:"initRoom",value:function(){this._roomData&&this.chat._me&&("moderator"===this.chat._me.room.role||"owner"===this.chat._me.room.role||"admin"===this.chat._me.room.role)&&(this.render(),this.enableFlyout())}},{key:"roomHandler",value:function(){this._roomData=!0}},{key:"render",value:function(){var e=u.default({tagName:"div",className:"chat__info chat__info--mode",text:this.localize("Chat Mode")});this.flyout.appendChild(e),this.radioRenderer(p);var t=u.default({tagName:"div",className:"chat__description chat__description--mode",text:this.localize("The current mode of the room specifying which users can chat")});this.flyout.appendChild(t);var n=u.default({tagName:"div",className:"chat__info",text:this.localize("Chat Rate Limit")});this.flyout.appendChild(n),this.radioRenderer(f),this.radioRenderer(d);var r=u.default({tagName:"div",className:"chat__description",text:this.localize("Maximum amount of chats during time period")});this.flyout.appendChild(r)}},{key:"radioRenderer",value:function(e){for(var t=[],n=0;n<e.length;n++){var r=u.default({tagName:"input",className:"chat__radio",attributes:{type:"radio",name:e[n].name,value:e[n].value,id:e[n].name+n},events:{change:this.handleRadioChange}});this.chat._room[e[n].name]===e[n].value&&(r.checked="checked"),t.push(r);var i=u.default({tagName:"label",className:"chat__radio-label chat__radio-label--"+e.length,text:this.localize(e[n].text),attributes:{for:e[n].name+n}});t.push(i)}var o=u.default({tagName:"div",className:"chat__radio-slider chat__radio-slider--"+e.length});t.push(o);var s=u.default({tagName:"div",className:"chat__radio-wrapper",childs:t}),a=u.default({tagName:"div",className:"chat__radio-container chat__radio-container--restricted chat__radio-container--"+e[0].name,childs:[s]});this.flyout.appendChild(a)}},{key:"handleRadioChange",value:function(e){var t=this,n={};n[e.target.name]=isNaN(e.target.value)?e.target.value:parseInt(e.target.value,10),this.chat.patchRoom(this.chat._roomname,n,function(e,n){e&&n&&n[0]&&t.errorHandler(e,n[0])})}}]),t}(h.default);n.default=v},{"../utils/createElement.js":19,"./chat-flyout.js":10}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utils/createElement.js"),a=r(s),l=e("../utils/addEvent.js"),u=r(l),c=e("./chat-actions-flyout.js"),h=r(c),d=function(){function e(t,n,r,o,s){var a=this;i(this,e),this.parent=t,this.chat=n,this.localize=r,this.errorHandler=o,this.options=s,this._chatLineQueue=[],this._currentChunk=this.buildChunkElement(),this._currentChunkSize=0,this._chunkView=[],this._chunkHistory=[],this._chunkStorage=[],this._scrollLocked=!0,this._scrollPaused=!1,this._scrollThrottleCount=0,this._scrollThrottleRate=100,this._scrollThrottleNewRate=!1,this.scrollToggle=this.scrollToggle.bind(this),this.scrollWheelHandler=this.scrollWheelHandler.bind(this),this.actionDelete=this.actionDelete.bind(this),this.actionMore=this.actionMore.bind(this),this.render(),this._queueProcess=setInterval(function(){a.queueProcessor()},100),setTimeout(function(){a._scrollThrottleCount=0,a._scrollThrottleInterval=setInterval(function(){a.scrollThrottleHandler()},2e3)},500),this._wheelListener1=u.default(this.chatBody,"DOMMouseScroll",this.scrollWheelHandler),this._wheelListener2=u.default(this.chatBody,"mousewheel",this.scrollWheelHandler),this._wheelListener3=u.default(this.chatBody,"wheel",this.scrollWheelHandler)}return o(e,[{key:"queueProcessor",value:function(){if(!this._scrollPaused){this._chatLineQueue.length&&this._scrollThrottleCount++;for(var e=document.createDocumentFragment();this._chatLineQueue.length&&this._currentChunkSize!==this.options.chunkSize;){var t=this._chatLineQueue.shift();e.appendChild(t),this._currentChunkSize++}if(this._currentChunk.appendChild(e),this._currentChunk.parentElement||this._chunkStorage.push(this._currentChunk),this._currentChunkSize===this.options.chunkSize&&(this._currentChunk=this.buildChunkElement(),this._currentChunksProcessed++,this._currentChunkSize=0),this._chatLineQueue.length)return void this.queueProcessor();for(var n=document.createDocumentFragment(),r=this._chunkStorage.splice(-Math.abs(this.options.chunkView));r.length;){var i=r.shift();n.appendChild(i),this._chunkView.push(i)}for(this.chatBody.appendChild(n);this._chunkView.length>this.options.chunkView;){var o=this._chunkView.shift();this.chatBody.removeChild(o),this._chunkHistory.unshift(o)}for(;this._chunkStorage.length;)this._chunkHistory.unshift(this._chunkStorage.shift());for(;this._chunkHistory>this.options.chunkHistory;)this._chunkHistory.shift();this.scrollBottom()}}},{key:"scrollThrottleHandler",value:function(){var e=this;switch(this._scrollThrottleNewRate&&(this._scrollThrottleNewRate=!1,this._scrollThrottleCount++),this._scrollThrottleRate){case 100:this._scrollThrottleCount>=10&&(this._scrollThrottleRate=200,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){e.queueProcessor()},this._scrollThrottleRate));break;case 200:this._scrollThrottleCount>=10?(this._scrollThrottleRate=250,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){e.queueProcessor()},this._scrollThrottleRate)):this._scrollThrottleCount<5&&(this._scrollThrottleRate=100,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){e.queueProcessor()},this._scrollThrottleRate));break;default:this._scrollThrottleCount<8&&(this._scrollThrottleRate=200,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){e.queueProcessor()},this._scrollThrottleRate))}this._scrollThrottleCount=0}},{key:"processChat",value:function(e){if(!e.ignore){var t=this.buildLineElement(),n=this.writeChatToLine(t,e);this._chatLineQueue.push(n)}}},{key:"processMessage",value:function(e){var t=this.buildLineElement(),n=this.writeMessageToLine(t,e);this._chatLineQueue.push(n)}},{key:"render",value:function(){this.chatBody=a.default({tagName:"div",className:"chat__body"}),this.chatBodyContainer=a.default({tagName:"div",className:"chat__body-container",childs:[this.chatBody]}),this.chatBodyScrollButton=a.default({tagName:"div",className:"chat__body-scroll",events:{click:this.scrollToggle}}),this.parent.appendChild(this.chatBodyContainer),this.parent.appendChild(this.chatBodyScrollButton)}},{key:"buildChunkElement",value:function(){return this._chunkElement?this._chunkElement.cloneNode():(this._chunkElement=a.default({tagName:"div",className:"chat__chunk"}),this._chunkElement.cloneNode(!0))}},{key:"buildLineElement",value:function(){if(this._lineElement)return this._lineElement.cloneNode(!0);var e=[],t=a.default({tagName:"div",className:"chat__avatar"});e.push(t);var n=a.default({tagName:"span",className:"chat__line-role"});e.push(n);var r=a.default({tagName:"span",className:"chat__username"});e.push(r);var i=a.default({tagName:"span",className:"chat__line-timestamp"});e.push(i);var o=a.default({tagName:"div",className:"chat__line-content"});e.push(o);var s=a.default({tagName:"button",className:"chat__action chat__action--delete",attributes:{"data-tooltip":"Delete Chat"}});e.push(s);var l=a.default({tagName:"button",className:"chat__action chat__action--more",attributes:{"data-tooltip":"More Actions"}});return e.push(l),this._lineElement=a.default({tagName:"div",className:"chat__line",childs:e}),this._lineElement.cloneNode(!0)}},{key:"writeChatToLine",value:function(e,t){var n=e,r=n.childNodes;return r[0].setAttribute("style","background-color: "+t.actor.color+"; background-image: url("+t.actor.avatar+");"),r[1].className="chat__line-role chat__line-role--"+t.actor.role,r[1].textContent=t.actor.role,r[2].setAttribute("style","color: "+t.actor.color),r[2].textContent=t.actor.username,r[3].textContent=this.formatDate(t.timestamp),r[4].innerHTML=this.parseChatText(t),n.className="chat__line"+(t.actor.username===this.chat._username?" chat__line--currentUser":""),n.setAttribute("data-username",t.actor.username),n.setAttribute("data-id",t.id),"moderator"===t.actor.role&&n.setAttribute("data-role",t.actor.role),t.url&&n.setAttribute("data-url",t.url),u.default(r[5],"click",this.actionDelete),u.default(r[6],"click",this.actionMore),n}},{key:"writeMessageToLine",value:function(e,t){var n=e,r=n.childNodes,i="";switch(t.level){case"warn":i="#EBC844";break;case"info":i="#1395BA";break;default:i="#D94E1F"}r[0].setAttribute("style","background-color: "+i+"; background-image: none;"),r[1].className="",r[1].textContent="",r[2].setAttribute("style","color: "+i),r[2].textContent=t.level,r[3].textContent="",r[4].innerHTML='<div class="chat__text">'+t.message+"</div>",n.className="chat__line chat__line--message chat__line--"+t.level;var o=function(e){e.parentElement.removeChild(e)}.bind(this,n);return u.default(r[5],"click",o),n}},{key:"formatDate",value:function(e){var t=new Date(1e3*e),n="0"+t.getMinutes(),r=t.getHours();return r%=12,(r=r||12)+":"+n.substr(-2)}},{key:"parseChatText",value:function(e){var t="<div class='chat__text'>",n=e.message,r=e.positions,i=0;for(var o in r){o=parseInt(o,10);var s=n.slice(i,o),a=n.slice(o,o+r[o].length);switch(i=o+r[o].length,s.length&&(t+=s),r[o].type){case"emoticon":this.chat&&this.chat._me&&this.chat._me.showGifs,t+="<span class='chat__line-emoticon-wrap' data-pattern='"+a+"'><img class='chat__line-emoticon' src='"+r[o].url+"'/></span>";break;case"mention":t+="<a class='"+(this.chat._username===r[o].username?"chat__line-mention chat__line-mention--me":"chat__line-mention")+"' href='/"+r[o].url+"' target='_blank'>"+a+"</a>";break;case"tag":t+="<a class='chat__line-tag' href='/tag/"+r[o].text+"' target='_blank'>"+a+"</a>";break;default:t+="<a class='chat__line-link' href='"+r[o].href+"' target='_blank'>"+a+"</a>"}}return i<n.length&&(t+=n.slice(i)),t+="</div>"}},{key:"scrollToggle",value:function(){return this._scrollPaused?(this._scrollPaused=!1,void this.chatBodyScrollButton.classList.remove("chat__body-scroll--paused")):(this._scrollPaused=!0,void this.chatBodyScrollButton.classList.add("chat__body-scroll--paused"))}},{key:"scrollBottom",value:function(){this.chatBody.scrollTop=this.chatBody.scrollHeight}},{key:"scrollWheelHandler",value:function(){if(this.chatBody.scrollTop<=0&&this._scrollPaused&&this._chunkHistory.length){var e=this._chunkHistory.shift();return this.chatBody.insertBefore(e,this.chatBody.firstChild),void this._chunkView.unshift(e)}return Math.abs(this.chatBody.scrollTop-(this.chatBody.scrollHeight-this.chatBody.offsetHeight))<=5?void(this._scrollPaused&&this.scrollToggle()):void(this._scrollPaused||this.scrollToggle())}},{key:"isMod",value:function(){return!!(this.chat._me&&this.chat._me.room&&this.chat._me.room.role)&&"moderator"===this.chat._me.room.role}},{key:"isAdmin",value:function(){return!!(this.chat._me&&this.chat._me.room&&this.chat._me.room.role)&&("owner"===this.chat._me.room.role||"admin"===this.chat._me.room.role)}},{key:"actionDelete",value:function(e){var t=e.target.parentElement.getAttribute("data-id");this.chat.command("/delete "+t)}},{key:"actionMore",value:function(e){var t={username:e.target.parentElement.getAttribute("data-username"),id:e.target.parentElement.getAttribute("data-id"),url:e.target.parentElement.getAttribute("data-url"),role:e.target.parentElement.getAttribute("data-role")};return this.flyout&&!this.flyout._closed&&t.id===this.flyout.options.id?(this.flyout.close(),void(this.flyout=!1)):void(this.flyout=new h.default(e.target,this,this.localize,t))}},{key:"modActionHandler",value:function(e,t){var n=this;this.chat.command("/mod "+e,function(e,r){return e?void n.errorHandler(e,r[0]):(r&&r[0]&&n.errorHandler(e,r[0]),void(t&&t()))})}},{key:"unmodActionHandler",value:function(e,t){var n=this;this.chat.command("/unmod "+e,function(e,r){return e?void n.errorHandler(e,r[0]):(r&&r[0]&&n.errorHandler(e,r[0]),void(t&&t()))})}},{key:"muteActionHandler",value:function(e,t){var n=this;this.chat.command("/mute "+e,function(e,r){return e?void n.errorHandler(e,r[0]):(r&&r[0]&&n.errorHandler(e,r[0]),void(t&&t()))}),this.deleteByUsername(e)}},{key:"unmuteActionHandler",value:function(e,t){var n=this;this.chat.command("/unmute "+e,function(e,r){return e?void n.errorHandler(e,r[0]):(r&&r[0]&&n.errorHandler(e,r[0]),void(t&&t()))})}},{key:"ignoreActionHandler",value:function(e,t){var n=this;this.chat.command("/ignore "+e,function(e,r){return e?void n.errorHandler(e,r[0]):(r&&r[0]&&n.errorHandler(e,r[0]),void(t&&t()))}),this.deleteByUsername(e,!0)}},{key:"unignoreActionHandler",value:function(e,t){var n=this;this.chat.command("/unignore "+e,function(e,r){return e?void n.errorHandler(e,r[0]):(r&&r[0]&&n.errorHandler(e,r[0]),void(t&&t()))})}},{key:"banActionHandler",value:function(e,t){var n=this;this.chat.command("/ban "+e,function(e,r){return e?void n.errorHandler(e,r[0]):(r&&r[0]&&n.errorHandler(e,r[0]),void(t&&t()))}),this.deleteByUsername(e)}},{key:"unbanActionHandler",value:function(e,t){var n=this;this.chat.command("/unban "+e,function(e,r){return e?void n.errorHandler(e,r[0]):(r&&r[0]&&n.errorHandler(e,r[0]),void(t&&t()))})}},{key:"deleteById",value:function(e){for(var t=0;t<this._chunkView.length;t++)for(var n=this._chunkView[t].childNodes,r=0;r<n.length;r++)if(n[r].getAttribute("data-id")===e){if(this.isMod||this.isAdmin)return void n[r].classList.add("chat__line--removed");n[r].parentElement.removeChild(n[r])}}},{key:"deleteByUsername",value:function(e,t){for(var n=0;n<this._chunkView.length;n++)for(var r=this._chunkView[n].childNodes,i=0;i<r.length;i++)if(r[i].getAttribute("data-username")===e){if(t)return void r[i].parentElement.removeChild(r[i]);this.actionDelete(r[i].getAttribute("data-id"))}}},{key:"destroy",value:function(){this._wheelListener1(),this._wheelListener2(),this._wheelListener3()}}]),e}();n.default=d},{"../utils/addEvent.js":18,"../utils/createElement.js":19,"./chat-actions-flyout.js":5}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utils/createElement.js"),a=r(s),l=function(){function e(t){i(this,e),this.parent=t,this.render()}return o(e,[{key:"render",value:function(){this.el=a.default({tagName:"div",className:"chat__controls"}),this.parent.appendChild(this.el)}}]),e}();n.default=l},{"../utils/createElement.js":19}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../utils/createElement.js"),u=r(l),c=e("./chat-flyout.js"),h=r(c),d=function(e){function t(e,n,r,s,a){i(this,t);var l=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"emoticons",s("emoticons")));return l.parent=e,l.chat=n,l.chatInput=r,l.localize=s,l.errorHandler=a,l}return s(t,e),a(t,[{key:"initUser",value:function(){this.getEmoticons()}},{key:"getEmoticons",value:function(){var e=this;this.chat.getAllEmoticons(this.chat._roomname,this.chat._username,function(t,n){t&&e.errorHandler(t,e.localize("Chat Error")),e.emoticons=n.emoticons,e.enableFlyout(),e.render()})}},{key:"render",value:function(){var e=this;Object.keys(this.emoticons).map(function(t){var n=e.emoticons[t],r=u.default({tagName:"button",className:"chat__emoticon-selector",attributes:{style:"background-image: url("+n.source+")",title:n.pattern}}),i=u.default({tagName:"span",className:"chat__emoticon-selector-container",childs:[r]}),o=e.selectEmoticon.bind(e,n.pattern);return i.addEventListener("click",o),e.flyout.appendChild(i)}),this.parent.appendChild(this.flyout);var t=u.default({tagName:"a",className:"chat__attribution-link",text:"EmojiOne",attributes:{href:"http://emojione.com"}}),n=u.default({tagName:"div",className:"chat__attribution",text:"Emoji provided free by ",childs:[t]});this.flyout.appendChild(n)}},{key:"selectEmoticon",value:function(e){this.chatInput.chatInput.value=""+this.chatInput.chatInput.value+e+" ",this.chatInput.chatInput.focus(),this.toggleFlyout()}}]),t}(h.default);n.default=d},{"../utils/createElement.js":19,"./chat-flyout.js":10}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utils/isBlurred.js"),a=r(s),l=e("../utils/createElement.js"),u=r(l),c=e("../utils/addEvent.js"),h=r(c),d=function(){function e(t,n,r){i(this,e),this.parent=t,this.flyoutClassModifier=n,this.tooltipText=r,this.toggleFlyout=this.toggleFlyout.bind(this),this.closeFlyoutOnBlur=this.closeFlyoutOnBlur.bind(this),this.flyoutRender()}return o(e,[{key:"flyoutRender",value:function(){var e=u.default({tagName:"span",className:"chat__tooltip",text:this.tooltipText});this.flyoutButton=u.default({tagName:"button",className:"chat__flyout-button chat__flyout-button--"+this.flyoutClassModifier+" chat__flyout-button--disabled",childs:[e]}),this.parent.appendChild(this.flyoutButton),this.flyout=u.default({tagName:"div",className:"chat__flyout chat__flyout--"+this.flyoutClassModifier}),this.parent.parentElement.appendChild(this.flyout)}},{key:"enableFlyout",value:function(){this.flyoutButton.classList.remove("chat__flyout-button--disabled"),h.default(this.flyoutButton,"click",this.toggleFlyout)}},{key:"closeFlyoutOnBlur",value:function(e){a.default(e,this.flyout,this.flyoutButton)&&(this._blurEvent(),this._blurEventTouch(),this._blurEvent=null,this.flyout.classList.remove("chat__flyout--visible"))}},{key:"toggleFlyout",value:function(){this.flyout.classList.toggle("chat__flyout--visible"),this._blurEvent||(this._blurEvent=h.default(document,"click",this.closeFlyoutOnBlur),this._blurEventTouch=h.default(document,"touchend",this.closeFlyoutOnBlur))}}]),e}();n.default=d},{"../utils/addEvent.js":18,"../utils/createElement.js":19,"../utils/isBlurred.js":21}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utils/createElement.js"),a=r(s),l=function(){function e(t,n){i(this,e),this.parent=t,this.options=n,this.render()}return o(e,[{key:"render",value:function(){this.chatHeaderTitle=a.default({tagName:"h1",className:"chat__header-title",text:""+this.options.room}),this.el=a.default({tagName:"div",className:"chat__header",childs:[this.chatHeaderTitle]}),this.parent.appendChild(this.el)}}]),e}();n.default=l},{"../utils/createElement.js":19}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../utils/createElement.js"),u=r(l),c=e("./chat-flyout.js"),h=r(c),d={ignore:{command:"/ignore {username}",description:"Chats from ignored user will no longer be visible to you.",roles:["user","moderator","owner","admin"]},unignore:{command:"/unignore {username}",description:"Make chats from ignored user visible again",roles:["user","moderator","owner","admin"]},mute:{command:"/mute {username}",description:"Timeout user from sending chats in the chatroom",roles:["moderator","owner","admin"]},unmute:{command:"/unmute {username}",description:"Lift user timeout",roles:["moderator","owner","admin"]},ban:{command:"/ban {username}",description:"Ban IP address of user.",roles:["moderator","owner","admin"]},unban:{command:"/unban {username}",description:"Lift the ban on IP address of user",roles:["moderator","owner","admin"]},mode:{command:"/mode {user|moderator|owner}",description:"Restrict chat to those with proper privileges",roles:["moderator","owner","admin"]},mod:{command:"/mod {username}",description:"Grant a user moderator privileges.",roles:["owner","admin"]},unmod:{command:"/unmod {username}",description:"Revoke moderator privileges from user.",roles:["owner","admin"]},blacklist:{command:"/blacklist {text}",description:"Word or phrase you want to ban from your chat. Use * for wildcards.",roles:["owner","admin"]},unblacklist:{command:"/unblacklist {text}",description:"Word or phrase you want to unban from your chat.",roles:["owner","admin"]},limit:{command:"/limit {# of chats} {# of seconds}",description:"Limit the # of chats allowed during the # of seconds",roles:["owner","admin"]},owner:{command:"/owner {username}",description:"Transfer ownership of chatroom to new user",roles:["owner","admin"]}},f=function(e){function t(e,n){i(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"help",n("help")));return r.parent=e,r.localize=n,r.render(),r.enableFlyout(),r}return s(t,e),a(t,[{key:"render",value:function(){var e=this;this.helpScrollContainer=u.default({tagName:"div",className:"chat__help-scroll"}),this.flyout.appendChild(this.helpScrollContainer),Object.keys(d).map(function(t){var n=[],r=u.default({tagName:"div",text:t,className:"chat__help-name"});n.push(r);for(var i=d[t].roles,o=0;o<i.length;o++){var s=u.default({tagName:"div",text:i[o],className:"chat__help-role chat__help-role--"+i[o]});n.push(s)}var a=u.default({tagName:"div",text:d[t].command,className:"chat__help-command"});n.push(a);var l=u.default({tagName:"div",text:d[t].description,className:"chat__help-description"});n.push(l);var c=u.default({tagName:"div",className:"chat__help-wrap",childs:n});return e.helpScrollContainer.appendChild(c),!0})}}]),t}(h.default);n.default=f},{"../utils/createElement.js":19,"./chat-flyout.js":10}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utils/createElement.js"),a=r(s),l=function(){function e(t,n,r,o,s){i(this,e),this.parent=t,this.chat=n,this.chatBody=r,this.localize=o,this.errorHandler=s,this.render()}return o(e,[{key:"initUser",value:function(){this.chatInput.classList.remove("chat__input--disabled"),this.chatInput.removeAttribute("disabled"),this.chatInput.setAttribute("placeholder",this.localize("Send message"))}},{key:"render",value:function(){var e=this;this.chatInput=a.default({tagName:"input",className:"chat__input chat__input--disabled",attributes:{placeholder:this.localize("Login to chat"),disabled:"disabled"}}),this.chatInputWrapper=a.default({tagName:"div",className:"chat__input-wrapper",childs:[this.chatInput]}),this.chatInput.addEventListener("keyup",function(t){if(t.preventDefault(),13===t.keyCode){var n=t.target.value;if(null!==n.match(/^\s+$/))return void(t.target.value="");n&&(t.target.value="",e.chat.command(n,function(t,n){if(t)throw t;if(n&&n.length)for(var r=0;r<n.length;r++){if(n[r].data&&n[r].data.help)return;e.chatBody.processMessage(n[r])}}))}}),this.parent.appendChild(this.chatInputWrapper)}}]),e}();n.default=l},{"../utils/createElement.js":19}],14:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../utils/createElement.js"),u=r(l),c=e("../utils/debounce.js"),h=r(c),d=e("./chat-flyout.js"),f=r(d),p=function(e){function t(e,n,r,s){i(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"options",r("options")));return a.parent=e,a.chat=n,a.localize=r,a.errorHandler=s,a.colorHandler=h.default(a.colorHandler.bind(a),250),a.showGifsHandler=a.showGifsHandler.bind(a),a.showTimestampsHandler=a.showTimestampsHandler.bind(a),a}return s(t,e),a(t,[{key:"initUser",value:function(){this.enableFlyout(),this.renderColors(),this.getDefaultAvatars(),this.renderOptions()}},{key:"getDefaultAvatars",value:function(){var e=this;this.chat.getDefaultAvatars(function(t,n){return t?void e.errorHandler(t):(e.defaultAvatars=n.avatars,void e.renderAvatars())})}},{key:"renderOptions",value:function(){var e=u.default({tagName:"div",className:"chat__options-switch-slider"}),t=u.default({tagName:"div",className:"chat__options-switch-name",text:this.localize("Show Animated Gifs")}),n=u.default({tagName:"input",className:"chat__options-switch-checkbox",attributes:{type:"checkbox",id:"showGifs"},events:{change:this.showGifsHandler}});this.chat._me.showGifs&&(n.checked=!0);var r=u.default({tagName:"label",className:"chat__options-switch",childs:[e],attributes:{for:"showGifs"}}),i=u.default({tagName:"div",className:"chat__options-switch-container",childs:[n,r,t]}),o=u.default({tagName:"div",className:"chat__options-switch-slider"}),s=u.default({tagName:"div",className:"chat__options-switch-name",text:this.localize("Show Timestamps")}),a=u.default({tagName:"input",className:"chat__options-switch-checkbox",attributes:{type:"checkbox",id:"showTimestamps"},events:{change:this.showTimestampsHandler}});this.chat._me.showTimestamps&&(a.checked=!0);var l=u.default({tagName:"label",className:"chat__options-switch",childs:[o],attributes:{for:"showTimestamps"}}),c=u.default({tagName:"div",className:"chat__options-switch-container",childs:[a,l,s]});this.flyout.appendChild(c),this.flyout.appendChild(i)}},{key:"showGifsHandler",value:function(e){var t=this,n={};n.showGifs=e.target.checked,this.chat.patchUser(this.chat._username,n,function(e,n){return e&&n?void t.errorHandler(e,n[0]):void 0})}},{key:"showTimestampsHandler",value:function(e){var t=this,n={};n.showTimestamps=e.target.checked,this.chat.patchUser(this.chat._username,n,function(e,n){return e&&n?void t.errorHandler(e,n[0]):void 0})}},{key:"renderAvatars",value:function(){for(var e=0;e<this.defaultAvatars.length;e++){var t=this.defaultAvatars[e],n=t.link===this.chat._me.avatar,r=u.default({tagName:"div",className:"chat__default-avatar "+(n?"chat__default-avatar--selected":""),attributes:{style:"background-image: url("+t.link+"); background-color: "+(this.chat._me.color||"#E0BB47")},events:{click:this.setDefaultAvatar.bind(this,t)}}),i=u.default({tagName:"div",className:"chat__grid-col-1-5",childs:[r]});this.colorsContainer.appendChild(i)}}},{key:"renderColors",value:function(){var e=[],t=u.default({tagName:"input",className:"chat__color",attributes:{type:"color",value:this.chat._me.color},events:{change:this.colorHandler}}),n=u.default({tagName:"label",className:"chat__color-label",childs:[t]}),r=u.default({tagName:"div",className:"chat__grid-col-1-5",childs:[n]});e.push(r);for(var i=["#1abc9c","#3498db","#9b59b6","#e67e22"],o=0;o<i.length;o++){var s=u.default({tagName:"div",className:"chat__default-color",attributes:{style:"background-color: "+i[o]},events:{click:this.setDefaultColor.bind(this,i[o])}}),a=u.default({tagName:"div",className:"chat__grid-col-1-5",childs:[s]});e.push(a)}this.colorsContainer=u.default({tagName:"div",className:"chat__colors-container chat__grid",childs:e}),this.flyout.appendChild(this.colorsContainer)}},{key:"setDefaultAvatar",value:function(e){var t=this;this.chat.setDefaultUserAvatar(this.chat._username,e.id,function(n){if(n)return void t.errorHandler(n);for(var r=document.querySelectorAll(".chat__default-avatar"),i=0;i<r.length;i++)r[i].style.backgroundImage.slice(5,-2)===e.link?r[i].classList.add("chat__default-avatar--selected"):r[i].classList.remove("chat__default-avatar--selected")})}},{key:"setDefaultColor",value:function(e){var t=this,n={color:e};this.chat.patchUser(this.chat._username,n,function(n){if(n)return void t.errorHandler(n,t.localize("Chat Error"));for(var r=document.querySelectorAll(".chat__default-avatar"),i=0;i<r.length;i++)r[i].style.backgroundColor=e})}},{key:"colorHandler",value:function(e){var t=this,n={color:e.target.value};this.chat.patchUser(this.chat._username,n,function(n){if(n)return void t.errorHandler(n);for(var r=document.querySelectorAll(".chat__default-avatar"),i=0;i<r.length;i++)r[i].style.backgroundColor=e.target.value})}}]),t}(f.default);n.default=p},{"../utils/createElement.js":19,"../utils/debounce.js":20,"./chat-flyout.js":10}],15:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utils/createElement.js"),a=r(s),l=function(){function e(t,n,r){i(this,e),this.parent=t,this.onClick=n,this.localize=r,this.render()}return o(e,[{key:"render",value:function(){var e=a.default({tagName:"span",className:"chat__tooltip",text:this.localize("popout")});this.el=a.default({tagName:"button",className:"chat__flyout-button chat__flyout-button--popout",events:{click:this.onClick},childs:[e]}),this.parent.appendChild(this.el)}}]),e}();n.default=l},{"../utils/createElement.js":19}],16:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../utils/createElement.js"),u=r(l),c=e("./chat-flyout.js"),h=r(c),d=e("./chat-actions-flyout.js"),f=r(d),p=function(e){function t(e,n,r,s,a,l){i(this,t);var u=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"roster",s("roster")));return u.parent=e,u.chat=n,u.chatBody=r,u.localize=s,u.errorHandler=a,u.options=l,u.updateRoster=u.updateRoster.bind(u),u.cleanUpdateRoster=u.cleanUpdateRoster.bind(u),u.handleRadioChange=u.handleRadioChange.bind(u),u.loadMoreHandler=u.loadMoreHandler.bind(u),u.actionMore=u.actionMore.bind(u),u}return s(t,e),a(t,[{key:"initUser",value:function(){this.render(),this.roster=this.chat.getRoster({limit:this.options.rosterLimit,role:""}),this.roster.update(this.updateRoster),this.enableFlyout()}},{key:"render",value:function(){this.rosterRadioUser=u.default({tagName:"input",className:"chat__radio",attributes:{type:"radio",name:"rosterSort",value:"",checked:"checked",id:"rosterSortUser"},events:{change:this.handleRadioChange}}),this.rosterRadioModerator=u.default({tagName:"input",className:"chat__radio",attributes:{type:"radio",name:"rosterSort",value:"moderator",id:"rosterSortModerator"},events:{change:this.handleRadioChange}}),this.rosterRadioUserLabel=u.default({tagName:"label",className:"chat__radio-label",text:this.localize("Everyone"),attributes:{for:"rosterSortUser"}}),this.rosterRadioModeratorLabel=u.default({tagName:"label",className:"chat__radio-label",text:this.localize("Moderators"),attributes:{for:"rosterSortModerator"}}),this.rosterRadioWrapper=u.default({tagName:"div",className:"chat__radio-wrapper",childs:[this.rosterRadioUser,this.rosterRadioUserLabel,this.rosterRadioModerator,this.rosterRadioModeratorLabel]}),this.rosterRadioContainer=u.default({tagName:"div",className:"chat__radio-container chat__radio-container--sort",childs:[this.rosterRadioWrapper]}),this.rosterLoadMore=u.default({tagName:"button",className:"chat__roster-load-more",text:this.localize("Load More"),events:{click:this.loadMoreHandler}}),this.rosterContainer=u.default({tagName:"div",className:"chat__roster-container"}),this.rosterScrollContainer=u.default({tagName:"div",className:"chat__roster-scroll",childs:[this.rosterContainer,this.rosterLoadMore]}),this.flyout.appendChild(this.rosterRadioContainer),this.flyout.appendChild(this.rosterScrollContainer)}},{key:"handleRadioChange",value:function(e){var t={limit:this.options.rosterLimit};t.role=e.target.value,this.roster._options=t,this.roster.update(this.cleanUpdateRoster)}},{key:"loadMoreHandler",value:function(){this.roster.next(this.updateRoster)}},{key:"cleanUpdateRoster",value:function(e,t){for(;this.rosterContainer.firstChild;)this.rosterContainer.removeChild(this.rosterContainer.firstChild);this.updateRoster(e,t)}},{key:"updateRoster",value:function(e,t){if(e)return void this.errorHandler(e,{message:this.localize("Error updating roster"),level:"error"});for(var n=0;n<t.length;n++){var r=[];if("user"!==t[n].role){var i=u.default({tagName:"span",className:"chat__roster-role",text:t[n].role,attributes:{style:"background:"+t[n].roleColor}});r.push(i)}var o=u.default({tagName:"span",className:"chat__roster-actor",text:t[n].username});r.push(o);var s=u.default({tagName:"button",className:"chat__action chat__action--more chat__action--roster",attributes:{"data-tooltip":"More Actions"},events:{click:this.actionMore}});r.push(s);var a=u.default({tagName:"div",className:"chat__roster-actor-container",childs:r,attributes:{"data-username":t[n].username,"data-role":t[n].role}});this.rosterContainer.appendChild(a)}return this.roster._nextParams?void this.rosterLoadMore.classList.remove("chat__roster-load-more--disable"):void this.rosterLoadMore.classList.add("chat__roster-load-more--disable")}},{key:"actionMore",value:function(e){var t={username:e.target.parentElement.getAttribute("data-username"),id:e.target.parentElement.getAttribute("data-username"),role:e.target.parentElement.getAttribute("data-role"),modifierClass:"chat__actions-flyout--roster"};return this.actionsFlyout&&!this.actionsFlyout._closed&&t.id===this.actionsFlyout.options.id?(this.actionsFlyout.close(),void(this.actionsFlyout=!1)):void(this.actionsFlyout=new f.default(e.target,this.chatBody,this.localize,t))}}]),t}(h.default);n.default=p},{"../utils/createElement.js":19,"./chat-actions-flyout.js":5,"./chat-flyout.js":10}],17:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("@livelyvideo/chat-core"),u=r(l),c=e("@livelyvideo/localization"),h=r(c);e("classlist-polyfill");var d=e("./components/chat-body.js"),f=r(d),p=e("./components/chat-emoticons.js"),v=r(p),y=e("./components/chat-input.js"),m=r(y),b=e("./components/chat-options.js"),_=r(b),g=e("./components/chat-header.js"),w=r(g),E=e("./components/chat-roster.js"),k=r(E),O=e("./components/chat-admin.js"),P=r(O),T=e("./components/chat-help.js"),R=r(T),L=e("./components/chat-controls.js"),S=r(L),A=e("./components/chat-popout.js"),j=r(A),x=e("./utils/popout.js"),C=r(x),I=e("./utils/createElement.js"),N=r(I),M={user:null,room:null,apiHost:null,websocketHost:null,authUrl:null,popout:null,chunkHistory:20,chunkSize:10,chunkView:3,rosterLimit:100,locale:null,messages:null,debug:!1},D=function(){function e(t,n){i(this,e),this.options=s({},M,n);var r=new h.default(this.options.locale,this.options.messages);this.localize=r.localize.bind(r),this.errorHandler=this.errorHandler.bind(this),this.mount(t),this.init()}return a(e,[{key:"init",value:function(){var e=this.options.user?{url:this.options.authUrl+"?username="+this.options.user}:null;this.chat=new u.default({room:this.options.room,apiHost:this.options.apiHost,websocketHost:this.options.websocketHost},e),this.chat._username=this.options.user,this.chat._roomname=this.options.room,this.render(),this.initUnauthedUser()}},{key:"mount",value:function(e){switch(void 0===e?"undefined":o(e)){case"string":this.el=document.querySelector(e);break;case"object":this.el=e;break;default:console.warn(this.localize("Invalid Element"))}this.el.classList.add("chat")}},{key:"errorHandler",value:function(e,t){var n=t||{message:this.localize("Chat Error"),level:"error"};this.chatBody&&this.chatBody.processMessage(n),this.options.debug&&console.log(e,n)}},{key:"render",value:function(){var e=this;this.chatHeader=new w.default(this.el,this.options,this.localize),this.chatBody=new f.default(this.el,this.chat,this.localize,this.errorHandler,this.options),this.chatInput=new m.default(this.el,this.chat,this.chatBody,this.localize),this.chatEmoticons=new v.default(this.el,this.chat,this.chatInput,this.localize,this.errorHandler),this.chatControls=new S.default(this.el),this.options.popout&&(this.chatPopout=new j.default(this.chatControls.el,this.openPopout.bind(this),this.localize)),this.chatAdmin=new P.default(this.chatControls.el,this.chat,this.localize,this.errorHandler,this.options),this.chatRoster=new k.default(this.chatControls.el,this.chat,this.chatBody,this.localize,this.errorHandler,this.options),this.chatHelp=new R.default(this.chatControls.el,this.localize),this.chatOptions=new _.default(this.chatControls.el,this.chat,this.localize,this.errorHandler),this.chat.on("chat",function(t){return e.chatBody.processChat(t)}),this.chat.once("room",function(){return e.chatAdmin.roomHandler()}),this.chat.on("message",function(t){return e.chatBody.processMessage(t)}),this.chat.on("delete",function(t){return e.chatBody.deleteById(t.id)})}},{key:"initUnauthedUser",value:function(){var e=this;this.chat.on("error",function(t){return e.errorHandler(t,e.localize("Chat Error"))}),this.chat.once("me",function(t){if(e.history)for(var n=0;n<e.history.messages.length;n++)e.chatBody.processChat(e.history.messages[n]);return t?(e.meHandler(t),void e.initAuthedUser(t)):void e.roleHandler({room:{role:"anon"}})}),this.history=null,this.chat.once("history",function(t){e.history=t})}},{key:"initAuthedUser",value:function(e){var t=this;this.chatOptions.initUser(),this.chatEmoticons.initUser(),this.chatInput.initUser(),this.chatRoster.initUser(),this.chatAdmin.initRoom(),this._currentRole=e.room.role,this.chat.on("me",function(e){return t.meHandler(e)})}},{key:"meHandler",value:function(e){this.roleHandler(e),e.showTimestamps?this.el.classList.add("chat--timestamps"):this.el.classList.remove("chat--timestamps")}},{key:"roleHandler",value:function(e){if(this._currentRole&&this._currentRole!==e.room.role){var t={};switch(t.level="info",this._currentRole){case"user":t.message=this.localize("You have been modded");break;default:t.message=this.localize("You have been unmodded")}this.chatBody.processMessage(t)}this._currentRole=e.room.role;var n="chat";this.chatBody.isMod()&&(n+=" chat--isMod"),this.chatBody.isAdmin()&&(n+=" chat--isAdmin"),this.el.className=n}},{key:"openPopout",value:function(){var e=this;this.popout=new C.default(this.options.popout,{width:340,height:640}),this._unmountClose=this.popout.on("close",function(){setTimeout(function(){e.popout&&e.popout.instance&&e.popout.instance.closed&&e.closePopout()},250)}),this.destroy(),this.renderNoPopout()}},{key:"closePopout",value:function(){this.popout&&(this.popout.close(),this.popout=null),this._unmountClose&&(this._unmountClose=null),this.destroyNoPopout(),this.init()}},{key:"renderNoPopout",value:function(){var e=N.default({tagName:"div",className:"chat__poppedout-text",text:"Your chat is popped out"});this._popoutEl=N.default({tagName:"div",className:"chat__poppedout",childs:[e]}),this.el.appendChild(this._popoutEl)}},{key:"destroyNoPopout",value:function(){this.el.removeChild(this._popoutEl)}},{key:"destroy",value:function(){for(this.chat.destroy(),this.chatBody.destroy(),this.el.className="chat";this.el.firstChild;)this.el.removeChild(this.el.firstChild)}}]),e}();n.default=D},{"./components/chat-admin.js":6,"./components/chat-body.js":7,"./components/chat-controls.js":8,"./components/chat-emoticons.js":9,"./components/chat-header.js":11,"./components/chat-help.js":12,"./components/chat-input.js":13,"./components/chat-options.js":14,"./components/chat-popout.js":15,"./components/chat-roster.js":16,"./utils/createElement.js":19,"./utils/popout.js":22,"@livelyvideo/chat-core":1,"@livelyvideo/localization":2,"classlist-polyfill":3}],18:[function(e,t,n){"use strict";function r(e,t,n){return e.addEventListener?(e.addEventListener(t,n),function(){e.removeEventListener(t,n)}):(e.attachEvent("on"+t,function(){n.call(e)}),function(){e.detachEvent("on"+t,function(){n.call(e)})})}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},{}],19:[function(e,t,n){"use strict";function r(e){var t=void 0,n=void 0,i=void 0;if(e.tagName){if(t=document.createElement(e.tagName),e.className&&(t.className=e.className),e.attributes)for(n in e.attributes)t.setAttribute(n,e.attributes[n]);void 0!==e.html&&(t.innerHTML=e.html)}else t=document.createDocumentFragment();if(e.text&&t.appendChild(document.createTextNode(e.text)),void 0===window.HTMLElement&&(window.HTMLElement=Element),e.childs&&e.childs.length)for(i=0;i<e.childs.length;i++)t.appendChild(e.childs[i]instanceof window.HTMLElement?e.childs[i]:r(e.childs[i]));if(e.events)for(var o in e.events)t.addEventListener(o,e.events[o]);return t}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},{}],20:[function(e,t,n){"use strict";function r(e,t,n){var r=void 0;return function(){for(var i=arguments.length,o=Array(i),s=0;i>s;s++)o[s]=arguments[s];var a=this,l=function(){r=null,n||e.apply(a,o)},u=n&&!r;clearTimeout(r),r=setTimeout(l,t||200),u&&e.apply(a,o)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},{}],21:[function(e,t,n){"use strict";function r(e,t,n){for(var r=e.target;r&&r!==document.body;){if(r===t||r===n)return!1;r=r.parentNode}return!0}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},{}],22:[function(e,t,n){"use strict";function r(e,t){}function i(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("events"),u={width:640,height:550,toolbar:!1,menubar:!1,location:!1,status:!1,scrollbars:!1,resizable:!0,left:0,top:0},c=function(e){function t(e,n){r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(!(o instanceof t)){var a;return a=new t(e,n),i(o,a)}o.options=s({},u,n);var l=o.getParamsString(n);return o.instance=window.open(e,Date.now(),l),setTimeout(function(){return o.onPopupLoad()}),setTimeout(function(){return o.onPopupLoad()},250),o}return o(t,e),a(t,[{key:"onBeforeUnload",value:function(e){var t=this;this.emit("close",e),setTimeout(function(){t.instance.closed||(t.instance.onbeforeunload=t.onBeforeUnload.bind(t))},250)}},{key:"close",value:function(){this.instance.close()}},{key:"onPopupLoad",value:function(){try{this.instance.isPopup=!0,this.instance.onbeforeunload=this.onBeforeUnload.bind(this)}catch(e){}}},{key:"getParamsString",value:function(e){var t=[];for(var n in e)t.push(n+"="+e[n]);return t=t.join(",")}}]),t}(l.EventEmitter);n.default=c},{events:4}]},{},[17])(17)})},function(e,t,n){(function(t){var n,n;!function(t){e.exports=t()}(function(){var e;return function e(t,r,i){function o(a,l){if(!r[a]){if(!t[a]){var u="function"==typeof n&&n;if(!l&&u)return n(a,!0);if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var h=r[a]={exports:{}};t[a][0].call(h.exports,function(e){var n=t[a][1][e];return o(n?n:e)},h,h.exports,e,t,r,i)}return r[a].exports}for(var s="function"==typeof n&&n,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(t,n,r){!function(t,i){"object"==typeof r&&"object"==typeof n?n.exports=i():"function"==typeof e&&e.amd?e([],i):"object"==typeof r?r.LivelyLocales=i():t.LivelyLocales=i()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e,t){}function i(e,t){if(t){if("object"!==(void 0===t?"undefined":o(t)))throw new Error("Lively Localization instantiated with something other than a messages object",{messages:t});return new u(e,t)}return e&&l[e]?l[e]:h}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();"function"!=typeof Object.assign&&(Object.assign=function(e){if(null!=e){for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}});var a={},l={},u=function(){function e(t,n){return r(this,e),t&&a[t]||n?(this.name=t,this.data=a[t]||{},void(n&&Object.assign(this.data,n))):void(this.localize=function(e){return e})}return s(e,[{key:"localize",value:function(e){var t=void 0;return(t=this.data[e])?t:(console.warn(this.name?"'"+e+"' has no translation in the provided '"+this.name+"' locale files or localization messages":"'"+e+"' has no translation in the provided localization messages."),e)}}]),e}(),c=n(1);c.keys().forEach(function(e){var t=e.split("/");3===t.length&&(a[t[1]]||(a[t[1]]={}),a[t[1]]=Object.assign(a[t[1]],c(e)))});var h=new u;Object.keys(a).forEach(function(e){l[e]=new u(e)}),t.default=i,e.exports=t.default},function(e){function t(e){throw new Error("Cannot find module '"+e+"'.")}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=1}])})},{}],2:[function(e,t,n){"use strict";function r(e,t){var n=document.createElement(e);return n.classList.add.apply(n.classList,t),n}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},{}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("events"),u=r(l),c=e("../create-element"),h=r(c),d=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.controls=e,n.livelyPlayer=e.livelyPlayer,n.bar=e.bar,n.el=h.default("div",["lvcontrols__fullscreen"]),n.el.setAttribute("title",n.controls.localize("Full Screen")),n.bar.appendChild(n.el),n.el.addEventListener("click",n.toggleFullScreen.bind(n)),n}return s(t,e),a(t,[{key:"destroy",value:function(){this.el.remove()}},{key:"setIcon",value:function(){this.isFullscreen()?this.el.classList.remove("lvcontrols__fullscreen--exit"):this.el.classList.add("lvcontrols__fullscreen--exit")}},{key:"isFullscreen",value:function(){return!!(document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)}},{key:"toggleFullScreen",value:function(){if(this.isFullscreen())return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),void this.setIcon();var e=this.livelyPlayer.el.parentNode;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():this.livelyPlayer.el.webkitEnterFullscreen&&this.livelyPlayer.el.webkitEnterFullscreen(),this.setIcon()}}]),t}(u.default);n.default=d},{"../create-element":2,events:50}],4:[function(e,t,n){"use strict";function r(e){var t=void 0;if(e.getBoundingClientRect&&e.parentNode&&(t=e.getBoundingClientRect()),!t)return{top:0,left:0,right:0};var n=document.documentElement,r=document.body,i=n.clientTop||r.clientTop||0,o=n.clientLeft||r.clientLeft||0,s=window.pageYOffset||r.scrollTop,a=window.pageXOffset||r.scrollLeft,l=Math.floor(t.left+a-o);return{top:Math.floor(t.top+s-i),left:l,right:l+t.right}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},{}],5:[function(e,t,n){"use strict";function r(e){var t=e.pageY,n=e.pageX;return e.changedTouches&&(t=e.changedTouches[0].pageY,n=e.changedTouches[0].pageX),{y:t,x:n}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},{}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("./polyfills"),u=(r(l),e("events")),c=r(u),h=e("@livelyvideo/player-core/lib/detect"),d=r(h),f=e("@livelyvideo/player-core/lib/get-default-options"),p=r(f),v=e("@livelyvideo/player-core/lib/logger"),y=r(v),m=e("@livelyvideo/localization"),b=r(m),_=e("./fullscreen"),g=r(_),w=e("./overlay"),E=r(w),k=e("./popout"),O=r(k),P=e("./playpause"),T=r(P),R=e("./progress"),L=r(R),S=e("./keyboard"),A=r(S),j=e("./quality-selector"),x=r(j),C=e("./screen-interaction"),I=r(C),N=e("./volume"),M=r(N),D={controls:["overlay","playpause","fullscreen","popout","progress","quality-selector","volume","keyboard"],popout:{url:"",width:480,height:280}},B=function(e){function t(e,n){i(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.el=e,r.bar=document.createElement("div"),r.controls=[],r.mobileControls=d.default.any(),r.mobileControls&&r.el.classList.add("mobile"),r.el.classList.add("lvcontrols"),r.bar.classList.add("lvcontrols__bar"),r.el.appendChild(r.bar),r.options=p.default(n,D);var s=new b.default(null,r.options.messages);return r.localize=s.localize.bind(s),r.options.livelyPlayer&&r.attach(r.options.livelyPlayer),r}return s(t,e),a(t,[{key:"destroyControls",value:function(){for(var e=0;e<this.controls.length;e++)this.controls[e].destroy()}},{key:"destroy",value:function(){this.destroyControls(),this.bar.remove(),this.screenInteraction&&this.screenInteraction.destroy()}},{key:"attach",value:function(e){var t=this;this.livelyPlayer=e;for(var n=function(e){switch(e){case"fullscreen":t.controls.push(new g.default(t));break;case"overlay":t.controls.push(new E.default(t));break;case"playpause":t.controls.push(new T.default(t));break;case"popout":t.controls.push(new O.default(t));break;case"progress":t.controls.push(new L.default(t));break;case"quality-selector":t.controls.push(new x.default(t));break;case"keyboard":t.controls.push(new A.default(t));break;case"volume":t.controls.push(new M.default(t));break;default:y.default.error("unrecognized control",e)}},r=0;r<this.options.controls.length;r++)n(this.options.controls[r]);this.screenInteraction=new I.default(this.el),this.screenInteraction.on("user-active",function(){t.bar.classList.add("lvcontrols__bar--interacting")}),this.screenInteraction.on("user-idle",function(){t.bar.classList.remove("lvcontrols__bar--interacting")})}}]),t}(c.default);n.default=B},{"./fullscreen":3,"./keyboard":7,"./overlay":8,"./playpause":9,"./polyfills":10,"./popout":11,"./progress":12,"./quality-selector":13,"./screen-interaction":14,"./volume":15,"@livelyvideo/localization":1,"@livelyvideo/player-core/lib/detect":17,"@livelyvideo/player-core/lib/get-default-options":21,"@livelyvideo/player-core/lib/logger":22,events:50}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("events"),u=r(l),c=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.livelyPlayer=e.livelyPlayer,n.livelyPlayer.el.addEventListener("keypress",n.handleKeyPress.bind(n)),n}return s(t,e),a(t,[{key:"handleKeyPress",value:function(){}},{key:"destroy",value:function(){this.livelyPlayer.el.removeEventListener("keypress",this.handleKeyPress)}}]),t}(u.default);n.default=c},{events:50}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("events"),u=r(l),c=e("text-content"),h=r(c),d=e("../create-element"),f=r(d),p=5e3,v=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.controls=e,n.livelyPlayer=e.livelyPlayer,n.bar=e.bar,n.el=f.default("div",["lvcontrols__big-button"]),n.el.setAttribute("title",n.controls.localize("Play")),n.controls.el.appendChild(n.el),n.el.addEventListener("click",n.togglePlaying.bind(n)),n.showRestarter=0,n.livelyPlayer.on("play",function(){n.setIcon(),n.resetRestarter()}),n.livelyPlayer.on("pause",function(){n.setIcon(),n.stopRestarter()}),n.livelyPlayer.on("stop",function(){n.setIcon(),n.stopRestarter()}),n.livelyPlayer.on("ended",n.setIcon.bind(n)),n.livelyPlayer.on("offline",n.setIcon.bind(n)),n.livelyPlayer.on("timeupdate",function(){n.setIcon(),n.showRestarter=0,n.resetRestarter()}),n.livelyPlayer.once("manifest",n.setIcon.bind(n)),n}return s(t,e),a(t,[{key:"resetRestarter",value:function(){var e=this;this.livelyPlayer.vod||(this.stopRestarter(),this.restarter=setTimeout(function(){e.showRestarter=1},p))}},{key:"stopRestarter",value:function(){clearTimeout(this.restarter),this.showRestarter=0}},{key:"destroy",value:function(){this.el.remove()}},{key:"setIcon",value:function(){"offline"===this.livelyPlayer.getState()?(this.el.classList.remove("lvcontrols__big-button--stopped"),this.el.classList.remove("lvcontrols__big-button--playing"),this.el.classList.add("lvcontrols__big-button--offline"),h.default(this.el,this.controls.localize("Stream is currently offline"))):this.livelyPlayer.tryingToPlay?this.showRestarter?(this.el.classList.remove("lvcontrols__big-button--playing"),this.el.classList.remove("lvcontrols__big-button--offline"),this.el.classList.add("lvcontrols__big-button--stopped"),h.default(this.el,"")):(this.el.classList.remove("lvcontrols__big-button--stopped"),this.el.classList.remove("lvcontrols__big-button--offline"),this.el.classList.add("lvcontrols__big-button--playing"),h.default(this.el,"")):(this.el.classList.remove("lvcontrols__big-button--playing"),this.el.classList.remove("lvcontrols__big-button--offline"),this.el.classList.add("lvcontrols__big-button--stopped"),h.default(this.el,""))}},{key:"togglePlaying",value:function(){this.showRestarter?this.livelyPlayer.restart():this.livelyPlayer.tryingToPlay?(this.el.setAttribute("title",this.controls.localize("Pause")),this.livelyPlayer.stop()):(this.el.setAttribute("title",this.controls.localize("Play")),this.livelyPlayer.play())}}]),t}(u.default);n.default=v},{"../create-element":2,events:50,"text-content":58}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("events"),u=r(l),c=e("../create-element"),h=r(c),d=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.controls=e,n.livelyPlayer=e.livelyPlayer,n.bar=e.bar,n.el=h.default("div",["lvcontrols__play-button"]),n.el.setAttribute("title",n.controls.localize("Toggle play/pause")),n.bar.appendChild(n.el),n.el.addEventListener("click",n.togglePlaying.bind(n)),n.livelyPlayer.on("play",n.setIcon.bind(n)),n.livelyPlayer.on("pause",n.setIcon.bind(n)),n.livelyPlayer.on("stop",n.setIcon.bind(n)),n.livelyPlayer.on("ended",n.setIcon.bind(n)),n.setIcon(),n}return s(t,e),a(t,[{key:"destroy",value:function(){this.el.remove()}},{key:"setIcon",value:function(){this.livelyPlayer.tryingToPlay?(this.el.classList.remove("lvcontrols__play-button--stopped"),this.el.classList.add("lvcontrols__play-button--playing"),this.el.setAttribute("title",this.controls.localize("Pause"))):(this.el.classList.remove("lvcontrols__play-button--playing"),this.el.classList.add("lvcontrols__play-button--stopped"),this.el.setAttribute("title",this.controls.localize("Play")))}},{key:"togglePlaying",value:function(){this.livelyPlayer.tryingToPlay?this.livelyPlayer.vod?this.livelyPlayer.pause():this.livelyPlayer.stop():this.livelyPlayer.play()}}]),t}(u.default);n.default=d},{"../create-element":2,events:50}],10:[function(){"use strict";"function"!=typeof Object.assign&&(Object.assign=function(e){if(null!=e){for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}})},{}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("events"),u=r(l),c=e("@livelyvideo/player-core/lib/logger"),h=r(c),d=e("@livelyvideo/player-core/lib/parse-url"),f=r(d),p=e("../create-element"),v=r(p),y=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.options.popout&&e.options.popout.url?(n.popoutUrl=f.default(e.options.popout.url),n.popoutUrl?(n.controls=e,n.livelyPlayer=e.livelyPlayer,n.bar=e.bar,n.popoutOptions="width="+e.options.popout.width+", height="+e.options.popout.height+", resizable=yes, scrollbars=no, titlebar=no",n.poppedoutPlayer=null,n.el=v.default("div",["lvcontrols__popout-button"]),n.el.setAttribute("target","_blank"),n.el.setAttribute("title",n.controls.localize("Popout")),n.el.addEventListener("click",n.openPopout.bind(n)),n.bar.appendChild(n.el),n.el.addEventListener("click",n.openPopout.bind(n)),n):(h.default.error("popout url is invalid"),o(n))):o(n)}return s(t,e),a(t,[{key:"destroy",value:function(){this.el&&this.el.remove()}},{key:"popoverStartPlaying",value:function(e){var t=this;return this.livelyPlayer?(this.livelyPlayer.play(),e&&(this.livelyPlayer.currentTime=e.currentTime,this.livelyPlayer.volume(e.volume)),void this.livelyPlayer.play(function(){e&&e.muted?t.livelyPlayer.mute():e&&!e.muted&&t.livelyPlayer.unmute()})):void h.default.error("could not start playing on pop in, no player instance")}},{key:"openPopout",value:function(e){var t=this;if(!this.livelyPlayer)return void h.default.error("could not attach popout, no player instance");if(this.poppedoutPlayer)return void this.poppedoutPlayer.focus();if(e.preventDefault(),this.poppedoutPlayer&&(this.poppedoutPlayer.onbeforeunload=null,this.poppedoutPlayer.onunload=null),this.livelyPlayer.vod){var n=this.popoutUrl.search?"&":"?";this.popoutUrl&&(this.popoutUrl.href+=n+"start"+this.livelyPlayer.currentTime)}this.poppedoutPlayer=window.open(this.popoutUrl.href,"_blank",this.popoutOptions),this.livelyPlayer.pause();var r=void 0,i=function(){t.poppedoutPlayer.closed||(delete t.poppedoutPlayer,setTimeout(function(){t.popoverStartPlaying(r)},20))};this.poppedoutPlayer.onmessage=function(e){r=e.data},setTimeout(function(){t.poppedoutPlayer.addEventListener("beforeunload",i)},250)}}]),t}(u.default);n.default=y},{"../create-element":2,"@livelyvideo/player-core/lib/logger":22,"@livelyvideo/player-core/lib/parse-url":25,events:50}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("events"),u=r(l),c=e("@livelyvideo/player-core/lib/logger"),h=r(c),d=e("../get-el-position"),f=r(d),p=e("../get-pointer-position"),v=r(p),y=e("text-content"),m=r(y),b=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.controls=e,n.livelyPlayer=e.livelyPlayer,n.bar=e.bar,n.rendered=!1,n.livelyPlayer.on("manifest",n.renderIfNotRendered.bind(n)),n.render(),n}return s(t,e),a(t,[{key:"renderIfNotRendered",value:function(){this.rendered||this.render()}},{key:"render",value:function(){var e=this;if(this.livelyPlayer.vod){this.rendered=!0,this.livelyPlayer.removeListener("manifest",this.renderIfNotRendered),this.el=document.createElement("div");var t=this.controls.screenInteraction.userInteraction?"lvcontrols__progress lvcontrols__progress--interacting":"lvcontrols__progress";this.el.setAttribute("class",t),this.progressBarEl=document.createElement("div"),this.progressBarEl.setAttribute("class","lvcontrols__progress-bar"),this.sliderBufferEl=document.createElement("div"),this.sliderBufferEl.setAttribute("class","lvcontrols__progress-slider-buffer"),this.sliderValueEl=document.createElement("div"),this.sliderValueEl.setAttribute("class","lvcontrols__progress-slider-value"),this.durationEl=document.createElement("div"),this.durationEl.setAttribute("class","lvcontrols__duration"),this.currentTimeEl=document.createElement("div"),this.currentTimeEl.setAttribute("class","lvcontrols__current-time"),this.controls.screenInteraction.on("user-active",function(){e.el.classList.add("lvcontrols__progress--interacting")}),this.controls.screenInteraction.on("user-idle",function(){e.el.classList.remove("lvcontrols__progress--interacting")}),this.nextTime=0,this.el.addEventListener("mousedown",function(t){e.startDrag(t)}),document.addEventListener("mouseup",function(t){e.stopDrag(t)}),document.addEventListener("mousemove",function(t){e.moveSlider(t)}),this.el.appendChild(this.progressBarEl),this.el.appendChild(this.sliderBufferEl),this.el.appendChild(this.sliderValueEl),this.el.appendChild(this.durationEl),this.el.appendChild(this.currentTimeEl),this.controls.el.appendChild(this.el),this.livelyPlayer.on("timeupdate",function(t){e.updateSliderValue(t)}),this.livelyPlayer.on("progress",function(t){e.updateSliderValue(t)})}}},{key:"calculateSeek",value:function(e){if(this.dragging){var t=(v.default(e).x-f.default(this.el).left)/this.el.getBoundingClientRect().width;t=Math.max(t,0),t=Math.min(t,1),this.nextTime=t*this.livelyPlayer.duration}}},{key:"updateSliderValue",value:function(){if(!this.dragging){for(var e=this.livelyPlayer,t=e.currentTime,n=t/e.duration,r=this.livelyPlayer.bufferTimes,i=void 0,o=0;o<r.length;o++)if(t>=r[o][0]&&t<=r[o][1]){i=r[o];break}if(i){var s=Math.max(Number((i[0]/e.duration).toFixed(2)),0),a=Math.max(Number((i[1]/e.duration).toFixed(2)),0);this.sliderBufferEl.style.left=100*s+"%",this.sliderBufferEl.style.width=100*(a-s)+"%"}else this.sliderBufferEl.style.width=0;this.sliderValueEl.style.width=100*n+"%",m.default(this.durationEl,""+this.formatHHMMSS(e.duration)),m.default(this.currentTimeEl,""+this.formatHHMMSS(e.currentTime))}}},{key:"formatHHMMSS",value:function(e){function t(e,t){isNaN(t)||e.push(10>t?"0"+t:t)}var n=parseInt(e,10),r=Math.floor(n/3600),i=Math.floor((n-3600*r)/60),o=n-3600*r-60*i,s=[];return t(s,r),t(s,i),t(s,o),s.join(":")}},{key:"moveSlider",value:function(e){if(this.dragging){var t=v.default(e).x-f.default(this.el).left;0>t?t=0:t>this.el.clientWidth&&(t=this.el.clientWidth),this.sliderValueEl.style.width=t+"px"}}},{key:"startDrag",value:function(){this.dragging=!0}},{key:"stopDrag",value:function(e){if(this.dragging){this.dragging=!1;var t=(v.default(e).x-f.default(this.el).left)/this.el.getBoundingClientRect().width;t=Math.max(t,0),t=Math.min(t,1);var n=t*this.livelyPlayer.duration;return isNaN(n)?void h.default.error("attempted to set current time to NaN",n):void(this.livelyPlayer.currentTime=n)}}},{key:"destroy",value:function(){this.livelyPlayer.removeListener("manifest",this.renderIfNotRendered),this.livelyPlayer.removeListener("timeupdate",this.updateSliderValue),this.livelyPlayer.removeListener("progress",this.updateSliderValue),this.rendered&&(this.rendered=!1,this.el.remove(),this.progressBarEl.remove(),this.sliderBufferEl.remove(),this.sliderValueEl.remove(),document.removeEventListener("mouseup",this.stopDrag.bind(this)))}}]),t}(u.default);n.default=b},{"../get-el-position":4,"../get-pointer-position":5,"@livelyvideo/player-core/lib/logger":22,events:50,"text-content":58}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("events"),u=r(l),c=e("text-content"),h=r(c),d=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.controls=e,n.livelyPlayer=e.livelyPlayer,n.bar=e.bar,n.mediaData=null,n.encodings=[],n.el=document.createElement("div"),n.el.setAttribute("title",n.controls.localize("Quality Selector")),n.qualitiesEl=document.createElement("div"),n.qualitiesEl.setAttribute("class","lvcontrols__qualities lvcontrols__qualities--hidden"),n.el.addEventListener("click",n.openQualitySelector.bind(n)),n.livelyPlayer.on("progress",function(){n.reclass()}),n.livelyPlayer.on("play",function(){n.render()}),n.controls.bar.appendChild(n.qualitiesEl),n.controls.bar.appendChild(n.el),n}return s(t,e),a(t,[{key:"openQualitySelector",value:function(e){"lvcontrols__qualities"!==this.qualitiesEl.getAttribute("class")&&(this.controls.screenInteraction.lockOpen(),this.qualitiesEl.setAttribute("class","lvcontrols__qualities"),e.stopPropagation(),document.addEventListener("click",this.closeQualitySelector.bind(this)))}},{key:"closeQualitySelector",value:function(){this.controls.screenInteraction.releaseLockOpen(),document.removeEventListener("click",this.closeQualitySelector.bind(this)),this.qualitiesEl.setAttribute("class","lvcontrols__qualities lvcontrols__qualities--hidden")}},{key:"destroy",value:function(){document.removeEventListener("click",this.closeQualitySelector.bind(this)),this.qualitiesEl.remove(),this.el.remove()}},{key:"reclass",value:function(){var e=this.livelyPlayer.currentEncoding(),t=void 0,n=void 0;e||(t=this.currentLevel,n=this.nextLevel);for(var r=void 0,i=0;i<this.qualitiesEl.children.length;i++)r=this.qualitiesEl.children[i],i===t||e&&this.qualitiesEl.children[i].getAttribute("data-location")===e.location?r.classList.add("lvcontrols__quality--current-level"):r.classList.remove("lvcontrols__quality--current-level"),i===n?r.classList.add("lvcontrols__quality--next-level"):r.classList.remove("lvcontrols__quality--next-level")}},{key:"render",value:function(){var e=this;if(this.encodings.forEach(function(e){e.remove()}),this.encodings=[],this.mediaData=this.livelyPlayer.mediaData,!(this.mediaData&&this.mediaData.encodings&&this.mediaData.encodings.length))return void this.el.setAttribute("class","lvcontrols__quality-selector lvcontrols__quality-selector--hidden");this.el.setAttribute("class","lvcontrols__quality-selector");for(var t=this.livelyPlayer.currentEncoding(),n=this.currentLevel,r=this.chosenLevel,i=this.nextLevel,o=function(o,s){var a=document.createElement("div"),l="lvcontrols__quality",u=void 0;if(o.videoKbps){if(o.videoHeight){var c=document.createElement("span");c.setAttribute("class","lvcontrols__kbps"),h.default(a,o.videoHeight+"p"),h.default(c,o.videoKbps+o.audioKbps+"Kbps"),a.insertBefore(c,a.firstChild),u=o.videoKbps+o.audioKbps,null!==r&&void 0!==s&&s===r&&(l+=" lvcontrols__quality--selected"),null!==n&&void 0!==s&&s===n&&(l+=" lvcontrols__quality--current-level"),null!==i&&void 0!==s&&s===i&&(l+=" lvcontrols__quality--next-level")}else n--,r--,i--,h.default(a,e.controls.localize("Auto")),u=null,null===t&&(l+=" lvcontrols__quality--selected");a.setAttribute("class",l),a.setAttribute("data-location",o.location),a.addEventListener("click",function(){e.livelyPlayer.bitrate=u,e.render()}),e.qualitiesEl.appendChild(a),e.encodings.push(a)}};this.qualitiesEl.firstChild;)this.qualitiesEl.removeChild(this.qualitiesEl);this.mediaData.auto&&o({location:this.mediaData.manifest,videoKbps:!0}),this.mediaData.encodings.reverse().forEach(o)}},{key:"chosenLevel",get:function(){return this.mediaData&&this.mediaData.encodings?this.livelyPlayer.chosenLevel?this.mediaData.encodings.length-this.livelyPlayer.chosenLevel:this.livelyPlayer.chosenLevel:null}},{key:"currentLevel",get:function(){return this.mediaData&&this.mediaData.encodings?this.livelyPlayer.currentLevel?this.mediaData.encodings.length-this.livelyPlayer.currentLevel:this.livelyPlayer.currentLevel:null}},{key:"nextLevel",get:function(){return this.mediaData&&this.mediaData.encodings?this.livelyPlayer.nextLevel?this.mediaData.encodings.length-this.livelyPlayer.nextLevel:this.livelyPlayer.nextLevel:null}}]),t}(u.default);n.default=d},{events:50,"text-content":58}],14:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("events"),u=r(l),c=e("@livelyvideo/player-core/lib/detect"),h=r(c),d=e("@livelyvideo/player-core/lib/events"),f=r(d),p=e("lodash.throttle"),v=r(p),y=function(e){function t(e,n){i(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.targetEl=e,r.limit=n||500,r.mobileControls=h.default.any(),r.userInteraction=null,r.userInteractionTimeout=null,r.disableReset=null,r.throttledSetUserInteraction=v.default(r.setUserInteraction.bind(r),r.limit,{leading:!0,trailing:!1}),r.handleEvents(),r}return s(t,e),a(t,[{key:"handleEvents",value:function(){var e=this;return this.mobileControls?(this.setUserInteraction(),this.targetEl.addEventListener("touchstart",function(){e.forceInteraction()}),this.targetEl.addEventListener("touchend",function(){e.forceInteractionEnd()}),void this.targetEl.addEventListener("touchcancel",function(){e.forceInteractionEnd()})):(this.targetEl.addEventListener("mouseover",function(t){e.resetUserInteraction(),e.throttledSetUserInteraction(t)}),this.targetEl.addEventListener("mousedown",function(){e.forceInteraction()}),this.targetEl.addEventListener("mouseup",function(){e.forceInteractionEnd()}),void this.targetEl.addEventListener("mouseout",function(){e.forceInteractionEnd()}))}},{key:"forceInteraction",value:function(){this.disableReset=!0,clearTimeout(this.userInteractionTimeout),this.setUserInteraction()}},{key:"lockOpen",value:function(){this.lockedOpen=!0,clearTimeout(this.userInteractionTimeout)}},{key:"releaseLockOpen",value:function(){this.lockedOpen=!1,this.resetUserInteraction()}},{key:"forceInteractionEnd",value:function(){this.disableReset=!1,this.setUserInteraction()}},{key:"setUserInteraction",value:function(){this.userInteraction||(this.userInteraction=!0,this.emit(f.default.USER_ACTIVE)),this.disableReset||this.resetUserInteraction()}},{key:"resetUserInteraction",value:function(){var e=this;clearTimeout(this.userInteractionTimeout),this.userInteractionTimeout=setTimeout(function(){e.lockedOpen||(e.userInteraction=!1,e.emit(f.default.USER_IDLE))},2e3)}},{key:"destroy",value:function(){return this.mobileControls?(this.targetEl.removeEventListener("touchstart",this.forceInteraction.bind(this)),this.targetEl.removeEventListener("touchend",this.forceInteractionEnd.bind(this)),void this.targetEl.removeEventListener("touchcancel",this.forceInteractionEnd.bind(this))):(this.targetEl.removeEventListener("mouseover",this.throttledSetUserInteraction.bind(this)),this.targetEl.removeEventListener("mousedown",this.forceInteraction.bind(this)),this.targetEl.removeEventListener("mouseup",this.forceInteractionEnd.bind(this)),void this.targetEl.removeEventListener("mouseout",this.forceInteractionEnd.bind(this)))}}]),t}(u.default);n.default=y},{"@livelyvideo/player-core/lib/detect":17,"@livelyvideo/player-core/lib/events":19,events:50,"lodash.throttle":55}],15:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("events"),u=r(l),c=e("../get-el-position"),h=r(c),d=e("../get-pointer-position"),f=r(d),p=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.controls=e,n.livelyPlayer=e.livelyPlayer,n.bar=e.bar,n.el=document.createElement("div"),n.indicatorEl=document.createElement("div"),n.indicatorEl.setAttribute("title",n.controls.localize("Mute")),n.sliderEl=document.createElement("div"),n.sliderValueEl=document.createElement("div"),n.showingSlider=!1,n.hideSlider(),n.indicatorEl.setAttribute("class","lvcontrols__volume-indicator"),n.sliderValueEl.setAttribute("class","lvcontrols__volume-slider-value"),n.sliderEl.appendChild(n.sliderValueEl),n.setMutedClass(),n.indicatorEl.addEventListener("click",function(e){n.toggleMuted(e)}),n.indicatorEl.addEventListener("touch",function(e){n.toggleMuted(e)}),n.el.addEventListener("mouseover",function(){n.showingSlider=!0,n.showSlider()}),n.el.addEventListener("mouseout",function(){n.showingSlider=!1,n.hideSlider()}),n.sliderEl.addEventListener("click",function(e){n.clickVolume(e)}),n.sliderEl.addEventListener("mousedown",function(e){n.startDrag(e)}),n.el.appendChild(n.indicatorEl),n.el.appendChild(n.sliderEl),n.el.setAttribute("class","lvcontrols__volume-bar"),n.bar.appendChild(n.el),n.livelyPlayer.on("mute",function(e){n.setMutedClass(e)}),n.livelyPlayer.on("unmute",function(e){n.setMutedClass(e)}),n.livelyPlayer.on("volume",function(e){n.updateVolume(e)}),n.livelyPlayer.on("play",function(e){n.setMutedClass(e)}),n.updateVolume(),n}return s(t,e),a(t,[{key:"updateVolume",value:function(){this.setMutedClass(),this.setVolume()}},{key:"setMutedClass",value:function(){var e=this.livelyPlayer.muted?"lvcontrols__volume-indicator--muted":"lvcontrols__volume-indicator--unmuted",t=100*this.livelyPlayer.volume,n="";this.livelyPlayer.muted||(n=0===t?"lvcontrols__volume-indicator--off":100*this.livelyPlayer.volume>50?"lvcontrols__volume-indicator--high":"lvcontrols__volume-indicator--low"),this.indicatorEl.setAttribute("class","lvcontrols__volume-indicator "+e+" "+n);var r=this.controls.localize(this.livelyPlayer.muted?"Unmute":"Mute");this.indicatorEl.setAttribute("title",r)}},{key:"startDrag",value:function(){this.dragging=!0,document.addEventListener("mousemove",this.calculateVolume.bind(this)),document.addEventListener("mouseup",this.stopDrag.bind(this)),document.addEventListener("mouseleave",this.stopDrag.bind(this))}},{key:"stopDrag",value:function(){this.dragging=!1,this.hideSlider(),document.removeEventListener("mouseup",this.stopDrag.bind(this)),document.removeEventListener("mouseleave",this.stopDrag.bind(this)),document.removeEventListener("mousemove",this.calculateVolume.bind(this))}},{key:"calculateVolume",value:function(e){if(this.dragging){var t=Math.floor(f.default(e).x-h.default(this.sliderEl).left)/100;t=Math.max(t,0),t=Math.min(t,1),this.livelyPlayer.volume=t}}},{key:"clickVolume",value:function(e){this.dragging=!0,this.calculateVolume(e),this.dragging=!1}},{key:"setVolume",value:function(){this.sliderValueEl.style.width=Math.floor(100*this.livelyPlayer.volume)+"%"}},{key:"toggleMuted",value:function(){this.livelyPlayer.muted?this.livelyPlayer.unmute():this.livelyPlayer.mute()}},{key:"showSlider",value:function(){this.sliderEl.setAttribute("class","lvcontrols__volume-slider lvcontrols__volume-slider--interacting")}},{key:"hideSlider",value:function(){this.dragging||this.showingSlider||this.sliderEl.setAttribute("class","lvcontrols__volume-slider ")}},{key:"destroy",value:function(){this.el.remove(),this.indicatorEl.remove(),this.sliderEl.remove(),this.sliderValueEl.remove(),this.livelyPlayer.removeListener("mute",this.setMutedClass.bind(this)),this.livelyPlayer.removeListener("unmute",this.setMutedClass.bind(this)),this.livelyPlayer.removeListener("volume",this.updateVolume.bind(this)),this.livelyPlayer.removeListener("play",this.setMutedClass.bind(this))}}]),t}(u.default);n.default=p},{"../get-el-position":4,"../get-pointer-position":5,events:50}],16:[function(e,t,n){(function(t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("events"),u=r(l),c=e("./logger"),h=r(c),d=e("./detect"),f=r(d),p=e("./errors"),v=r(p),y=e("./events"),m=r(y),b=[0,1e3,2e3,5e3,25e3],_=function(e){function n(e,t,r){i(this,n);var s=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return s.resetCounts(),s.errors={},s.livelyPlayer=e,s.mediaLoader=t,s.options=r,s.onceHandlerLock=!1,s}return s(n,e),a(n,[{key:"resetCounts",value:function(){this.fragCounts=0,this.fragSize=0,this.fragDuration=0,this.fragDownloadTime=0,this.fragMaxTime=0,this.fragMinTime=0,this.bufferOverflowCount=0,this.bufferUnderflowCount=0,this.upshift=0,this.downshift=0,this.lastProgress=0,this.currentErrorCount=0,this.recentErrorCount=0,this.restartCount=0}},{key:"pickEncoding",value:function(e){if(e&&(this.options.bitrate=e),!this.options.bitrate)return null;var t=this.data.encodings;return t.length?t[this.chosenLevel]:void 0}},{key:"reloadAndRestart",value:function(){var e=this;this.lockReload||(this.lockReload=!0,this.mediaLoader.load(function(){e.mediaLoader.currentState===m.default.ONLINE?e.restart(function(){e.lockReload=!1}):(e.lockReload=!1,e.stop())}))}},{key:"whenReady",value:function(e){var t=this;if(!this.onceHandlerLock)return this.manifest?void(e&&e()):this.mediaLoader.currentState===m.default.ONLINE?void this.emit(m.default.ERROR,v.default.DRIVER_NOT_SUPPORTED):(this.onceHandlerLock=!0,void this.mediaLoader.once(m.default.MANIFEST,function(){t.onceHandlerLock=!1,t.whenReady(e)}))}},{key:"setOption",value:function(e,t){switch(this.options[e]=t,e){case"posterURI":this.el&&this.el.setAttribute("poster",t)}}},{key:"elementPlay",value:function(){if(this.el&&this.el.play){var e=this.el.play();"undefined"!=typeof Promise&&e instanceof Promise&&e.catch(function(){})}}},{key:"attachListeners",value:function(){var e=this;this.el.onprogress=function(){e.emitProgress()},this.el.ontimeupdate=function(){e.fragCounts++,e.emitTimeupdate()}}},{key:"play",value:function(e){var n=this,r=e||function(){};return this.mediaLoader.vod&&this.manifest&&this.manifest===this.el.getAttribute("src")?(this.elementPlay(),void r(!this.el.paused)):(f.default.any()&&this.elementPlay(),void this.whenReady(function(){var e=n.manifest;h.default.setPlayer(n.mediaLoader.host,n.mediaLoader.publicId,n.format,e,n);var i=function(){n.el.onprogress=function(){n.emitProgress()},n.el.ontimeupdate=function(){n.fragCounts++,n.emitTimeupdate()}};!function(){f.default.iOS()&&n.el.getAttribute("src")===e||n.el.setAttribute("src",e)}();var o=n.el.play();return o&&o.then?void o.then(function(){i(),r&&r(!0)}).catch(function(e){h.default.debug("video element play error caught",e.message),n.emit("video-el-error",{err:e}),r&&r(!1)}):(i(),void t.nextTick(function(){r&&r(!n.el.paused)}))}))}},{key:"stop",value:function(){this.el.setAttribute("src","")}},{key:"destroy",value:function(){this.destroyed=!0,this.el.remove(),this.stop()}},{key:"pause",value:function(){this.el.pause()}},{key:"unmute",value:function(){return this.el.muted=!1,this.el.muted}},{key:"mute",value:function(){return this.el.muted=!0,this.el.muted}},{key:"supportsFullscreen",value:function(){var e=document.createElement("video");return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitSupportsFullscreen||document.webkitFullscreenEnabled||e.webkitRequestFullScreen||e.webkitEnterFullScreen)}},{key:"restartTimeout",value:function(e){var t=this;setTimeout(function(){t.destroyed||(t.stop(),t.play(function(){for(var n=arguments.length,r=Array(n),i=0;n>i;i++)r[i]=arguments[i];t.lockRestart=!1,e&&e.apply(e,r)}))},b[Math.min(this.restartCount,b.length-1)])}},{key:"restart",value:function(e){var t=this;this.lockRestart||(this.lockRestart=!0,this.currentErrorCount=0,this.recentErrorCount=0,this.restartCount++,clearTimeout(this.clearRestartCount),this.clearRestartCount=setTimeout(function(){t.restartCount=0},2*b[b.length-1]),this.emit(m.default.RESTART_DRIVER,{timeout:b[Math.min(this.restartCount,b.length-1)]}),this.restartTimeout(e))}},{key:"checkRestart",value:function(e){var t=this,n=e;this.recentErrorCount++,setTimeout(function(){t.recentErrorCount--,t.recentErrorCount=Math.max(t.recentErrorCount,0)},1e4),this.recentErrorCount>=this.options.recoverErrorCount&&(n.fatal=!0),this.currentErrorCount>=this.options.recoverErrorCount&&(n.fatal=!0),n.fatal&&!this.mediaLoader.vod&&this.restart()}},{key:"handleError",value:function(e,t,n){var r=t+":"+n.details;this.errors[r]||(this.errors[r]=0),this.errors[r]++;for(var i=arguments.length,o=Array(i>3?i-3:0),s=3;i>s;s++)o[s-3]=arguments[s];this.emit.apply(this,[e,t,n].concat(o))}},{key:"playOrigin",value:function(e){this.options.origin=!0,this.restart(e)}},{key:"emitProgress",value:function(){this.lastProgress=window.performance.now(),this.emit(m.default.MEDIA_PROGRESS)}},{key:"emitTimeupdate",value:function(){this.emit(m.default.MEDIA_TIMEUPDATE)}},{key:"format",get:function(){return this.constructor.format}},{key:"driver",get:function(){return this.constructor.driver}},{key:"duration",get:function(){return this.el&&this.el.duration?this.el.duration:1/0}},{key:"bufferTimes",get:function(){for(var e=[],t=this.el.buffered.length,n=0;t>n;n++)e.push([this.el.buffered.start(n),this.el.buffered.end(n)]);return e}},{key:"volume",get:function(){return this.el.volume},set:function(e){return void 0!==e&&(this.el.volume=e),this.el.muted&&e&&e>0&&this.unmute(),this.el.volume}},{key:"supportsAutoplay",get:function(){return!f.default.any()}},{key:"supportsMobileAutoplay",get:function(){return!1}},{key:"supportsVolume",get:function(){return!0}},{key:"origin",get:function(){var e=this.data.origin;if(!e){if(!this.data||!this.data.encodings.length)return null;var t=this.data;return t.encodings[t.encodings.length-1]}return e}},{key:"originLocation",get:function(){var e=this.origin;return e?e.location:null}},{key:"data",get:function(){var e=this.mediaLoader.get(this.format);return e.auto=!0,e}},{key:"chosenLevel",get:function(){if(!this.options.bitrate)return null;var e=this.data.encodings;if(e.length){var t=void 0;for(t=0;t<e.length&&!(e[t].videoWidth&&e[t].videoKbps+e[t].audioKbps>this.options.bitrate);t++);return t=Math.max(t-1,0)}}},{key:"currentLevel",get:function(){return this.chosenLevel}},{key:"nextLevel",get:function(){return null}},{key:"manifest",get:function(){if(this.options.origin){var e=this.originLocation;return e?e:(this.options.origin=!1,this.manifest())}var t=this.data;if(!t.encodings.length){var n=this.originLocation;return n&&(this.options.origin=!0),n}var r=this.pickEncoding(),i=void 0;if(!(i=r?r.location:t.manifest))return null;var o=-1===i.indexOf("?")?"?":"&";return null===this.options.preset||(this.options.preset?i+=o+"preset="+this.options.preset:f.default.any()||(i+=o+"preset=desktop")),i}},{key:"currentTime",get:function(){return this.el.currentTime},set:function(e){this.el.currentTime=e}},{key:"stopped",get:function(){return!!this.el.getAttribute("src","")}},{key:"bitrate",set:function(e){var t=this,n=this.el.currentTime;this.stop(),this.options.bitrate=e,this.mediaLoader.vod&&(this.el.onloadedmetadata=function(){t.el.onloadedmetadata=null,t.el.currentTime=n},this.el.oncanplay=function(){t.el.oncanplay=null,t.el.currentTime>=n||(t.el.currentTime=n)}),this.play(function(){t.emit(m.default.BITRATE_SWITCH)})}},{key:"muted",get:function(){return!!this.el.muted}},{key:"paused",get:function(){return this.el.paused}},{key:"details",get:function(){return{bufferOverflowCount:this.bufferOverflowCount||0,bufferUnderflowCount:this.bufferUnderflowCount||0,downshift:this.downshift||0,errors:this.errors||{},muted:this.el&&this.el.muted,segments:this.fragCounts||0,segmentsSize:this.fragSize||0,segmentsDuration:this.fragDuration||0,segmentTotalDownloadTime:this.fragDownloadTime||0,segMaxTime:this.fragMaxTime||0,segMinTime:this.fragMinTime||0,upshift:this.upshift||0,volume:this.el&&this.el.volume?this.el.volume:0}}}],[{key:"isSupported",value:function(){h.default.error("an abstract method has been called")}},{key:"defaultOptions",get:function(){return{adaptive:null,bitrate:null,muted:!1,volume:.75}}}]),n}(u.default);n.default=_}).call(this,e("_process"))},{"./detect":17,"./errors":18,"./events":19,"./logger":22,_process:49,events:50}],17:[function(e,t,n){"use strict";function r(e,t){return function(){return void 0===s[e]&&(s[e]=t()),s[e]}}function i(){var e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return!!e&&parseInt(e[2],10)}function o(){if(/iP(hone|od|ad)/.test(navigator.platform)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||0,10)]}}Object.defineProperty(n,"__esModule",{value:!0});var s={},a={chromeGreater50:r("chromeGreater50",function(){return!!a.chrome()&&i()>49}),modernChrome:r("modernChrome",function(){return!!a.chrome()&&i()>52}),winChrome51:r("winChrome51",function(){return!(!a.windowsDesktop()||!a.chrome())&&i()>51}),iPhone10:r("iPhone10",function(){if(!a.iPhone())return!1;for(var e=navigator.userAgent.split(/\s*[;)(]\s*/),t=void 0,n=void 0,r=0;r<e.length;r++){if("Version"===e[r].slice(0,7)){t=e[r];break}if(e.length>0&&"OS"===e[r]&&"iPhone"===e[r-1]){n=e[r+1];break}}if(!t&&!n)return!1;var i=n?n.split("_"):t.split("/");return parseFloat(i[1])<11}),iPhone9:r("iPhone9",function(){if(!a.iPhone())return!1;var e=o();return e&&e[0]<10}),modernMobile:r("modernMobile",function(){return!!(a.any()&&(a.android()&&a.modernChrome()||a.iPhone10()))}),windowsDesktop:r("windowsDesktop",function(){return/Windows/i.test(navigator.userAgent)}),chrome:r("chrome",function(){return/Chrome/i.test(navigator.userAgent)}),firefox:r("firefox",function(){return/Firefox/i.test(navigator.userAgent)}),ie:r("ie",function(){return/Trident/i.test(navigator.userAgent)}),edge:r("edge",function(){return/Edge\/\d+/.test(navigator.userAgent)}),safari:r("safari",function(){return/Safari/i.test(navigator.userAgent)}),windows:r("windows",function(){return/IEMobile/i.test(navigator.userAgent)}),android:r("android",function(){return/Android/i.test(navigator.userAgent)}),blackBerry:r("blackBerry",function(){return/BlackBerry/i.test(navigator.userAgent)}),iOS:r("iOS",function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)}),iPhone:r("iPhone",function(){return/iPhone/i.test(navigator.userAgent)}),any:r("any",function(){return a.android()||a.blackBerry()||a.iOS()||a.windows()})};n.default=a},{}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={BAD_INPUT:"bad-input",DRIVER_NOT_SUPPORTED:"driver-not-supported",ELEMENT_REQUIRED:"element-required",EMBED_SWF_FAILED:"embedding-flash-swf-failed",GET_USER_MEDIA_FAILED:"get-user-media-failed",HTTP_SERVER_UNEXPECTED_RESPONSE:"http-server-unexpected-response",HTTP_SERVER_UNAUTHORIZED:"http-server-unauthorized",HTTP_SERVER_FORBIDDEN:"http-server-forbidden",HTTP_SERVER_INTERNAL_ERROR:"http-server-internal-error",HTTP_SERVER_NOT_FOUND:"http-server-not-found",MANIFEST:"http-response",INVALID_CONTROLS:"invalid-controls-parent",INVALID_MEDIA_URL:"invalid-media-url",INVALID_POPOUT_URL:"invalid-popout-url",INVALID_EL:"invalid-element",WS_NETWORK_ERROR:"websocket-network-error",NETWORK_ERROR:"network-error",NO_DRIVERS:"no-valid-drivers",PLAYBACK_ERROR:"playback-error",UNKNOWN_DRIVER:"unknown-driver",UNKNOWN_ERROR:"unknown-error",UNRECOGNIZED_DRIVER:"unrecognized-driver",USER_REQUIRED:"user-required"};n.default=r},{}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={EXIT_FULLSCREEN:"exit-fullscreen",ENTER_FULLSCREEN:"enter-fullscreen",ERROR:"error",BITRATE_SWITCH:"bitrate-switch",SELECT_DRIVER:"select-driver",RESTART_DRIVER:"restart-driver",MANIFEST:"manifest",MEDIA_ENDED:"ended",MEDIA_PLAY:"play",MEDIA_STOP:"stop",MEDIA_PAUSE:"pause",MEDIA_STALL:"stall",MEDIA_PROGRESS:"progress",MEDIA_TIMEUPDATE:"timeupdate",MEDIA_MUTE:"mute",MEDIA_UNMUTE:"unmute",MEDIA_VOLUME:"volume",ONLINE:"online",OFFLINE:"offline",ESTIMATED_BW:"estimated-bw",USER_ACTIVE:"user-active",USER_IDLE:"user-idle"};n.default=r},{}],20:[function(e,t,n){"use strict";function r(e,t){return 0===t?e:r(t,e%t)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},{}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){var n=e?Object.create(e):{};if(!t)return n;for(var r in t)void 0===n[r]&&(n[r]=t[r]);return n}},{}],22:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./logger"),o=r(i),s=new o.default;n.default=s},{"./logger":23}],23:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../uuidv4"),a=r(s),l=["debug","error","info","warn","timing","deprecated"],u=function(){function e(){i(this,e),this.sessionKey=a.default(),this.sessionQueryString="sessionId="+this.sessionKey,this.host=null,this.setLevels(),this.publicKey=null,this.format=null,this.encoding=null,this.disable(),this.enable(),this.logEntries=[]}return o(e,[{key:"setLevels",value:function(e){var t=e||{};this.levels={debug:t.debug||!1,error:t.error||1,warn:t.warn||1,info:t.info||1,timing:t.timing||0}}},{key:"setPlayer",value:function(e,t,n,r,i){this.host=e,this.publicKey=t,this.format=n,this.encoding=r,this.driver=i}},{key:"checkSet",value:function(){return!this.host||!this.publicKey||!this.format}},{key:"levelIsSupported",value:function(e){return-1!==l.indexOf(e)}},{key:"log",value:function(e){var t;if(!this.levelIsSupported(e))return void this.log("error","unsupported log level",{level:e});if(this.levels[e]&&this.writer[e]&&this.writer[e].apply){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;n>i;i++)r[i-1]=arguments[i];(t=this.writer)[e].apply(t,r),this.apiLogging&&this.host&&this.publicKey&&this.pushBatch(r)}}},{key:"disable",value:function(){this.writer={};for(var e=0;e<l.length;e++)this.writer[l[e]]=function(){}}},{key:"enable",value:function(){window.console&&(this.writer=window.console,this.writer.timing=this.writer.info,this.writer.deprecated=this.writer.info)}},{key:"argJoin",value:function(e,t){for(var n=[e],r=0;r<t.length;r++)n.push(t[r]);return n}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];this.log.apply(this,["debug"].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];this.log.apply(this,["error"].concat(t))}},{key:"timing",value:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];this.log.apply(this,["timing"].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];this.log.apply(this,["info"].concat(t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];this.log.apply(this,["warn"].concat(t))}},{key:"deprecated",value:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];this.log.apply(this,["deprecated"].concat(t))}}]),e}();n.default=u},{"../uuidv4":37}],24:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("events"),c=r(u),h=e("xhr"),d=r(h),f=e("./errors"),p=r(f),v=e("./events"),y=r(v),m=e("./parse-url"),b=r(m),_=["aac","mp3"],g=["aac"],w=function(e){function t(e,n){i(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.currentState=y.default.OFFLINE,r.formats={},r.pingUri=null,r.options=n,r.host=r.options.host||window.location.protocol+"//"+window.location.host,r.setPublicId(e),r.publicId&&(r.options.pollingInterval=parseInt(r.options.pollingInterval,10),r.options.unauthorizedPollingInterval=parseInt(r.options.unauthorizedPollingInterval,10),r.options.unauthorizedRecoveryDuration=parseInt(r.options.unauthorizedRecoveryDuration,10)),r.setUri(e),r.shouldBePolling=!1,r}return s(t,e),l(t,[{key:"modifyFormats",value:function(e){for(var t in e)e[t].encodings&&e[t].encodings.length&&("mp4-ws"===t&&e[t].origin&&-1===g.indexOf(e[t].origin.audioCodec)?e[t].origin=null:"mp4-hls"===t&&e[t].origin&&-1===_.indexOf(e[t].origin.audioCodec)&&(e[t].origin=null));return e}},{key:"load",value:function(e,t){var n=this;return this.manifest||this.vod?(this.emit(y.default.MANIFEST,this.currentState),void(t&&t())):e||this.uri?("string"!=typeof e?(t=e,e=null):("http://"===e.slice(0,7)||"https://"===e.slice(0,8))&&(this.options.mediaLoaderUri=e),this.setUri(e)?void d.default({method:"GET",uri:this.uri,json:!0,useXDR:!0},function(e,r,i){var o=void 0;e?o=new Error(p.default.HTTP_SERVER_INTERNAL_ERROR):r.statusCode>499?o=new Error(p.default.HTTP_SERVER_INTERNAL_ERROR):404===r.statusCode?o=new Error(p.default.HTTP_SERVER_NOT_FOUND):403===r.statusCode?o=new Error(p.default.HTTP_SERVER_FORBIDDEN):401===r.statusCode?o=new Error(p.default.HTTP_SERVER_UNAUTHORIZED):r.statusCode>399?o=new Error(p.default.HTTP_SERVER_UNEXPECTED_STATUS_CODE):n.validateResponse(i)||(o=new Error(p.default.HTTP_SERVER_UNEXPECTED_RESPONSE)),o&&n.emit(y.default.ERROR,o.message,{statusCode:r.statusCode,body:i});var s=void 0;404!==r.statusCode&&i&&i.formats?200===r.statusCode&&(n.uri=i.self):s=y.default.OFFLINE,s||(n.formats=n.modifyFormats(i.formats),s=Object.keys(n.formats).length?y.default.ONLINE:y.default.OFFLINE),s!==n.currentState&&n.emit(s),n.currentState=s,n.pingUri=i&&i.ping?i.ping:null,n.type=i&&i.type?i.type:"live",n.emit(y.default.MANIFEST,n.currentState),n.setNextPoll(r.statusCode),t&&t()}):void(t&&t(new Error(p.default.INVALID_MEDIA_URL)))):void 0}},{key:"setNextPoll",value:function(e){var t=this;if(!this.vod){clearTimeout(this.pollingTimeout);var n=void 0;switch(e){case 401:case 403:this.noLongerUnauthorizedPolling?n=this.options.pollingInterval:(n=this.options.unauthorizedPollingInterval,this.unauthorizedRecoveryTimout||(this.unauthorizedRecoveryTimout=setTimeout(function(){t.noLongerUnauthorizedPolling=!0},this.options.unauthorizedRecoveryDuration)));break;default:this.noLongerUnauthorizedPolling=null,n=this.options.pollingInterval}this.pollingTimeout=setTimeout(function(){t.load()},n)}}},{key:"setPublicId",value:function(e){this.type=null,this.formats={},"string"==typeof e?this.publicId=e:e&&"object"===(void 0===e?"undefined":a(e))&&(this.manifest=e,this.currentState=y.default.ONLINE,this.type=this.manifest.type,this.formats=this.manifest.formats)}},{key:"validateResponse",value:function(e){return!(!e||"object"!==(void 0===e?"undefined":a(e)))&&"object"===a(e.formats)}},{key:"setUri",value:function(e){return e?this.options.mediaLoaderUri?(this.uri=this.options.mediaLoaderUri,!0):(this.uri=b.default(this.host).href,this.uri?(this.uri+=this.options.apiPrefix+"/"+e+this.options.apiSuffix,!0):(this.emit(y.default.ERROR,p.default.INVALID_MEDIA_URL),!1)):!!this.uri}},{key:"get",value:function(e){if(!this.formats[e])return{type:null,encodings:[],origin:null,manifest:null,audioCodec:null,videoCodec:null,state:y.default.ONLINE};var t=[];if(this.formats[e].encodings)t=this.formats[e].encodings.sort(function(e,t){return e.videoKbps+e.audioKbps>t.videoKbps+t.audioKbps?1:-1});else for(var n=Object.keys(this.formats[e]).filter(function(e){return!isNaN(e)}).sort(),r=0;r<n.length;r++)t.push(this.formats[e][n[r]]);var i=this.formats[e].origin;return i&&(i.origin=!0),{type:this.type,origin:i,encodings:t,audioCodec:this.formats[e].audioCodec,videoCodec:this.formats[e].videoCodec,manifest:this.formats[e].manifest,state:y.default.ONLINE}}},{key:"destroy",value:function(){clearInterval(this.pollingTimeout)}},{key:"startInterval",value:function(){return!this.options.pollingInterval||this.manifest||this.vod?void(this.shouldBePolling=!1):void(this.shouldBePolling=!0)}},{key:"vod",get:function(){return"recorded"===this.type}}]),t}(c.default);n.default=w},{"./errors":18,"./events":19,"./parse-url":25,events:50,xhr:60}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){var t=document.createElement("a");return t.href=e,!!t.pathname&&{href:t.href,protocol:t.protocol,port:t.port,pathname:t.pathname,search:t.search,host:t.host||window.location.host}}},{}],26:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("events"),c=r(u),h=e("./detect"),d=r(h),f=e("./logger"),p=r(f),v=e("./store"),y=r(v),m=e("./stats"),b=e("./media-loader"),_=r(b),g=e("./errors"),w=r(g),E=e("./events"),k=r(E),O=e("./gcd"),P=r(O),T=e("./get-default-options"),R=r(T);e("./polyfills");var L=e("./storage-values"),S=r(L),A=1800,j=600,x={autoplay:!0,bitrate:void 0,debug:!1,flashWmode:"transparent",flashFrameRate:60,fullscreenEl:"parent",forceDrivers:!1,formats:null,maxBufferLength:30,maxBufferSize:6e7,muted:void 0,pollingInterval:1e4,unauthorizedPollingInterval:1e3,unauthorizedRecoveryDuration:5e3,posterURI:null,preset:void 0,recoverErrorCount:10,recoverTimeout:4e3,startTime:0,viewUri:null,volume:.75,origin:!1,flashlsPath:"../dist/flashlsChromeless.swf",strobeSwfPath:"../dist/StrobeMediaPlayback.swf",tfSwfPath:"../dist/thin.swf",avpPath:"../dist/avp.swf",hlsjsPath:null},C=function(e){function t(e,n,r){i(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));switch(s.availableDrivers=[],void 0===e?"undefined":a(e)){case"string":s.el=document.querySelector(e);break;case"object":s.el=e;break;default:s.error(w.default.INVALID_EL)}if(s.options=R.default(r,x),s.store=new y.default,s.firstPlay=!0,void 0===s.options.muted){var l=s.store.get(S.default.muted);s.options.muted=null!==l?"true"===l:s.options.muted}var u=s.store.get(S.default.volume);s.options.volume=isNaN(parseFloat(u))?s.options.volume:parseFloat(u),s.options.bitrate&&!parseInt(s.options.bitrate,10)&&(s.error(w.default.INVALD_BITRATE),s.options.bitrate=void 0),void 0!==s.options.bitrate&&s.storeBitrate(s.options.bitrate);var c=parseInt(s.store.get(S.default.lockedKbps),10);if(s.options.bitrate=c||parseInt(s.options.bitrate,10)||null,s.estimatedKbps=parseInt(s.store.get(S.default.estimatedKbps),10)||A,s.isTryingToPlay=!1,s.shouldTryToPlay=s.options.autoplay,s.options.debug?p.default.setLevels({debug:!0,error:1,warn:1,info:1,timing:1}):p.default.setLevels(),s.trackFirstProgress(),s.options.mediaLoaderUri&&p.default.deprecated("mediaLoaderUri","second argument may now take a uri or publicId"),n)if("string"==typeof n)("http://"===n.slice(0,7)||"https://"===n.slice(0,8))&&(s.options.mediaLoaderUri=n);else if("object"===(void 0===n?"undefined":a(n)))s.options.mediaLoaderUri=n;else if(null!==n)return p.default.error("invalid manifest",n),o(s);if(!Array.isArray(s.options.drivers))return p.default.error("invalid drivers, must be an array",s.options.drivers),o(s);for(var h=0;h<s.options.drivers.length;h++)if("function"!=typeof s.options.drivers[h])return p.default.error("invalid drivers, each driver must type function, check driver at index "+h),o(s);return!s.options.hijackingClicks&&s.options.autoplay&&d.default.modernMobile()&&(s.options.muted=!0),s.mediaLoader=s.options.mediaLoader||new _.default(n,s.options),s.setDrivers(s.options.drivers),s.mediaLoader.on(k.default.ERROR,s.eventHandler(k.default.ERROR).bind(s)),s.mediaLoader.on(k.default.MANIFEST,s.eventHandler(k.default.MANIFEST).bind(s)),s.mediaLoader.on(k.default.MANIFEST,function(){return s.mediaLoader.currentState===k.default.ONLINE?s.watchForAudioSwitch()?(s.currentDriver.options.origin=!1,void s.currentDriver.restart()):void(s.shouldTryToPlay&&s.currentDriver&&(s.play(function(e){e&&(s.shouldTryToPlay=!1)}),s.currentDriver.supportsAutoplay||(s.shouldTryToPlay=!1))):void 0}),s.mediaLoader.on(k.default.ONLINE,function(){s.emit(k.default.ONLINE)}),s.mediaLoader.on(k.default.OFFLINE,function(){s.tryingToPlay&&(s.shouldTryToPlay=!0),s.emit(k.default.OFFLINE)}),s.mediaLoader.load(),s.mediaLoader.startInterval&&s.mediaLoader.startInterval(),s.options.autoplay&&s.currentDriver&&s.currentDriver.elementPlay&&s.currentDriver.elementPlay(),s}return s(t,e),l(t,[{key:"trackFirstProgress",value:function(){var e=this;this.options.autoplay&&(this.autoplayProgressId=m.stats.start(m.STATS_EVENTS.AUTOPLAY_PROGRESS),this.once(k.default.MEDIA_TIMEUPDATE,function(){m.stats.stop(e.autoplayProgressId,{driver:e.currentDriver.driver})}))}},{key:"watchForAudioSwitch",value:function(){return!(!this.currentDriver||!this.currentDriver.options.origin||this.mediaLoader.get(this.currentDriver.format).origin)}},{key:"setOption",value:function(e,t){this.options[e]=t,this.currentDriver&&this.currentDriver.setOption(e,t)}},{key:"load",value:function(e,t){this.stop(),this.mediaLoader.setPublicId(e),this.mediaLoader.load(e,t)}},{key:"destroy",value:function(){this.mediaLoader&&this.mediaLoader.destroy&&(this.mediaLoader.removeAllListeners(k.default.MANIFEST),this.mediaLoader.destroy());var e=void 0;if(this.currentDriver){for(e in k.default)this.currentDriver.removeAllListeners(k.default[e]),this.currentDriver.removeAllListeners(k.default[e],this.eventHandler(k.default[e]));this.currentDriver.destroy()}this.removeAllListeners(k.default.MEDIA_PROGRESS),this.emit(k.default.DESTROY)}},{key:"storeBitrate",value:function(e){this.store.set(S.default.lockedKbps,e)}},{key:"playOrigin",value:function(){this.options.origin=!0,this.store.set(S.default.origin,1),this.store.set(S.default.lockedKbps,null),this.currentDriver&&this.currentDriver.playOrigin()}},{key:"restart",value:function(){var e=this.tryingToPlay;this.stop(),this.shouldTryToPlay=e,this.mediaLoader.load()}},{key:"switchDrivers",value:function(e){this.options.drivers=e,this.setDrivers(e),this.restart()}},{key:"getState",value:function(){return this.mediaLoader.currentState}},{key:"eventHandler",value:function(e){var t=this;return function(){for(var n=arguments.length,r=Array(n),i=0;n>i;i++)r[i]=arguments[i];("error"!==e||t._events&&t._events.hasOwnProperty("error"))&&t.emit.apply(t,[e].concat(r))}}},{key:"error",value:function(e,t){(!this._events||this._events.hasOwnProperty("error"))&&this.emit(k.default.ERROR,e,t),p.default.warn(e)}},{key:"setDrivers",value:function(e){var t=void 0;this.availableDrivers=[];for(var n=0;n<e.length;n++)t=e[n],t&&t.isSupported()?(this.options.forceDrivers||t.isSupported())&&this.availableDrivers.push(t):p.default.debug("driver at index "+n+" is not supported");return this.availableDrivers.length?void(this.driver=0):void this.noDrivers()}},{key:"pause",value:function(){this.isTryingToPlay=!1,this.currentDriver&&this.currentDriver.pause(),this.emit(k.default.MEDIA_PAUSE)}},{key:"noDrivers",value:function(){this.mediaLoader.currentState===k.default.ONLINE&&this.error(w.default.NO_DRIVERS)}},{key:"play",value:function(){var e=this;return this.currentDriver?(this.isTryingToPlay=!0,void this.currentDriver.play(function(t){return t?(e.shouldTryToPlay=!1,"true"===e.store.get(S.default.muted)&&e.currentDriver.mute(),e.firstPlay&&e.vod&&e.options.startTime&&(e.currentDriver.currentTime=e.options.startTime),e.isTryingToPlay=!0,void(e.mediaLoader.state!==k.default.OFFLINE&&(e.emit(k.default.MEDIA_PLAY),e.firstPlay=!1))):void(e.isTryingToPlay=!1)})):void this.noDrivers()}},{key:"stop",value:function(){this.isTryingToPlay=!1,this.currentDriver&&this.currentDriver.stop(),this.emit(k.default.MEDIA_STOP)}},{key:"isTryingToPlayAudio",value:function(){return this.currentDriver?this.currentDriver.isTryingToPlayAudio(this.tryingToPlay):this.tryingToPlay}},{key:"mute",value:function(){if(!this.currentDriver)return this.noDrivers(),null;var e=this.currentDriver.mute();return this.store.set(S.default.muted,String(e)),this.emit(k.default.MEDIA_MUTE),e}},{key:"unmute",value:function(){if(!this.currentDriver)return this.noDrivers(),null;var e=this.currentDriver.unmute();return this.store.set(S.default.muted,String(e)),this.emit(k.default.MEDIA_UNMUTE),e}},{key:"currentEncoding",value:function(){return this.currentDriver?this.currentDriver.pickEncoding():void 0}},{key:"supportsFullscreen",value:function(){return this.currentDriver?this.currentDriver.supportsFullscreen():null}},{key:"supportsVolume",value:function(){return this.currentDriver?this.currentDriver.supportsVolume():null}},{key:"manifest",get:function(){return this.mediaLoader&&this.mediaLoader.uri?this.mediaLoader.uri:null}},{key:"bitrate",set:function(e){this.storeBitrate(e),this.currentDriver.bitrate=e}},{key:"driver",set:function(e){var t=this;if(!this.availableDrivers[e])return void this.noDrivers();var n=this.availableDrivers[e];this.currentDriver&&this.currentDriver.destroy(),this.currentDriver=new n(this,this.mediaLoader,{bitrate:this.options.bitrate,estimatedKbps:this.estimatedKbps,volume:this.options.volume,muted:this.options.muted,debug:this.options.debug,recoverTimeout:this.options.recoverTimeout,recoverErrorCount:this.options.recoverErrorCount,maxBufferLength:this.options.maxBufferLength,maxBufferSize:this.options.maxBufferSize,preset:this.options.preset,flashlsPath:this.options.flashlsPath,tfSwfPath:this.options.tfSwfPath,strobeSwfPath:this.options.strobeSwfPath,avpPath:this.options.avpPath,hlsjsPath:this.options.hlsjsPath,posterURI:this.options.posterURI,flashFrameRate:this.options.flashFrameRate,flashWmode:this.options.flashWmode,origin:this.options.origin,mse:this.options.mse}),this.currentDriver.on(k.default.ERROR,function(n){var r=function(){return t.availableDrivers.length?(t.currentDriver.destroy(),t.availableDrivers.splice(e,1),t.driver=e,void(t.tryingToPlay&&t.play())):void t.mediaLoader.once(k.default.MANIFEST,function(){t.setDrivers(t.options.drivers),t.isTryingToPlay()&&t.play()})};switch(n){case w.default.EMBED_SWF_FAILED:r();break;case w.default.DRIVER_NOT_SUPPORTED:r()}}),this.emit(k.default.SELECT_DRIVER,this.currentDriver),this.currentDriver.on(k.default.ESTIMATED_BW,function(e){t.store.set(S.default.estimatedKbps,parseInt(e,10)||j)}),this.currentDriver.on(k.default.MEDIA_ENDED,function(){t.isTryingToPlay=!1});for(var r in k.default)this.currentDriver.on(k.default[r],this.eventHandler(k.default[r]))}},{key:"duration",get:function(){return this.currentDriver?this.currentDriver.duration:1/0}},{key:"vod",get:function(){return this.mediaLoader?this.mediaLoader.vod:null}},{key:"bufferLength",get:function(){return this.currentDriver?this.currentDriver.bufferLength:0}},{key:"backBufferLength",get:function(){return this.currentDriver?this.currentDriver.backBufferLength:0}},{key:"currentTime",get:function(){return this.currentDriver?this.currentDriver.currentTime:0},set:function(e){this.currentDriver&&(this.currentDriver.currentTime=e)}},{key:"bufferTimes",get:function(){return this.currentDriver?this.currentDriver.bufferTimes:[]}},{key:"tryingToPlay",get:function(){return!!this.isTryingToPlay}},{key:"muted",get:function(){return this.currentDriver?this.currentDriver.muted:(this.noDrivers(),null)}},{key:"mediaData",get:function(){return this.currentDriver?this.currentDriver.data:null}},{key:"allMediaData",get:function(){for(var e=this.availableDrivers,t=[],n=void 0,r=0;r<e.length;r++)if(n=e[r],n.isSupported&&n.isSupported(this.el)){var i=this.mediaLoader.get(n.format);if(!i.manifest)continue;i.driver=n.driver,t.push(i)}return t}},{key:"volume",set:function(e){if(this.currentDriver){var t=this.currentDriver.volume=e;return this.store.set(S.default.muted,0===t),this.store.set(S.default.volume,t),this.emit(k.default.MEDIA_VOLUME,t),t}},get:function(){return this.currentDriver?this.currentDriver.volume:0}},{key:"details",get:function(){return this.currentDriver?this.currentDriver.details:{}}},{key:"chosenLevel",get:function(){return this.currentDriver?this.currentDriver.chosenLevel:void 0}},{key:"currentLevel",get:function(){return this.currentDriver?this.currentDriver.currentLevel:void 0}},{key:"nextLevel",get:function(){return this.currentDriver?this.currentDriver.nextLevel:void 0}},{key:"aspectRatio",get:function(){if(!this.currentDriver)return null;var e=this.currentDriver.data;if(!e)return null;if(!e.encodings||!e.encodings.length)return null;if(!e.encodings[0].videoWidth||!e.encodings[0].videoHeight)return null;var t=P.default(e.encodings[0].videoWidth,e.encodings[0].videoHeight);return{width:e.encodings[0].videoWidth/t,height:e.encodings[0].videoHeight/t}}}]),t}(c.default);n.default=C},{"./detect":17,"./errors":18,"./events":19,"./gcd":20,"./get-default-options":21,"./logger":22,"./media-loader":24,"./polyfills":27,"./stats":29,"./storage-values":31,"./store":36,events:50}],27:[function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};"remove"in window.Element.prototype||(window.Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),"function"!=typeof Object.create&&(Object.create=function(e){var t=function(){};return function(n,r){if(n===Object(n)||null===n){t.prototype=n||{},r!==e&&Object.defineProperties(t.prototype,r);var i=new t;return t.prototype=null,i}}}()),function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),i=window.setTimeout(function(){t(n+r)},r);return e=n+r,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),function(e){var t=Date.now?Date.now():+new Date;e.performance=e.performance||{},e.performance.now=e.performance.webkitNow||e.performance.mozNow||e.performance.msNow||function(){return(Date.now?Date.now():+new Date)-t}}(window),Object.keys||(Object.keys=function(){var t=Object.prototype.hasOwnProperty,n=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],i=r.length;return function(o){if("object"===(void 0===o?"undefined":e(o))||"function"==typeof o&&null!==o){var s=[],a=void 0,l=void 0;for(a in o)t.call(o,a)&&s.push(a);if(n)for(l=0;i>l;l++)t.call(o,r[l])&&s.push(r[l]);return s}}}()),"document"in self&&("classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))?function(){var e=document.createElement("_");if(e.classList.add("c1","c2"),!e.classList.contains("c2")){var t=function(e){var t=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){var n,r=arguments.length;for(n=0;r>n;n++)e=arguments[n],t.call(this,e)}};t("add"),t("remove")}if(e.classList.toggle("c3",!1),e.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:n.call(this,e)}}e=null}():function(e){if("Element"in e){var t="classList",n="prototype",r=e.Element[n],i=Object,o=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},s=Array[n].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},a=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},l=function(e,t){if(""===t)throw new a("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new a("INVALID_CHARACTER_ERR","String contains an invalid character");return s.call(e,t)},u=function(e){for(var t=o.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],r=0,i=n.length;i>r;r++)this.push(n[r]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},c=u[n]=[],h=function(){return new u(this)};if(a[n]=Error[n],c.item=function(e){return this[e]||null},c.contains=function(e){return e+="",-1!==l(this,e)},c.add=function(){var e,t=arguments,n=0,r=t.length,i=!1;do e=t[n]+"",-1===l(this,e)&&(this.push(e),i=!0);while(++n<r);i&&this._updateClassName()},c.remove=function(){var e,t,n=arguments,r=0,i=n.length,o=!1;do for(e=n[r]+"",t=l(this,e);-1!==t;)this.splice(t,1),o=!0,t=l(this,e);while(++r<i);o&&this._updateClassName()},c.toggle=function(e,t){e+="";var n=this.contains(e),r=n?t!==!0&&"remove":t!==!1&&"add";return r&&this[r](e),t===!0||t===!1?t:!n},c.toString=function(){return this.join(" ")},i.defineProperty){var d={get:h,enumerable:!0,configurable:!0};try{i.defineProperty(r,t,d)}catch(e){-2146823252===e.number&&(d.enumerable=!1,i.defineProperty(r,t,d))}}else i[n].__defineGetter__&&r.__defineGetter__(t,h)}}(self))},{}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={AUTOPLAY_PROGRESS:"autoplay-first-progress",FIRST_LOAD:"first-load"};n.default=r},{}],29:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.STATS_EVENTS=n.stats=void 0;var i=e("./stats"),o=r(i),s=e("./events"),a=r(s),l=new o.default;n.stats=l,n.STATS_EVENTS=a.default},{"./events":28,"./stats":30}],30:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../logger"),a=r(s),l=function(){function e(){i(this,e),this.eventCounter=0,this.timings={}}return o(e,[{key:"start",value:function(e){var t=this.eventCounter++;return this.timings[t]={ms:Date.now(),name:e},t}},{key:"stop",value:function(e,t){if(this.timings[e]){var n=t||{};n.ms=Date.now()-this.timings[e].ms,a.default.timing(this.timings[e].name,n),delete this.timings[e]}}}]),e}();n.default=l},{"../logger":22}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={muted:"lv_muted",volume:"lv_volume",lockedKbps:"lv_locked_kbps",estimatedKbps:"lv_estimated_kbps",autoLastKbps:"lv_auto_last_kbps",hideSuggestion:"lv_hide_suggestion",origin:"lv_origin",profile:"lv_origin"};n.default=r},{}],32:[function(e,t,n){"use strict";function r(e,t){}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e)}return i(e,[{key:"set",value:function(){console.error("an abstract method has been called")}},{key:"get",value:function(){console.error("an abstract method has been called")}}]),e}();n.default=o},{}],33:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(t,n){return Array.isArray(t)?t:Symbol.iterator in Object(t)?e(t,n):void 0}}(),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("./base-driver"),c=r(u),h=new RegExp("\\s*;\\s*"),d=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),l(t,[{key:"parse",value:function(e){var t={};return e?(e.split(h).forEach(function(e){var n=e.split("="),r=a(n,2),i=r[0],o=r[1],s=decodeURIComponent(i),l=decodeURIComponent(o);t[s]=l}),t):t}},{key:"stringify",value:function(e){var t=[];for(var n in e)({}).hasOwnProperty.call(e,n)&&t.push(n+"="+e[n]);return t.join("; ")}},{key:"set",value:function(e,t){document.cookie=e+"="+t}},{key:"get",value:function(e){return this.parse(document.cookie)[e]||null}}]),t}(c.default);n.default=d},{"./base-driver":32}],34:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("./base-driver"),u=r(l),c=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),a(t,[{key:"set",value:function(e,t){try{window.localStorage.setItem(e,t)}catch(e){}}},{key:"get",value:function(e){var t=null;try{t=window.localStorage.getItem(e)||null}catch(e){}return t}}]),t}(u.default);n.default=c},{"./base-driver":32}],35:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("./base-driver"),u=r(l),c={},h=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),a(t,[{key:"set",value:function(e,t){c[e]=t}},{key:"get",value:function(e){return c[e]||null}}]),t}(u.default);n.default=h},{"./base-driver":32}],36:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./drivers/cookie"),a=r(s),l=e("./drivers/local-storage"),u=r(l),c=e("./drivers/memory"),h=r(c),d=function(){function e(){i(this,e);try{if(window.localStorage)return void(this.driver=new u.default)}catch(e){}try{if("string"==typeof document.cookie)return void(this.driver=new a.default)}catch(e){}this.driver=new h.default}return o(e,[{key:"set",value:function(e,t){this.driver&&this.driver.set(e,t)}},{key:"get",value:function(e){return this.driver?this.driver.get(e):void 0}}]),e}();n.default=d},{"./drivers/cookie":33,"./drivers/local-storage":34,"./drivers/memory":35}],37:[function(e,t,n){"use strict";function r(){for(var e,t=0;16>t;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}function i(e,t){var n=t||0,r=s;return r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]}Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){var e=r();return e[6]=15&e[6]|64,e[8]=63&e[8]|128,i(e)};for(var o=new Array(16),s=[],a={},l=0;256>l;l++)s[l]=(l+256).toString(16).substr(1),a[s[l]]=l},{}],38:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("@livelyvideo/player-core/lib/base-driver"),u=r(l),c=e("@livelyvideo/player-core/lib/logger"),h=r(c),d=e("@livelyvideo/player-core/lib/events"),f=r(d),p=e("@livelyvideo/player-core/lib/errors"),v=r(p),y=e("swfobject-amd"),m=r(y),b=e("lodash.noop"),_=r(b),g=e("./thinflash/broadcast"),w=r(g),E=e("./thinflash/playback"),k=r(E),O=300,P="11.0.0",T="aiw-swf-uniqid",R=0,L=function(e){function t(e,n,r){i(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));return s.options.bitrate||(s.options.bitrate=s.options.estimatedKbps),s.el=e.el,s.fragCounts=0,s.fragSize=0,s.fragDuration=0,s.fragDownloadTime=0,s.fragMaxTime=0,s.fragMinTime=0,s.bufferOverflowCount=0,s.bufferUnderflowCount=0,s.upshift=0,s.downshift=0,s.lastProgress=0,s.currentErrorCount=0,s.recentErrorCount=0,s.errors={},s.livelyPlayer=e,s.mediaLoader=n,s.options=r,s.el.volume=s.options.volume,s.el.muted=s.options.muted,s.selectedEncoding=null,s.swf=null,s.isStopped=!0,s.playing={},s.hasStarted=!1,s.broadcastId=-1,s.currentVolume=r.volume,s.currentMuted=r.muted,s.id=R++,s.render(),s.setupThinflash(),s}return s(t,e),a(t,[{key:"render",value:function(){this.obj=document.createElement("div"),this.el.appendChild(this.obj),this.obj.setAttribute("class","aiw-swf-container"),this.obj.setAttribute("id",T+"-"+this.id)}},{key:"handleTFError",value:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];this.emit.apply(this,[f.default.ERROR].concat(t))}},{key:"setupThinflash",value:function(){var e=this;this.thinBroadcast=w.default,this.thinBroadcast.logError=this.handleTFError.bind(this),this.thinBroadcast.getSwf=function(){return e.swf},this.thinPlayback=k.default,this.thinPlayback.logError=this.handleTFError.bind(this),this.thinPlayback.getSwf=function(){return e.swf},this.tfIsReadyCbs=[],window.tfSendToJavaScript=function(t,n,r){t===e.obj.getAttribute("id")&&e.emit(r[1],r[0],r.slice(2))},window.tfIsReady=function(){return!0}}},{key:"createAndPlay",value:function(){var e=this;this.createBroadcast(),this.connectToBroadcast(this.playing,function(){e.progressCounter=0,e.startPlayback()})}},{key:"shouldBePlaying",value:function(){return!!this.rtmpSrc}},{key:"startPlayback",value:function(){this.thinPlayback.playbackPlay(this.broadcastId),this.thinPlayback.setVolume(this.broadcastId,this.currentVolume),this.thinPlayback.muteAudio(this.broadcastId,this.currentMuted)}},{key:"watchProgress",value:function(e){var t=this;clearInterval(this.recoveryInterval),this.progressCounter=0,this.recoveryInterval=setInterval(function(){if(!(t.broadcastId<0)&&t.livelyPlayer.tryingToPlay){var n=t.livelyPlayer.details;if(n.currentBytesPerSecond>0&&t.progressCounter++,!n.currentBytesPerSecond&&t.livelyPlayer.tryingToPlay)return void(t.errorTimeout||(t.errorTimeout=setTimeout(function(){n=t.livelyPlayer.details,t.errorTimeout=null,t.broadcastId<0||!n.currentBytesPerSecond&&t.progressCounter>0&&(t.destroyBroadcast(),t.createAndPlay(),t.emit(f.default.ERROR,v.default.NETWORK_ERROR))},10*e)));t.emitProgress(),n.playbackBytesPerSecond>0&&t.emitTimeupdate(),clearTimeout(t.errorTimeout),t.errorTimeout=null}},e)}},{key:"onceTfIsReady",value:function(e){return this.swf&&this.swf.tfBroadcastCreate?void e():(this.tfIsReadyCbs.push(e),void this.pollTf())}},{key:"pollTf",value:function(){var e=this;this.pollingTf||(this.pollingTfAttempts=0,clearInterval(this.pollingTf),this.pollingTf=setInterval(function(){if(++e.pollingTfAttempts>30)return clearInterval(e.pollingTf),void e.emit(f.default.ERROR,v.default.EMBED_SWF_FAILED,"timeout");if(e.swf&&e.swf.tfBroadcastCreate){clearInterval(e.pollingTf);for(var t=e.tfIsReadyCbs.shift();t;)t(),t=e.tfIsReadyCbs.shift()}},20))}},{key:"pause",value:function(){this.stop()}},{key:"stop",value:function(){clearInterval(this.recoveryInterval),clearTimeout(this.watchLessTimeout),this.broadcastId&&(this.removeListener(f.default.MEDIA_PROGRESS,this.watchProgress),this.isStopped=!0,this.swf&&this.swf.tfPlaybackPlay&&this.thinPlayback.playbackPlay(this.broadcastId,!1),this.destroyBroadcast())}},{key:"destroy",value:function(){this.destroyed=!0,clearInterval(this.recoveryInterval),clearTimeout(this.watchLessTimeout),this.thinBroadcast.logError=null,this.thinPlayback.logError=null,this.obj.remove(),this.swf&&this.swf.remove()}},{key:"unmute",value:function(){return this.currentMuted=!1,this.thinPlayback.muteAudio(this.broadcastId,!1),!1}},{key:"mute",value:function(){return this.currentMuted=!0,this.thinPlayback.muteAudio(this.broadcastId,!0),!0}},{key:"enterFullscreen",value:function(){this.swf.requestFullscreen?this.swf.requestFullscreen():this.swf.mozRequestFullScreen?this.swf.mozRequestFullScreen():this.swf.webkitRequestFullScreen?this.swf.webkitRequestFullScreen():this.swf.msRequestFullscreen&&this.swf.msRequestFullscreen()}},{key:"getReady",value:function(e){var t=this;this.whenReady(function(){return t.swf?void e(t.swf):void m.default.embedSWF(t.options.tfSwfPath,t.obj.getAttribute("id"),"100%","100%",P,"/dist/expressInstall.swf",{framerate:t.options.flashFrameRate,tfID:t.obj.getAttribute("id")},{scale:"noscale",quality:"high",allowscriptaccess:"always",allowfullscreen:"true",wmode:t.options.flashWmode,bgcolor:"#000000",align:"middle",salign:"TL",menu:"true",id:t.obj.getAttribute("id")},{id:t.obj.getAttribute("id"),class:"tf-content"},function(n){t.swf=n.ref,t.onceTfIsReady(function(){e(n)})})})}},{key:"pickEncoding",value:function(){var e=this.options.bitrate||this.options.estimatedKbps,t=this.data.encodings;if(!t.length)return null;var n=void 0;for(n=0;n<t.length&&!(t[n].videoWidth&&t[n].videoKbps+t[n].audioKbps>e);n++);return n=Math.max(n-1,0),t[n]}},{key:"destroyBroadcast",value:function(){this.broadcastId>=0&&this.thinBroadcast.destroyBroadcast(this.broadcastId)&&(this.broadcastId=-1)}},{key:"createBroadcast",value:function(){return this.broadcastId<0&&(this.broadcastId=this.thinBroadcast.createBroadcast(),!this.broadcastId)?void(this.broadcastId=-1):void 0}},{key:"connectToBroadcast",value:function(e,t){this.thinBroadcast.connectToBroadcast(this.broadcastId,e.prefix,e.video),this.once("NetConnection.Connect.Success",t)}},{key:"play",value:function(e){var t=this,n=e||_.default,r=this.rtmpSrc;return r?void(this.destroyed||(this.playing={prefix:r.prefix,video:r.video},this.getReady(function(e){return e.success||t.swf?t.mediaLoader.vod?void t.emit(f.default.ERROR,v.default.DRIVER_NOT_SUPPORTED):(t.destroyBroadcast(),t.createBroadcast(),void t.connectToBroadcast(t.playing,function(){h.default.setPlayer(t.mediaLoader.host,t.mediaLoader.publicId,t.format,t.selectedEncoding.location,t),t.startPlayback(),t.once("progress",function(){n&&n(!0),n=null}),setTimeout(function(){n&&n(!1)},2e3),t.watchProgress(O)})):void t.emit(f.default.ERROR,v.default.EMBED_SWF_FAILED)}))):void(this.mediaLoader.currentState===f.default.ONLINE&&this.emit(f.default.ERROR,v.default.DRIVER_NOT_SUPPORTED))}},{key:"supportsAutoplay",get:function(){return!0}},{key:"bufferTimes",get:function(){return[]}},{key:"data",get:function(){return this.mediaLoader.get(this.format)}},{key:"rtmpSrc",get:function(){if(this.selectedEncoding=this.pickEncoding(),!this.selectedEncoding)return null;var e=this.selectedEncoding.location.split(/\//),t=e.splice(e.length-1,1)[0];return{prefix:e.join("/")+"/",video:t}}},{key:"stopped",get:function(){return this.isStopped}},{key:"muted",get:function(){return this.currentMuted}},{key:"paused",get:function(){return this.isStopped()}},{key:"volume",get:function(){return this.currentVolume},set:function(e){return e?(this.currentVolume=e,this.thinPlayback.setVolume(this.broadcastId,e),this.currentVolume>0&&this.unmute(),e):this.currentVolume}},{key:"bitrate",set:function(e){var t=this;this.options.bitrate=e,this.stop(),this.play(function(e){e&&t.emit(f.default.BITRATE_SWITCH)})}},{key:"details",get:function(){var e={};try{this.swf&&this.swf.tfGetNetStreamProperty&&this.broadcastId>0&&(e=this.swf.tfGetNetStreamProperty(this.broadcastId,"info"))}catch(e){this.livelyPlayer.tryingToPlay&&this.checkRestart({fatal:!1,reason:"swf not loaded yet"})}return e=e||{},e.volume=this.currentVolume,e.muted=this.currentMuted,e}}],[{key:"isSupported",value:function(){return m.default.hasFlashPlayerVersion(P)}},{key:"driver",get:function(){return"flashRtmp"}},{key:"format",get:function(){return"mp4-rtmp"}}]),t}(u.default);n.default=L},{"./thinflash/broadcast":39,"./thinflash/playback":40,"@livelyvideo/player-core/lib/base-driver":16,"@livelyvideo/player-core/lib/errors":18,"@livelyvideo/player-core/lib/events":19,"@livelyvideo/player-core/lib/logger":22,"lodash.noop":54,"swfobject-amd":57}],39:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@livelyvideo/player-core/lib/logger"),o=r(i);n.default={createBroadcast:function(){try{return this.getSwf().tfBroadcastCreate()}catch(e){return o.default.error("broadcast","createBroadcast",[],"error initializing broadcast [err="+e+"]"),!1}},destroyBroadcast:function(e){try{this.getSwf().tfBroadcastDestroy(e)}catch(t){return o.default.error("broadcast","destroyBroadcast",[e],"error destroying broadcast [err="+t+"]"),!1}return!0},connectToBroadcast:function(e,t,n){try{var r;(r=this.getSwf()).tfBroadcastConnect.apply(r,arguments)}catch(r){return o.default.error("broadcast","connectToBroadcast",[e,t,n],"error connecting to broadcast [err="+r+"]"),!1}return!0}}},{"@livelyvideo/player-core/lib/logger":22}],40:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@livelyvideo/player-core/lib/logger"),o=r(i);n.default={playbackPlay:function(e,t){try{this.getSwf().tfPlaybackPlay(e,t)}catch(n){return o.default.error("playback","playbackPlay",[e,t],"error playing video [err="+n+"]"),!1}return!0},setVolume:function(e,t){try{this.getSwf().tfPlaybackSetVolume(e,t)}catch(n){return o.default.error("playback","setVolume",[e,t],"error setting volume [err="+n+"]"),!1}return!0},muteAudio:function(e,t){try{this.getSwf().tfPlaybackMute(e,t)}catch(n){return o.default.error("playback","muteAudio",[e,t],"error muting audio [err="+n+"]"),!1}return!0},getNetStreamProperty:function(e,t){try{return this.getSwf().tfGetNetStreamProperty(e,t)}catch(n){return o.default.error("playback","getNetStreamProperty",[e,t],"error getting NetStream property [err="+n+"]"),!1}}}},{"@livelyvideo/player-core/lib/logger":22}],41:[function(e,t,n){"use strict";function r(e,t){}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=8,s=function(){function e(t){r(this,e),t.on(window.Hls.Events.FRAG_LOADING,this.onFragLoading.bind(this)),t.on(window.Hls.Events.FRAG_LOAD_PROGRESS,this.onFragLoadProgress.bind(this)),t.on(window.Hls.Events.FRAG_LOADED,this.onFragLoaded.bind(this)),t.on(window.Hls.Events.ERROR,this.onError.bind(this)),this.lastLoadedFragLevel=0,this._autoLevelCapping=-1,this._nextAutoLevel=-1,this.hls=t,this.onCheck=this.checkFragProgress.bind(this),this.lastBws=[],this.lastBw=0,this.lastCalculated=0}return i(e,[{key:"getCurrentLevel",value:function(){return this.fragCurrent}},{key:"getNextLevel",value:function(){return this.nextAutoLevel}},{key:"destroy",value:function(){this.clearTimer()}},{key:"onFragLoading",value:function(e,t){this.clearTimer(this.timer),this.timer=setInterval(this.onCheck,100),this.fragCurrent=t.frag}},{key:"calculateLastBw",value:function(){this.lastCalculated=Date.now(),this.lastBws.splice(o);for(var e=0,t=0;t<this.lastBws.length;t++)e+=this.lastBws[t];e=Math.floor(e/this.lastBws.length),this.lastBw=e}},{key:"addBw",value:function(e){this.lastBws.unshift(e),this.calculateLastBw()}},{key:"onFragLoadProgress",value:function(e,t){if(!(this.lastBws.length>o/2)){this.lastfetchduration=(window.performance.now()-t.stats.trequest)/1e3;var n=8*t.stats.loaded/this.lastfetchduration;n&&this.addBw(n)}}},{key:"bufferedInfo",value:function(e,t,n){var r=[],i=void 0,o=void 0,s=void 0,a=void 0,l=void 0;for(e.sort(function(e,t){var n=e.start-t.start;return n?n:t.end-e.end}),l=0;l<e.length;l++){var u=r.length;if(u){var c=r[u-1].end;e[l].start-c<n?e[l].end>c&&(r[u-1].end=e[l].end):r.push(e[l])}else r.push(e[l])}if(r.length&&t<r[0].start)return{len:0,start:t,end:t,nextStart:r[0].start};for(l=0,i=0,o=s=t;l<r.length;l++){var h=r[l].start,d=r[l].end;if(t+n>=h&&d>t)o=h,s=d,i=s-t;else if(h>t+n){a=h;break}}return{len:i,start:o,end:s,nextStart:a}}},{key:"bufferInfo",value:function(e,t,n){if(e){var r=e.buffered,i=[],o=void 0;for(o=0;o<r.length;o++)i.push({start:r.start(o),end:r.end(o)});return this.bufferedInfo(i,t,n)}return{len:0,start:0,end:0,nextStart:void 0}}},{key:"checkFragProgress",value:function(){var e=this.hls,t=e.media,n=this.fragCurrent;if(t&&!t.paused&&t.readyState&&n.autoLevel&&n.level){var r=window.performance.now()-n.trequest;if(!(r<=500*n.duration)){var i=Math.max(1,1e3*n.loaded/r);n.expectedLen<n.loaded&&(n.expectedLen=n.loaded);var o=t.currentTime,s=(n.expectedLen-n.loaded)/i,a=this.bufferInfo(t,o,e.config.maxBufferHole).end-o;if(4*a<n.duration&&s>a){var l=void 0,u=void 0;for(u=n.level-1;u>=0&&(l=n.duration*e.levels[u].bitrate/(5.6*i),!(a>l));u--);s>l&&(u=Math.max(0,u),e.nextLoadLevel=u||0,n.loader.abort(),this.clearTimer(),e.trigger(window.Hls.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n}))}}}}},{key:"emergencyDrop",value:function(){this.hls.nextLoadLevel=Math.max(0,this.fragCurrent.level-1)||0,this.hls.nextLoadLevel>=this.fragCurrent.level||(this.clearTimer(),this.hls.trigger(window.Hls.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:this.fragCurrent}))}},{key:"onFragLoaded",value:function(e,t){this.lastfetchduration=(window.performance.now()-t.stats.trequest)/1e3;var n=8*t.stats.loaded/this.lastfetchduration;n&&this.addBw(n),this.clearTimer(),this.lastLoadedFragLevel=t.frag.level,this._nextAutoLevel=-1}},{key:"onError",value:function(){this.clearTimer()}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping=e}},{key:"nextAutoLevel",get:function(){var e=this.lastBw,t=this.hls,n=void 0,r=void 0;if(!t.levels)return-1;if(-1!==this._autoLevelCapping||!t.levels)return Math.min(this._autoLevelCapping,t.levels.length-1);if(r=t.levels.length-1,-1!==this._nextAutoLevel)return Math.min(this._nextAutoLevel,r,t.levels.length-1);for(n=0;r>=n;n++)if(.7*e<t.levels[n].bitrate)return Math.max(0,n-1);return n-1},set:function(e){this._nextAutoLevel=e}}]),e}();n.default=s},{}],42:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var s=i.get;return void 0===s?void 0:s.call(r)},u=e("@livelyvideo/player-core/lib/base-driver"),c=r(u),h=e("@livelyvideo/player-core/lib/detect"),d=r(h),f=e("@livelyvideo/player-core/lib/logger"),p=r(f),v=e("@livelyvideo/player-core/lib/events"),y=r(v),m=e("@livelyvideo/player-core/lib/errors"),b=r(m),_=e("lodash.noop"),g=r(_),w=e("./abr-controller"),E=r(w),k=50,O=25,P=window.Hls,T=function(){var e=document.getElementsByTagName("script");return e[e.length-1].src.split("?")[0].split("/").slice(0,-1).join("/")+"/hls.min.js"}(),R=function(e){function t(e,n,r){i(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));return s.el=document.createElement("video"),s.el.setAttribute("class","aiw-video"),s.options.posterURI&&s.el.setAttribute("poster",s.options.posterURI),s.livelyPlayer.el.appendChild(s.el),s.el.volume=s.options.volume,s.el.muted=s.options.muted,s.options.hlsjsPath=s.options.hlsjsPath||T,s.lastFrag=null,s.loadingHls=!1,s.recoverDecodingErrorDate=null,s.recoverSwapAudioCodecDate=null,s.loadHls(),s.currentLevelInterval=setTimeout(s.saveCurrentLevel.bind(s),1e3),s}return s(t,e),a(t,[{key:"saveCurrentLevel",value:function(){var e=this.currentLevel;if(e){var t=this.data.encodings[e];this.livelyPlayer.store.set("lv_auto_last_kbps",t.audioKbps+t.videoKbps)}}},{key:"reloadAndRestart",value:function(){var e=this;this.mediaLoader.load(function(){e.mediaLoader.currentState===y.default.ONLINE&&e.restart()})}},{key:"loadHls",value:function(e){var t=this,n=e||g.default;if(P)return void n();if(this.loadingHls)return void setTimeout(function(){t.loadHls(n)},k);this.loadingHls=!0;var r=document.createElement("script");r.setAttribute("src",this.options.hlsjsPath),r.onload=function(){P=window.Hls,t.loadingHls=!1,n()},document.body.appendChild(r)}},{key:"whenReady",value:function(e){var n=this;this.loadHls(function(){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"whenReady",n).call(n,e)})}},{key:"playNow",value:function(e){var t=this,n=this.manifest,r=e||g.default;if(!n&&this.mediaLoader.currentState===y.default.ONLINE)return void this.emit(y.default.ERROR,b.default.DRIVER_NOT_SUPPORTED);if(this.hls){if(this.mediaLoader.vod&&n===this.hls.url||this.hls.url===n)return this.elementPlay(),void r(!0);this.destroyHls()}this.el.setAttribute("src",n);var i=function(){t.hls=new P({abrController:E.default,seekHoleNudgeDuration:.5,debug:t.options.debug,maxBufferLength:t.options.maxBufferLength,maxBufferSize:t.options.maxBufferSize,fragLoadingTimeOut:3900}),t.listen(),p.default.setPlayer(t.mediaLoader.host,t.mediaLoader.publicId,t.format,n),t.hls.loadSource(n),t.hls.attachMedia(t.el),t.elementPlay(),t.mediaLoader.vod||t.hls.on(P.Events.BUFFER_APPENDED,function(){t.el&&t.el.buffered.length&&!t.el.paused&&t.el.buffered.end(t.el.buffered.length-1)-t.el.currentTime>O&&(p.default.error("player fell behind more than "+O+"s, restarting"),t.reloadAndRestart())}),t.hls.on(P.Events.MEDIA_ATTACHED,function(){t.isAttached=!0}),t.hls.on(P.Events.MEDIA_DETACHED,function(){t.isAttached=!1}),t.hls.on(P.Events.MANIFEST_PARSED,function(){t.lastProgress=Date.now()}),null===t.options.bitrate?t.bitrateCap=null:isNaN(t.options.bitrate)||(t.bitrateCap=t.options.bitrate)};document.hidden?document.addEventListener("visibilitychange",i):i(),r(!0)}},{key:"play",value:function(e){var t=this;if(!this.hls||this.el.paused)return this.el.onprogress=null,this.ready?void this.playNow(e):void this.whenReady(function(){t.playNow(e)})}},{key:"stop",value:function(){this.hls&&this.hls.destroy()}},{key:"pause",value:function(){this.el.pause()}},{key:"destroy",value:function(){this.destroyed=!0,this.el.remove(),this.hls&&this.destroyHls()}},{key:"destroyHls",value:function(){this.hls.detachMedia&&this.hls.detachMedia(),this.hls.destroy&&this.hls.destroy(),this.hls=null}},{key:"recoverFromBufferSeekOverHole",value:function(){var e=this.data.encodings,t=e[this.currentLevel];t||(t=this.pickEncoding(this.options.bitrate||this.options.estimatedKbps)),t&&(this.options.bitrate=t.videoKbps+t.audioKbps),this.reloadAndRestart()}},{key:"ifNoProgress",value:function(e){var t=this,n=this.el.currentTime;setTimeout(function(){t.el.currentTime<=n&&e()},250)}},{key:"listen",value:function(){var e=this,t=void 0;this.hls.on(P.Events.ERROR,function(n,r){switch(r.details){case P.ErrorDetails.LEVEL_LOAD_ERROR:case P.ErrorDetails.FRAG_LOAD_TIMEOUT:return e.mediaLoader.vod?void e.handleError(y.default.ERROR,b.default.PLAYBACK_ERROR,r):e.mediaLoader.currentState===y.default.OFFLINE?void e.stop():(p.default.warn("level load reload and restart",n,r),e.reloadAndRestart(),t=e.el.currentTime,void setTimeout(function(){e.el.currentTime<=t&&(p.default.warn("level load reload and restart",n,r),e.reloadAndRestart())},100));case P.ErrorDetails.BUFFER_SEEK_OVER_HOLE:return void e.ifNoProgress(function(){e.recoverFromBufferSeekOverHole()});case P.ErrorDetails.BUFFER_APPEND_ERROR:case P.ErrorDetails.BUFFER_FULL_ERROR:e.bufferOverflowCount++;break;case P.ErrorDetails.FRAG_LOAD_ERROR:case P.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case P.ErrorDetails.FRAG_DECRYPT_ERROR:case P.ErrorDetails.FRAG_PARSING_ERROR:case P.ErrorDetails.BUFFER_APPENDING_ERROR:case P.ErrorDetails.BUFFER_STALLED_ERROR:e.bufferUnderflowCount++}switch(r.type){case P.ErrorTypes.NETWORK_ERROR:r.details!==P.ErrorDetails.FRAG_LOAD_TIMEOUT?e.currentErrorCount++:r.details===P.ErrorDetails.LEVEL_LOAD_TIMEOUT&&(e.currentErrorCount=e.options.recoverErrorCount),e.handleError(y.default.ERROR,b.default.NETWORK_ERROR,r);break;case P.ErrorTypes.MEDIA_ERROR:if(r.fatal)return void e.handleMediaError();if(r.details===P.ErrorDetails.BUFFER_STALLED_ERROR)return void e.handleError(y.default.ERROR,b.default.PLAYBACK_ERROR,r);r.details===P.ErrorDetails.FRAG_LOOP_LOADING_ERROR&&e.currentErrorCount++,e.handleError(y.default.ERROR,b.default.PLAYBACK_ERROR,r);break;case P.ErrorTypes.OTHER_ERROR:e.currentErrorCount++,e.handleError(y.default.ERROR,b.default.UNKNOWN_ERROR,r);break;default:return void p.default.error("unhandled hlsjs error",n,r)}e.checkRestart(r),p.default.error(n,r)}),this.el.addEventListener("progress",function(){e.emitProgress()}),this.el.onended=function(){e.emit("ended")},this.el.addEventListener("timeupdate",function(){e.emitTimeupdate()}),this.el.addEventListener("error",function(t){var n=t.currentTarget.error;if(n)switch(n.code){case n.MEDIA_ERR_DECODE:e.handleMediaError();break;case n.MEDIA_ERR_SRC_NOT_SUPPORTED:e.emit(y.default.ERROR,b.default.DRIVER_NOT_SUPPORTED)}}),this.hls.on(P.Events.LEVEL_SWITCH,function(t,n){e.bitrateSwitch(n.level)}),this.hls.on(P.Events.FRAG_LOADED,function(t,n){e.loadedFrag(n.frag)})}},{key:"handleMediaError",value:function(){var e=this,t=window.performance.now();!this.recoverDecodingErrorDate||t-this.recoverDecodingErrorDate>3e3?(this.recoverDecodingErrorDate=t,this.hls.recoverMediaError()):(!this.recoverSwapAudioCodecDate||t-this.recoverSwapAudioCodecDate>3e3)&&(this.recoverSwapAudioCodecDate=t,this.hls.swapAudioCodec(),this.hls.recoverMediaError()),this.ifNoProgress(function(){e.recoverFromBufferSeekOverHole()})}},{key:"bitrateSwitch",value:function(e){e>this.currentLevel?this.upshift++:this.downshift++,this.emit(y.default.BITRATE_SWITCH)}},{key:"loadedFrag",value:function(e){var t=e;this.fragCounts++,t.request=this.lastFrag?t.trequest-this.lastFrag.trequest:t.trequest,this.lastFrag=t,this.fragSize+=t.loaded,this.fragDuration+=t.duration,this.fragDownloadTime+=t.request,this.fragMaxTime=Math.max(this.fragMaxTime,t.request),this.fragMinTime=Math.min(this.fragMinTime||t.request,t.request)}},{key:"ready",get:function(){return P&&this.manifest}},{key:"manifest",get:function(){var e=this.data;if(this.options.origin)return this.originLocation;if(t=e.manifest,!this.options.origin&&!e.encodings.length)return this.options.origin=!0,this.originLocation;var t=void 0;if(t=e.manifest,!this.options.origin&&!e.encodings.length)return this.options.origin=!0,this.originLocation;if(!t)return null;var n=-1===t.indexOf("?")?"?":"&";null===this.options.preset?t+=n:this.options.preset?t+=n+"preset="+this.options.preset:d.default.any()||(t+=n+"preset=desktop");var r=this.livelyPlayer.store.get("lv_auto_last_kbps");return r&&(t+="kbps="+r),t}},{key:"bitrateCap",set:function(e){if(this.options.bitrate=e,!e)return this.hls.abrController.autoLevelCapping=-1,void this.emit(y.default.MEDIA_PLAY);var t=this.data.encodings;if(t&&t.length&&this.hls){var n=void 0;for(n=0;n<t.length&&!(t[n].videoKbps+t[n].audioKbps>e);n++);this.hls.abrController.autoLevelCapping=Math.max(n-1,0),this.emit(y.default.MEDIA_PLAY)}}},{key:"bitrate",set:function(e){var t=this;if(this.bitrateCap=e,d.default.firefox()||this.mediaLoader.vod){var n=this.el.currentTime;if(this.stop(),!this.livelyPlayer.tryingToPlay)return void(this.mediaLoader.vod&&(this.el.currentTime=n));this.mediaLoader.vod&&(this.el.onloadedmetadata=function(){t.el.onloadedmetadata=null,t.el.currentTime=n}),this.play()}}},{key:"currentLevel",get:function(){return this.hls&&this.hls.abrController.fragCurrent?this.hls.abrController.fragCurrent.level:void 0}},{key:"nextLevel",get:function(){return this.hls?this.hls.abrController.nextAutoLevel:null}}],[{key:"isSupported",value:function(){return!d.default.winChrome51()&&!(d.default.safari()&&!d.default.android()&&!d.default.chrome()&&!d.default.ie())&&window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"driver",get:function(){return"hlsjs"}},{key:"format",get:function(){return"mp4-hls"}}]),t}(c.default);n.default=R},{"./abr-controller":41,"@livelyvideo/player-core/lib/base-driver":16,"@livelyvideo/player-core/lib/detect":17,"@livelyvideo/player-core/lib/errors":18,"@livelyvideo/player-core/lib/events":19,"@livelyvideo/player-core/lib/logger":22,"lodash.noop":54}],43:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("events"),u=r(l),c=e("@livelyvideo/player-core/lib/logger"),h=r(c),d=300,f=120,p=1e4,v=1e3,y=4e5,m=3e5,b=2e3,_=2,g=0,w=25,E=900,k={stable:{key:"stable",bwModifier:function(e){return Math.min(e,e-(.01*e+Math.log(e*e)/Math.log(2)))},resistUpshift:function(e,t){return 2.5*t+Math.pow(Math.log(2*t),3.2)>2*e},resistDownshift:function(e,t){return 2*e+Math.pow(Math.log(2*e),3.2)>2*t}},normal:{key:"normal",bwModifier:function(e){return Math.min(e,e-(.06*e+Math.log(e*e)/Math.log(2)))},resistUpshift:function(e,t){return 2.5*t+Math.pow(Math.log(2*t),3.4)>2*e},resistDownshift:function(e,t){return 2*e+Math.pow(Math.log(2*e),3.4)>2*t}},uncertain:{key:"uncertain",bwModifier:function(e){return Math.min(e,e-(.3*e+Math.log(e*e)/Math.log(2)))},resistUpshift:function(e,t){return 2.5*t+Math.pow(Math.log(2*t),3.6)>2*e},resistDownshift:function(e,t){return 2*e+Math.pow(Math.log(2*e),3.4)>2*t}},sporadic:{key:"sporadic",bwModifier:function(e){return Math.min(e,e-(.5*e+Math.log(e*e)/Math.log(2)))},resistUpshift:function(e,t){return 2.5*t+Math.pow(Math.log(2*t),4)>2*e},resistDownshift:function(e,t){return 2*e+Math.pow(Math.log(2*e),3.4)>2*t}}},O=function(e){function t(e,n,r,s,a){i(this,t);var l=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return l.player=e,l.driver=n,l.switchImmediately=s,l.switchThreshold=m,l.count=0,l.dropCount=0,l.totalShifts=0,l.profile=k[r]||k.normal,l.maxShifts=a||1/0,l.currentKbps=n.options.bitrate||Math.max(n.options.estimatedKbps,244),l.rawKbps=[],l.recentKbps=[],l.sampleBws=[],l.selectedEncoding=null,l.lastMessageTime=window.performance.now(),l.lastSwitch=-1*m,l.emergencyModifier=1,l.releaseEmergencyTimeout=null,l.init(),l}return s(t,e),a(t,[{key:"updateTransport",value:function(){this.player.removeListener("fragment",this.onMessage),this.player.on("fragment",this.onMessage.bind(this))}},{key:"init",value:function(){var e=this;this.player.on("fragment",this.onMessage.bind(this)),this.profileInterval=setInterval(this.profileStream.bind(this),p),this.trackRecentKbpsInterval=setInterval(function(){for(var t=0,n=0;n<e.rawKbps.length;n++)t+=e.rawKbps[n];var r=t/e.rawKbps.length;e.rawKbps=[],e.recentKbps.unshift(r),e.recentKbps.splice(f)},v),this.estimatedKbpsInterval=setInterval(function(){return e.emit("profile",{estimatedKbps:e.currentKbps,profile:e.profile}),e.selectedEncoding?void h.default.debug("Estimated KBPS="+e.currentKbps+", Emergency modifier="+e.emergencyModifier+", Last BW Switch="+e.lastSwitch+", Last Selected Bitrated="+(e.selectedEncoding.audioKbps+e.selectedEncoding.videoKbps)+", Shiftable="+e.shiftable+", Profile="+e.profile.key):void h.default.debug("Estimated KBPS="+e.currentKbps+", Emergency modifier="+e.emergencyModifier+", Last BW Switch="+e.lastSwitch+", Shiftable="+e.shiftable+", Profile="+e.profile.key)},4e3)}},{key:"handleEmergencyDrop",value:function(e,t){var n=this;++this.dropCount<2||(this.dropCount=0,this.emergencyModifier=e,this.sampleBws.splice(t),clearTimeout(this.releaseEmergencyTimeout),setTimeout(function(){n.emergencyModifier=1},E))}},{key:"profileStream",value:function(){var e=[];e.push.apply(e,this.recentKbps),e.sort(function(e,t){return e>t?1:-1});var t=Math.floor(e.length/4),n=(e[2*t]-e[t])/e[2*t],r=(e[3*t]-e[2*t])/e[3*t],i=n+r;this.profile=i>1?k.sporadic:i>.65?k.uncertain:i>.3?k.normal:k.stable}},{key:"onMessage",value:function(e){if(!this.destroyed){this.lastMessageTime=window.performance.now(),e.time>2.5*e.duration?(this.dropCount++,this.handleEmergencyDrop(.6,3*(w-1))):e.time>2.25*e.duration?this.handleEmergencyDrop(.7,Math.max(w-1,Math.floor(.5*d))):e.time>2*e.duration?this.handleEmergencyDrop(.8,Math.max(w-1,Math.floor(.7*d))):e.time>1.75*e.duration?this.handleEmergencyDrop(.9,Math.max(w-1,Math.floor(.8*d))):this.dropCount=0;var t=this.profile.bwModifier(8*e.size)*this.emergencyModifier/e.time;if(this.rawKbps.push(8*e.size/e.time),e.time<_&&(e.time=_),e.size<b)return void(this.count>g&&(this.count=Math.floor(g/2)));this.count++,!isNaN(t)&&this.count>g&&y>t&&(this.sampleBws.unshift(t),this.sampleBws.splice(d),this.currentKbps=this.calculateCurrentKbps()),this.shiftable&&this.shiftIfNecessary()}}},{key:"shiftIfNecessary",value:function(){for(var e=this.driver.data.encodings,t=e[this.driver.currentLevel],n=e[0],r=0,i=0;i<e.length&&e[i].videoKbps+e[i].audioKbps<this.currentKbps;i++)n=e[i],r=i;if(this.switchImmediately)return this.switchBitrate(n),this.switchImmediately=!1,void h.default.debug("pick first adaptive encoding",n);if(t&&t.videoKbps!==n.videoKbps){if(n.kbps=n.videoKbps+n.audioKbps,t.kbps=t.videoKbps+t.audioKbps,n.kbps>t.kbps){for(;this.profile.resistUpshift(this.currentKbps,n.kbps)&&n.kbps>t.kbps;)if(!(n=e[--r])||n.kbps<t.kbps)return void h.default.debug("tried to upshift - too stiff");this.emit("upshift")}else{for(;this.profile.resistDownshift(this.currentKbps,n.kbps)&&n.kbps<t.kbps;)if(!(n=e[++r])||n.kbps>t.kbps)return void h.default.debug("tried to downshift - too stiff");this.emit("downshift")}h.default.debug("switching bitrate",{currentEncoding:t,suggestedEncoding:n,currentKbps:this.currentKbps}),this.lastSwitch=window.performance.now(),this.selectedEncoding=n,this.switchBitrate(n),this.totalShifts++}}},{key:"switchBitrate",value:function(e){this.emit("profile",{estimatedKbps:this.currentKbps,profile:this.profile}),this.driver.setEncoding(e)}},{key:"calculateCurrentKbps",value:function(){for(var e=0,t=0;t<this.sampleBws.length;t++)e+=this.sampleBws[t];return e/this.sampleBws.length}},{key:"destroy",value:function(){clearTimeout(this.spinTimeout),clearTimeout(this.releaseEmergencyTimeout),clearInterval(this.estimatedKbpsInterval),this.destroyed=!0,this.player&&this.player.removeListener("fragment",this.onMessage)}},{key:"shiftable",get:function(){return this.totalShifts<this.maxShifts&&this.sampleBws.length>w&&window.performance.now()-this.lastSwitch>this.switchThreshold}}]),t}(u.default);n.default=O},{"@livelyvideo/player-core/lib/logger":22,events:50}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){var n=new window.FileReader;n.onload=function(){t(n.result)},n.readAsArrayBuffer(e)}},{}],45:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("@livelyvideo/player-core/lib/base-driver"),u=r(l),c=e("@livelyvideo/player-core/lib/detect"),h=r(c),d=e("@livelyvideo/player-core/lib/logger"),f=r(d),p=e("@livelyvideo/player-core/lib/events"),v=r(p),y=e("@livelyvideo/player-core/lib/errors"),m=r(y),b=e("./player"),_=r(b),g=["A","B","N"],w=function(e){function t(e,n,r){i(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));return s.currentManifest=null,s.options.mse||(s.options.mse={}),(!s.options.mse.backFill||isNaN(s.options.mse.backFill)||s.options.mse.backFill<0||s.options.mse.backFill>10)&&(s.options.mse.backFill=2),(!s.options.mse.maxGap||isNaN(s.options.mse.maxGap)||s.options.mse.maxGap<0||s.options.mse.maxGap>1e4)&&(s.options.mse.maxGap=500),(!s.options.mse.retry||isNaN(s.options.mse.retry)||s.options.mse.retry<0||s.options.mse.retry>30)&&(s.options.mse.retry=20),(!s.options.mse.requiredBuffer||isNaN(s.options.mse.requiredBuffer)||s.options.mse.requiredBuffer<0||s.options.mse.requiredBuffer>10)&&(s.options.mse.requiredBuffer=1),(!s.options.mse.initFailTimeout||isNaN(s.options.mse.initFailTimeout)||s.options.mse.initFailTimeout<0)&&(s.options.mse.initFailTimeout=3e4),(!s.options.mse.playbackFailTimeout||isNaN(s.options.mse.playbackFailTimeout)||s.options.mse.playbackFailTimeout<0)&&(s.options.mse.playbackFailTimeout=6e4),s.options.mse.mode&&-1!==g.indexOf(s.options.mse.mode)||(s.options.mse.mode="B"),s.options.mse.requiredBufferBeforeRemove=s.options.mse.requiredBuffer,s.options.mse.skipWatchInterval=Math.floor(400*s.options.mse.requiredBuffer),s.options.mse.skipForwardThreshold=25,s.options.mse.download=!!s.options.mse.download,isNaN(s.options.mse.maxShifts)&&(s.options.mse.maxShifts=1/0),s.seekingOverHole=!1,s.activeEncoding=null,s.render(),s}return s(t,e),a(t,[{key:"handleBufferOverholeSeeking",value:function(){var e=this,t=function(t){e.seekingOverHole=!0,setTimeout(function(){e.seekingOverHole=!1,f.default.debug(v.default.SEEK_OVER_HOLE,{currentTime:e.el.currentTime,nextBufferStart:e.nextBufferStart,currentBufferEnd:e.currentBufferEnd}),e.emit(v.default.SEEK_OVER_HOLE,{currentBufferEnd:e.currentBufferEnd,nextBufferStart:e.nextBufferStart}),isNaN(t)||(e.el.currentTime=t)},Math.max(Math.floor(1e3*(e.currentBufferEnd-e.el.currentTime))-50,1))};this.el.currentTime>0&&this.el.currentTime>=this.currentBufferEnd-.025&&this.el.currentTime<this.nextBufferStart&&!this.seekingOverHole&&t(this.nextBufferStart),0===this.currentBufferEnd&&0===this.nextBufferStart&&this.lastBufferStart>this.el.currentTime&&t(this.lastBufferStart)}},{key:"render",value:function(){var e=this;this.el=document.createElement("video"),this.el.setAttribute("class","aiw-video"),this.options.posterURI&&this.el.setAttribute("poster",this.options.posterURI),this.livelyPlayer.el.appendChild(this.el),this.el.addEventListener("timeupdate",function(){e.handleBufferOverholeSeeking(),e.emitTimeupdate()}),this.el.addEventListener("progress",function(){e.emitProgress()}),this.el.addEventListener("error",function(t){switch(t.target.code){case 1:e.emit("error","media-error",{code:t.target.code,description:"MEDIA_ERR_ABORTED",fatal:!0});break;case 2:e.emit("error","media-error",{code:t.target.code,description:"MEDIA_ERR_NETWORK",fatal:!0});break;case 3:e.emit(v.default.ERROR,m.default.DRIVER_NOT_SUPPORTED,{description:"MEDIA_ERR_DECODE",fatal:!0});break;case 4:e.emit(v.default.ERROR,m.default.DRIVER_NOT_SUPPORTED,{description:"MEDIA_ERR_SRC_NOT_SUPPORTED",fatal:!0});break;default:e.emit(v.default.ERROR,m.default.DRIVER_NOT_SUPPORTED,{description:"unknown element error",fatal:!0})}}),this.el.addEventListener("pause",function(){e.mediaLoader.currentState===v.default.OFFLINE&&e.stop()}),this.el.volume=this.options.volume,this.el.muted=this.options.muted}},{key:"getLevelForBitrate",value:function(e){var t=this.data.encodings;if(!t.length)return null;var n=void 0;for(n=0;n<t.length&&!(t[n].videoWidth&&t[n].videoKbps+t[n].audioKbps>e);n++);return n=Math.max(n-1,0)}},{key:"pickEncoding",value:function(e){if(!(e=e||this.options.bitrate))return null;var t=this.data.encodings;return t.length?t[this.currentLevel]:null}},{key:"setEncoding",value:function(e){if(!this.activeEncoding||this.activeEncoding.videoKbps!==e.videoKbps||this.activeEncoding.audioKbps!==e.audioKbps){this.activeEncoding=e;var t=e.location.split("/");this.player.switchBitrate(t[t.length-1])}}},{key:"switchBitrate",value:function(e){var t=this;return this.options.origin=!1,this.options.bitrate=e,e?void this.setEncoding(this.pickEncoding(e)):(this.options.bitrate=null,void this.stop(function(){t.play()}))}},{key:"addSessionKey",value:function(e){return e+=(-1===e.indexOf("?")?"?":"&")+"sid="+f.default.sessionKey}},{key:"destroy",value:function(){this.stop(),this.el.remove()}},{key:"pause",value:function(){this.stop()}},{key:"stop",value:function(e){var t=this;return this.playbackLock=!1,clearInterval(this.nudgeInterval),this.player?void this.player.destroy(function(){for(var n=arguments.length,r=Array(n),i=0;n>i;i++)r[i]=arguments[i];t.player=null,e&&e.apply(e,r)}):void(e&&e())}},{key:"play",value:function(e){var t=this;if(!this.playbackLock)return this.playbackLock=!0,this.elementPlay(),this.player?void this.player.play(e):void this.whenReady(function(){clearInterval(t.nudgeInterval),t.nudgeTime=null;var n=0;t.nudgeInterval=setInterval(function(){if(t.livelyPlayer.tryingToPlay&&0!==t.el.currentTime){if(t.nudgeTime&&t.el.currentTime===t.nudgeTime&&(!t.lastBufferEnd||t.el.currentTime<t.lastBufferEnd)){f.default.debug("playback halted, nudging"),n++,t.el.currentTime=t.el.currentTime+.1;var e=t.el.play();"undefined"!=typeof Promise&&e instanceof Promise&&e.catch(function(){})}else n=0,t.nudgeTime=t.el.currentTime;n>29&&(clearInterval(t.nudgeInterval),t.reloadAndRestart())}},500),t.player&&t.player.destroy(),t.player=new _.default(t,t.options),t.upshift=0,t.downshift=0,t.currentErrorCount=0,t.fragCounts=0,t.fragSize=0,t.fragFetchTime=0,t.fragMaxTime=0,t.fragMinTime=0,t.player.on("upshift",function(){t.upshift++}),t.player.on("downshift",function(){t.downshift++}),t.player.on("fragment",function(e){t.fragCounts++,t.fragSize+=e.size,t.fragFetchTime+=e.fetchTime,t.fragMaxTime=Math.max(t.fragMaxTime,e.fetchTime),t.fragMinTime=Math.min(t.fragMinTime||e.fetchTime,e.fetchTime)}),t.player.on("error",function(e,n){t.currentErrorCount++,t.emit(e,n),n.fatal&&t.reloadAndRestart()}),t.player.play(e)})}},{key:"lastBufferEnd",get:function(){return this.sourceBuffer&&this.sourceBuffer.buffered.length?this.sourceBuffer.buffered.end(this.sourceBuffer.buffered.length-1):0}},{key:"lastBufferStart",get:function(){return this.sourceBuffer&&this.sourceBuffer.buffered.length?this.sourceBuffer.buffered.start(this.sourceBuffer.buffered.length-1):0}},{key:"nextBufferStart",get:function(){if(!this.sourceBuffer)return 0;for(var e=0;e<this.sourceBuffer.buffered.length;e++){var t=this.sourceBuffer.buffered;if(this.el.currentTime>=t.start(e)&&this.el.currentTime<=t.end(e))return this.sourceBuffer.buffered.length>e+1?this.sourceBuffer.buffered.start(e+1):this.sourceBuffer.buffered.end(e)}return 0}},{key:"currentBufferEnd",get:function(){if(!this.sourceBuffer||!this.sourceBuffer.buffered.length)return 0;for(var e=0;e<this.sourceBuffer.buffered.length;e++)if(this.el.currentTime>=this.sourceBuffer.buffered.start(e)&&this.el.currentTime<=this.sourceBuffer.buffered.end(e))return this.sourceBuffer.buffered.end(e);return 0}},{key:"currentLevel",get:function(){return this.getLevelForBitrate(this.options.bitrate?this.options.bitrate:this.activeEncoding?this.activeEncoding.videoKbps+this.activeEncoding.audioKbps:this.options.estimatedKbps)}},{key:"originLocation",get:function(){var e=this.origin;return e?this.addSessionKey(e.location):null}},{key:"manifest",get:function(){var e=void 0;if(this.options.origin){if(!(e=this.originLocation))return this.options.origin=!1,this.manifest}else{if(!this.data.encodings.length){var t=this.originLocation;return t&&(this.options.origin=!0),t}var n=this.pickEncoding(this.options.bitrate||this.options.estimatedKbps);if(!n)return null;e=n.location}return e?this.addSessionKey(e):null}}],[{key:"isSupported",value:function(){return!(h.default.chrome()&&!h.default.chromeGreater50())&&window.WebSocket&&window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.4d4028,mp4a.40.2"')}},{key:"driver",get:function(){return"mediaSourceMp4"}},{key:"format",get:function(){return"mp4-ws"}}]),t}(u.default);n.default=w},{"./player":46,"@livelyvideo/player-core/lib/base-driver":16,"@livelyvideo/player-core/lib/detect":17,"@livelyvideo/player-core/lib/errors":18,"@livelyvideo/player-core/lib/events":19,"@livelyvideo/player-core/lib/logger":22}],46:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("events"),u=r(l),c=e("./transport"),h=r(c),d=e("./abr-controller"),f=r(d),p=e("@livelyvideo/player-core/lib/logger"),v=r(p),y=e("./blob-to-array-buffer"),m=r(y),b=e("@livelyvideo/player-core/lib/storage-values"),_=r(b),g=e("@livelyvideo/player-core/lib/detect"),w=r(g),E=e("@livelyvideo/player-core/lib/errors"),k=r(E),O=e("@livelyvideo/player-core/lib/events"),P=r(O),T=function(e){function t(e,n){i(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.livelyPlayer=e.livelyPlayer,r.mediaLoader=e.mediaLoader,r.driver=e,r.options=n,r.el=r.driver.el,r.buffering=!1,r.queue=[],r.sourceBuffers=[],r.options.bitrate||(r.abrController=new f.default(r,r.driver,r.livelyPlayer.store.get(_.default.profile),!1,r.driver.options.mse.maxShifts),r.abrController.on("profile",function(e){var t=w.default.any()?216e5:5184e6;r.livelyPlayer.store.set(_.default.estimatedKbps,e.estimatedKbps,t),r.livelyPlayer.store.set(_.default.profile,e.profile.key,t)}),r.abrController.on("upshift",function(){r.emit("upshift")}),r.abrController.on("downshift",function(){r.emit("downshift")}));var s=void 0;return s=r.options.origin?r.driver.data.origin:r.driver.pickEncoding(),!s&&r.driver.data.encodings.length&&(s=r.driver.data.encodings[0]),r.encoding=s,r.setupMSE(),r}return s(t,e),a(t,[{key:"appendBuffer",value:function(){var e=this;if(!this.buffering){var t=function(){e.buffering=!0,setTimeout(function(){e.buffering=!1,e.appendBuffer()},20)};if(!this.ms.readyState)return void t();var n=this.queue.shift();if(!n)return void t();this.buffering=!0,"remove"===n.type?(v.default.debug("remove buffer",n.start+"-"+n.end+" buffered until "+n.sb.buffered.end(0)),n.sb.remove(n.start,n.end)):m.default(n.blob,function(r){var i=e.transport.getSegmentInfo(r);1===e.version&&(i.contentTag=0);var o=e.sourceBuffers[i.contentTag];return e.emit("fragment",{size:n.blob.size,time:n.time,duration:300}),o?void o.appendBuffer(r):(e.queue.unshift(n),void t())})}}},{key:"newSourceBuffer",value:function(e){var t=this;if(!e||!window.MediaSource.isTypeSupported(e))return void this.sourceBuffers.push(null);var n=this.ms.addSourceBuffer(e);n.mimetype=e,n.addEventListener("updateend",function(){if(t.buffering=!1,t.appendBuffer(),0===t.el.currentTime&&t.el.buffered.length&&t.el.buffered.end(t.el.buffered.length-1)-t.el.buffered.start(0)>t.options.mse.requiredBuffer){t.el.currentTime=Math.max(t.el.buffered.end(t.el.buffered.length-1)-t.options.mse.requiredBuffer,t.el.buffered.start(0));var e=t.el.play();"undefined"!=typeof Promise&&e instanceof Promise&&e.catch(function(){})}}),this.sourceBuffers.push(n)}},{key:"setupMSE",value:function(){var e=this;this.ms=new window.MediaSource,this.ms.addEventListener("error",function(){e.emit(P.default.ERROR,k.default.MEDIA_ERROR,{fatal:!0})}),this.ms.addEventListener("sourceopen",function(){var t=e.encoding;if(!t)return void e.emit(P.default.ERROR,k.default.MEDIA_ERROR,{fatal:!0});if(t&&t.channels)e.version=2,t.channels.forEach(function(t){e.newSourceBuffer(t)});else{e.version=1;var n=e.driver.data.origin,r=void 0;r=e.options.origin&&n&&"aac"!==n.audioCodec||!e.options.origin&&"aac"!==e.driver.data.audioCodec?'video/mp4; codecs="avc1.4d4028"':'video/mp4; codecs="avc1.4d4028, mp4a.40.2"',e.newSourceBuffer(r)}}),this.el.src=window.URL.createObjectURL(this.ms)}},{key:"setupTransport",value:function(){var e=this,t=this.encoding.channels&&this.encoding.channels.length?this.encoding.channels.length:1;this.transport=new h.default(this.driver.manifest,this.options.mse.backFill,this.options.mse.maxGap,this.options.mse.retry,this.options.mse.mode,this.options.mse.download,this.options.mse.segmentDuration,t),this.transport.on("error",function(){e.transport&&e.transport.isDisconnected?e.emit(P.default.ERROR,k.default.WS_NETWORK_ERROR,{fatal:!1}):e.emit(P.default.ERROR,k.default.WS_CONNECTION,{fatal:!1})}),this.transport.on("destroy",function(){e.emit(P.default.ERROR,k.default.WS_CONNECTION,{fatal:!0})}),this.transport.on("message",function(t){e.queue.push({type:"append",blob:t.data,time:t.fetchTime}),e.appendBuffer()})}},{key:"switchBitrate",value:function(e){this.abrController&&this.abrController.destroy(),this.transport.switchBitrate(e)}},{key:"play",value:function(e){var t=this;this.queue=[],this.transport||this.setupTransport(),this.gcInterval=setInterval(function(){t.sourceBuffers.forEach(function(e){t.queue.push({type:"remove",sb:e,start:0,end:t.el.currentTime-15})})},3e4);var n=function n(){t.el.removeEventListener("timeupdate",n),clearTimeout(r),e&&e(!0),e=null};this.el.addEventListener("timeupdate",n);var r=setTimeout(function(){t.el.removeEventListener("timeupdate",n),e&&e(!1),e=null},4e3);this.el.play()}},{key:"stop",value:function(e){clearInterval(this.gcInterval),this.transport.removeAllListeners("message"),this.buffering=!1,this.el.pause(),e&&e()}},{key:"destroy",value:function(e){this.transport.removeAllListeners("error"),this.transport.removeAllListeners("destroy"),this.transport.removeAllListeners("message"),this.transport.destroy(),this.abrController&&this.abrController.destroy(),this.stop(e)}}]),t}(u.default);n.default=T},{"./abr-controller":43,"./blob-to-array-buffer":44,"./transport":47,"@livelyvideo/player-core/lib/detect":17,"@livelyvideo/player-core/lib/errors":18,"@livelyvideo/player-core/lib/events":19,"@livelyvideo/player-core/lib/logger":22,"@livelyvideo/player-core/lib/storage-values":31,events:50}],47:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}function s(e,t){}function a(e,t){return String.fromCharCode(e.getUint8(t))}function l(e,t){return e.byteLength<9?1:1936419184!==t.getUint32(e.byteLength-5)?1:t.getUint8(e.byteLength-1)}Object.defineProperty(n,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h=e("events"),d=r(h),f=["moof","mfhd"],p="ftyp",v=function e(){s(this,e),this.lastTime=window.performance.now(),this.lastSegmentTime=window.performance.now(),this.lastSegmentDuration=0},y=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"B",l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:300,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1;s(this,t);var d=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));d.uri=e,d.backFill=n,d.maxGap=r,d.retry=o,d.mode=a,d.segmentDuration=c,d.saveToDownload=l,d.downloadedSegments=[],d.ws=new window.WebSocket(d.uri+"&bckfil="+d.backFill),d.channelTracker=0,d.channelLatency=[];for(var f=0;h>f;f++)d.channelLatency.push(new v);return d.ws.onmessage=function(e){if("object"===u(e.data))e.fetchTime=window.performance.now()-d.lastTime+10,e.segmentDuration=d.lastSegmentDuration||d.segmentDuration,d.emit("message",e),d.lastSegmentTime=window.performance.now(),d.saveToDownload&&d.downloadedSegments.push(e.data),d.nextChannel();else{d.lastTime=window.performance.now();var t=parseInt(e.data,10);d.lastSegmentDuration=2e3>t&&t>0?t:d.segmentDuration}},d.ws.onclose=function(){d.emit("close"),d.emit("destroy")},d.ws.onerror=function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];d.emit.apply(d,["error"].concat(t))},d}return o(t,e),c(t,[{key:"nextChannel",value:function(){this.channelTracker++,this.channelLatency.length>=this.channelTracker&&(this.channelTracker=0)}},{key:"download",value:function(){var e=document.createElement("a");document.body.appendChild(e),e.style="display: none";var t=new window.Blob(this.downloadedSegments,{type:"octet/stream"}),n=window.URL.createObjectURL(t);e.href=n,e.download="blah.mp4",e.click(),window.URL.revokeObjectURL(n)}},{key:"getSegmentInfo",value:function(e){var t=new DataView(e),n=l(e,t),r=0,i=0,o=0,s=e.byteLength,u=0,c=!1;for(""+a(t,4)+a(t,5)+a(t,6)+a(t,7)===p&&(c=!0),i=0;s>i&&o<f.length;)r=t.getUint32(i),a(t,i+4)===f[o].charAt(0)&&a(t,i+5)===f[o].charAt(1)&&a(t,i+6)===f[o].charAt(2)&&a(t,i+7)===f[o].charAt(3)?(s=i+r,o++,i+=8):i+=r;return o===f.length&&(u=t.getUint32(i+4)),{contentTag:n,segment:u,init:c}}},{key:"switchBitrate",value:function(e){this.ws.send("switch_stream?name="+e+"&mode="+this.mode+"&bckfil="+this.backFill+"&retry="+this.retry+"&mxgap="+this.maxGap)}},{key:"destroy",value:function(e){return this.downloadedSegments=[],e||(e=function(){}),clearInterval(this.pingInterval),this.ws?(this.ws.close(),void setTimeout(function(){e()},50)):void e()}},{key:"lastTime",get:function(){return this.channelLatency[this.channelTracker].lastTime},set:function(e){this.channelLatency[this.channelTracker].lastTime=e}},{key:"lastSegmentTime",get:function(){return this.channelLatency[this.channelTracker].lastSegmentTime},set:function(e){this.channelLatency[this.channelTracker].lastSegmentTime=e}},{key:"lastSegmentDuration",get:function(){return this.channelLatency[this.channelTracker].lastSegmentDuration},set:function(e){this.channelLatency[this.channelTracker].lastSegmentDuration=e}},{key:"disconnected",get:function(){return this.ws.readyState>1}}]),t}(d.default);n.default=y},{events:50}],48:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var s=i.get;return void 0===s?void 0:s.call(r)},u=e("@livelyvideo/player-core/lib/base-driver"),c=r(u),h=e("@livelyvideo/player-core/lib/detect"),d=r(h),f=e("@livelyvideo/player-core/lib/events"),p=r(f),v=e("@livelyvideo/player-core/lib/errors"),y=r(v),m=e("lodash.noop"),b=r(m),_={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"},g=250,w=function(e){function t(e,n,r){i(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));return s.el=document.createElement("video"),s.el.setAttribute("class","aiw-video"),s.el.setAttribute("playsinline",!0),s.el.setAttribute("webkit-playsinline",!0),r.autoplay&&s.el.setAttribute("autoplay",!0),s.options.posterURI&&s.el.setAttribute("poster",s.options.posterURI),s.livelyPlayer.el.appendChild(s.el),s.el.volume=s.options.volume,s.el.muted=s.options.muted,s.el.addEventListener(p.default.ERROR,function(){s.el.getAttribute("src")&&(s.handleError(p.default.ERROR,y.default.UNKNOWN_ERROR,{fatal:!0,details:_[s.el.error.code]}),setTimeout(function(){s.livelyPlayer.tryingToPlay&&s.play()},g))}),s.lastProgress=Date.now(),s}return s(t,e),a(t,[{key:"stop",value:function(){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).call(this),clearInterval(this.progressInterval)}},{key:"play",value:function(e){var n=this,r=e||b.default;l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"play",this).call(this,function(e){e&&(n.el.onprogress=function(){n.emitProgress()},n.el.onended=function(){n.emit("ended")},n.el.ontimeupdate=function(){n.fragCounts++,n.emitTimeupdate()}),r(e)})}}],[{key:"isSupported",value:function(){if(d.default.iPhone9())return!1;var e=document.createElement("video"),t=e.canPlayType&&("maybe"===e.canPlayType("application/vnd.apple.mpegURL")||"probably"===e.canPlayType("application/vnd.apple.mpegURL"));return e.remove(),t}},{key:"driver",get:function(){return"hls"}},{key:"format",get:function(){return"mp4-hls"}}]),t}(c.default);n.default=w},{"@livelyvideo/player-core/lib/base-driver":16,"@livelyvideo/player-core/lib/detect":17,"@livelyvideo/player-core/lib/errors":18,"@livelyvideo/player-core/lib/events":19,"lodash.noop":54}],49:[function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(c===setTimeout)return setTimeout(e,0);if((c===n||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function o(e){if(h===clearTimeout)return clearTimeout(e);if((h===r||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function s(){v&&f&&(v=!1,f.length?p=f.concat(p):y=-1,p.length&&a())}function a(){if(!v){var e=i(s);v=!0;for(var t=p.length;t;){for(f=p,p=[];++y<t;)f&&f[y].run();y=-1,t=p.length}f=null,v=!1,o(e)}}function l(e,t){this.fun=e,this.array=t}function u(){}var c,h,d=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:n}catch(e){c=n}try{h="function"==typeof clearTimeout?clearTimeout:r}catch(e){h=r}}();var f,p=[],v=!1,y=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new l(e,t)),1!==p.length||v||i(a)},l.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=u,d.addListener=u,d.once=u,d.off=u,d.removeListener=u,d.removeAllListeners=u,d.emit=u,d.binding=function(){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],50:[function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!(!i(e)||0>e||isNaN(e)))return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,a,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(n=this._events[e],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(o(n))for(a=Array.prototype.slice.call(arguments,1),u=n.slice(),i=u.length,l=0;i>l;l++)u[l].apply(this,a);return!0},n.prototype.addListener=function(e,t){var i;if(r(t))return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(i=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(r(t)){var i=!1;return n.listener=t,this.on(e,n),this}},n.prototype.removeListener=function(e,t){var n,i,s,a;if(r(t)){if(!this._events||!this._events[e])return this;if(n=this._events[e],s=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(a=s;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){i=a;break}if(0>i)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this}},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],51:[function(e,t){function n(e,t,n){s(t)&&(arguments.length<3&&(n=this),"[object Array]"===a.call(e)?r(e,t,n):"string"==typeof e?i(e,t,n):o(e,t,n))}function r(e,t,n){for(var r=0,i=e.length;i>r;r++)l.call(e,r)&&t.call(n,e[r],r,e)}function i(e,t,n){for(var r=0,i=e.length;i>r;r++)t.call(n,e.charAt(r),r,e)}function o(e,t,n){for(var r in e)l.call(e,r)&&t.call(n,e[r],r,e)}var s=e("is-function");t.exports=n;var a=Object.prototype.toString,l=Object.prototype.hasOwnProperty},{"is-function":53}],52:[function(e,n){(function(e){n.exports="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],53:[function(e,t){function n(e){var t=r.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)}t.exports=n;var r=Object.prototype.toString},{}],54:[function(e,t){function n(){}t.exports=n},{}],55:[function(e,n){(function(e){function t(e,t,n){function r(t){var n=p,r=v;return p=v=void 0,k=t,m=e.apply(r,n)}function o(e){return k=e,b=setTimeout(u,t),O?r(e):m}function s(e){var n=e-_,r=e-k,i=t-n;return P?w(i,y-r):i}function l(e){var n=e-_,r=e-k;return void 0===_||n>=t||0>n||P&&r>=y}function u(){var e=E();return l(e)?c(e):void(b=setTimeout(u,s(e)))}function c(e){return b=void 0,T&&p?r(e):(p=v=void 0,m)}function h(){void 0!==b&&clearTimeout(b),k=0,p=_=v=b=void 0}function d(){return void 0===b?m:c(E())}function f(){var e=E(),n=l(e);if(p=arguments,v=this,_=e,n){if(void 0===b)return o(_);if(P)return b=setTimeout(u,t),r(_)}return void 0===b&&(b=setTimeout(u,t)),m}var p,v,y,m,b,_,k=0,O=!1,P=!1,T=!0;if("function"==typeof e)return t=a(t)||0,i(n)&&(O=!!n.leading,P="maxWait"in n,y=P?g(a(n.maxWait)||0,t):y,T="trailing"in n?!!n.trailing:T),f.cancel=h,f.flush=d,f}function r(e,n,r){var o=!0,s=!0;if("function"==typeof e)return i(r)&&(o="leading"in r?!!r.leading:o,s="trailing"in r?!!r.trailing:s),t(e,n,{leading:o,maxWait:n,trailing:s})}function i(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function o(e){return!!e&&"object"==typeof e}function s(e){return"symbol"==typeof e||o(e)&&_.call(e)==u}function a(e){if("number"==typeof e)return e;if(s(e))return l;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(c,"");var n=d.test(e);return n||f.test(e)?p(e.slice(2),n?2:8):h.test(e)?l:+e}var l=NaN,u="[object Symbol]",c=/^\s+|\s+$/g,h=/^[-+]0x[0-9a-f]+$/i,d=/^0b[01]+$/i,f=/^0o[0-7]+$/i,p=parseInt,v="object"==typeof e&&e&&e.Object===Object&&e,y="object"==typeof self&&self&&self.Object===Object&&self,m=v||y||Function("return this")(),b=Object.prototype,_=b.toString,g=Math.max,w=Math.min,E=function(){return m.Date.now()};n.exports=r}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],56:[function(e,t){var n=e("trim"),r=e("for-each"),i=function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.exports=function(e){if(!e)return{};var t={};return r(n(e).split("\n"),function(e){var r=e.indexOf(":"),o=n(e.slice(0,r)).toLowerCase(),s=n(e.slice(r+1));void 0===t[o]?t[o]=s:i(t[o])?t[o].push(s):t[o]=[t[o],s]}),t}},{"for-each":51,trim:59}],57:[function(t,n){!function(t,r){void 0!==n?n.exports=r():"function"==typeof e&&void 0!==e.amd?e(r):t.swfobject=r()}(this,function(){function e(){if(!K&&document.getElementsByTagName("body")[0]){try{var e,t=m("span");t.style.display="none",e=B.getElementsByTagName("body")[0].appendChild(t),e.parentNode.removeChild(e),e=null,t=null}catch(e){return}K=!0;for(var n=U.length,r=0;n>r;r++)U[r]()}}function t(e){K?e():U[U.length]=e}function n(e){if(typeof D.addEventListener!=A)D.addEventListener("load",e,!1);else if(typeof B.addEventListener!=A)B.addEventListener("load",e,!1);else if(typeof D.attachEvent!=A)_(D,"onload",e);else if("function"==typeof D.onload){var t=D.onload;D.onload=function(){t(),e()}}else D.onload=e}function r(){var e=B.getElementsByTagName("body")[0],t=m(j);t.setAttribute("style","visibility: hidden;"),t.setAttribute("type",I);var n=e.appendChild(t);if(n){var r=0;!function o(){if(typeof n.GetVariable!=A)try{var s=n.GetVariable("$version");s&&(s=s.split(" ")[1].split(","),Y.pv=[b(s[0]),b(s[1]),b(s[2])])}catch(e){Y.pv=[8,0,0]}else if(10>r)return r++,void setTimeout(o,10);e.removeChild(t),n=null,i()}()}else i()}function i(){var e=q.length;if(e>0)for(var t=0;e>t;t++){var n=q[t].id,r=q[t].callbackFn,i={success:!1,id:n};if(Y.pv[0]>0){var u=y(n);if(u)if(!g(q[t].swfVersion)||Y.wk&&Y.wk<312)if(q[t].expressInstall&&s()){var c={};c.data=q[t].expressInstall,c.width=u.getAttribute("width")||"0",c.height=u.getAttribute("height")||"0",u.getAttribute("class")&&(c.styleclass=u.getAttribute("class")),u.getAttribute("align")&&(c.align=u.getAttribute("align"));for(var h={},d=u.getElementsByTagName("param"),f=d.length,p=0;f>p;p++)"movie"!=d[p].getAttribute("name").toLowerCase()&&(h[d[p].getAttribute("name")]=d[p].getAttribute("value"));a(c,h,n,r)}else l(u),r&&r(i);else E(n,!0),r&&(i.success=!0,i.ref=o(n),i.id=n,r(i))}else if(E(n,!0),r){var v=o(n);v&&typeof v.SetVariable!=A&&(i.success=!0,i.ref=v,i.id=v.id),r(i)}}}function o(e){var t=null,n=y(e);return n&&"OBJECT"===n.nodeName.toUpperCase()&&(t=typeof n.SetVariable!==A?n:n.getElementsByTagName(j)[0]||n),t}function s(){return!G&&g("6.0.65")&&(Y.win||Y.mac)&&!(Y.wk&&Y.wk<312)}function a(e,t,n,r){var i=y(n);if(n=v(n),G=!0,T=r||null,R={success:!1,id:n},i){"OBJECT"==i.nodeName.toUpperCase()?(O=u(i),P=null):(O=i,P=n),e.id=N,(typeof e.width==A||!/%$/.test(e.width)&&b(e.width)<310)&&(e.width="310"),(typeof e.height==A||!/%$/.test(e.height)&&b(e.height)<137)&&(e.height="137"),B.title=B.title.slice(0,47)+" - Flash Player Installation";var o=Y.ie?"ActiveX":"PlugIn",s="MMredirectURL="+encodeURIComponent(D.location.toString().replace(/&/g,"%26"))+"&MMplayerType="+o+"&MMdoctitle="+B.title;if(typeof t.flashvars!=A?t.flashvars+="&"+s:t.flashvars=s,Y.ie&&4!=i.readyState){var a=m("div");n+="SWFObjectNew",a.setAttribute("id",n),i.parentNode.insertBefore(a,i),i.style.display="none",f(i)}h(e,t,n)}}function l(e){if(Y.ie&&4!=e.readyState){e.style.display="none";var t=m("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(u(e),t),f(e)}else e.parentNode.replaceChild(u(e),e)}function u(e){var t=m("div");if(Y.win&&Y.ie)t.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(j)[0];if(n){var r=n.childNodes;if(r)for(var i=r.length,o=0;i>o;o++)1==r[o].nodeType&&"PARAM"==r[o].nodeName||8==r[o].nodeType||t.appendChild(r[o].cloneNode(!0))}}return t}function c(e,t){var n=m("div");return n.innerHTML="<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'><param name='movie' value='"+e+"'>"+t+"</object>",n.firstChild}function h(e,t,n){var r,i=y(n);if(n=v(n),Y.wk&&Y.wk<312)return r;if(i){var o,s,a,l=m(Y.ie?"div":j);typeof e.id==A&&(e.id=n);for(a in t)t.hasOwnProperty(a)&&"movie"!==a.toLowerCase()&&d(l,a,t[a]);Y.ie&&(l=c(e.data,l.innerHTML));for(o in e)e.hasOwnProperty(o)&&(s=o.toLowerCase(),"styleclass"===s?l.setAttribute("class",e[o]):"classid"!==s&&"data"!==s&&l.setAttribute(o,e[o]));Y.ie?z[z.length]=e.id:(l.setAttribute("type",I),l.setAttribute("data",e.data)),i.parentNode.replaceChild(l,i),r=l}return r}function d(e,t,n){var r=m("param");r.setAttribute("name",t),r.setAttribute("value",n),e.appendChild(r)}function f(e){var t=y(e);t&&"OBJECT"==t.nodeName.toUpperCase()&&(Y.ie?(t.style.display="none",function e(){if(4==t.readyState){for(var n in t)"function"==typeof t[n]&&(t[n]=null);t.parentNode.removeChild(t)}else setTimeout(e,10)}()):t.parentNode.removeChild(t))}function p(e){return e&&e.nodeType&&1===e.nodeType}function v(e){return p(e)?e.id:e}function y(e){if(p(e))return e;var t=null;try{t=B.getElementById(e)}catch(e){}return t}function m(e){return B.createElement(e)}function b(e){return parseInt(e,10)}function _(e,t,n){e.attachEvent(t,n),V[V.length]=[e,t,n]}function g(e){e+="";var t=Y.pv,n=e.split(".");return n[0]=b(n[0]),n[1]=b(n[1])||0,n[2]=b(n[2])||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]}function w(e,t,n,r){var i=B.getElementsByTagName("head")[0];if(i){var o="string"==typeof n?n:"screen";if(r&&(L=null,S=null),!L||S!=o){var s=m("style");s.setAttribute("type","text/css"),s.setAttribute("media",o),L=i.appendChild(s),Y.ie&&typeof B.styleSheets!=A&&B.styleSheets.length>0&&(L=B.styleSheets[B.styleSheets.length-1]),S=o}L&&(typeof L.addRule!=A?L.addRule(e,t):typeof B.createTextNode!=A&&L.appendChild(B.createTextNode(e+" {"+t+"}")))}}function E(e,t){if(W){var n=t?"visible":"hidden",r=y(e);K&&r?r.style.visibility=n:"string"==typeof e&&w("#"+e,"visibility:"+n)}}function k(e){return null!=/[\\\"<>\.;]/.exec(e)&&typeof encodeURIComponent!=A?encodeURIComponent(e):e}var O,P,T,R,L,S,A="undefined",j="object",x="Shockwave Flash",C="ShockwaveFlash.ShockwaveFlash",I="application/x-shockwave-flash",N="SWFObjectExprInst",M="onreadystatechange",D=window,B=document,F=navigator,H=!1,U=[],q=[],z=[],V=[],K=!1,G=!1,W=!0,X=!1,Y=function(){var e=typeof B.getElementById!=A&&typeof B.getElementsByTagName!=A&&typeof B.createElement!=A,t=F.userAgent.toLowerCase(),n=F.platform.toLowerCase(),r=/win/.test(n?n:t),i=/mac/.test(n?n:t),o=!!/webkit/.test(t)&&parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),s="Microsoft Internet Explorer"===F.appName,a=[0,0,0],l=null;if(typeof F.plugins!=A&&typeof F.plugins[x]==j)(l=F.plugins[x].description)&&typeof F.mimeTypes!=A&&F.mimeTypes[I]&&F.mimeTypes[I].enabledPlugin&&(H=!0,s=!1,l=l.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),a[0]=b(l.replace(/^(.*)\..*$/,"$1")),a[1]=b(l.replace(/^.*\.(.*)\s.*$/,"$1")),a[2]=/[a-zA-Z]/.test(l)?b(l.replace(/^.*[a-zA-Z]+(.*)$/,"$1")):0);else if(typeof D.ActiveXObject!=A)try{var u=new ActiveXObject(C);u&&(l=u.GetVariable("$version"))&&(s=!0,l=l.split(" ")[1].split(","),a=[b(l[0]),b(l[1]),b(l[2])])}catch(e){}return{w3:e,pv:a,wk:o,ie:s,win:r,mac:i}}();return function(){Y.w3&&((typeof B.readyState!=A&&("complete"===B.readyState||"interactive"===B.readyState)||typeof B.readyState==A&&(B.getElementsByTagName("body")[0]||B.body))&&e(),K||(typeof B.addEventListener!=A&&B.addEventListener("DOMContentLoaded",e,!1),Y.ie&&(B.attachEvent(M,function t(){"complete"==B.readyState&&(B.detachEvent(M,t),e())}),D==top&&function t(){if(!K){try{B.documentElement.doScroll("left")}catch(e){return void setTimeout(t,0)}e()}}()),Y.wk&&function t(){K||(/loaded|complete/.test(B.readyState)?e():setTimeout(t,0))}()))}(),U[0]=function(){H?r():i()},function(){Y.ie&&window.attachEvent("onunload",function(){for(var e=V.length,t=0;e>t;t++)V[t][0].detachEvent(V[t][1],V[t][2]);for(var n=z.length,r=0;n>r;r++)f(z[r]);for(var i in Y)Y[i]=null;if(Y=null,"undefined"!=typeof swfobject){for(var o in swfobject)swfobject[o]=null;swfobject=null}})}(),{registerObject:function(e,t,n,r){if(Y.w3&&e&&t){var i={};i.id=e,i.swfVersion=t,i.expressInstall=n,i.callbackFn=r,q[q.length]=i,E(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){return Y.w3?o(e):void 0},embedSWF:function(e,n,r,i,o,l,u,c,d,f){var p=v(n),y={success:!1,id:p};Y.w3&&!(Y.wk&&Y.wk<312)&&e&&n&&r&&i&&o?(E(p,!1),t(function(){r+="",i+="";var t={};if(d&&typeof d===j)for(var v in d)t[v]=d[v];t.data=e,t.width=r,t.height=i;var m={};if(c&&typeof c===j)for(var b in c)m[b]=c[b];if(u&&typeof u===j)for(var _ in u)if(u.hasOwnProperty(_)){var w=X?encodeURIComponent(_):_,k=X?encodeURIComponent(u[_]):u[_];typeof m.flashvars!=A?m.flashvars+="&"+w+"="+k:m.flashvars=w+"="+k}if(g(o)){var O=h(t,m,n);t.id==p&&E(p,!0),y.success=!0,y.ref=O,y.id=O.id}else{if(l&&s())return t.data=l,void a(t,m,n,f);E(p,!0)}f&&f(y)})):f&&f(y)},switchOffAutoHideShow:function(){W=!1},enableUriEncoding:function(e){X=typeof e===A||e},ua:Y,getFlashPlayerVersion:function(){return{major:Y.pv[0],minor:Y.pv[1],release:Y.pv[2]}},hasFlashPlayerVersion:g,createSWF:function(e,t,n){return Y.w3?h(e,t,n):void 0},showExpressInstall:function(e,t,n,r){Y.w3&&s()&&a(e,t,n,r)},removeSWF:function(e){Y.w3&&f(e)},createCSS:function(e,t,n,r){Y.w3&&w(e,t,n,r)},addDomLoadEvent:t,addLoadEvent:n,getQueryParamValue:function(e){var t=B.location.search||B.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return k(t);for(var n=t.split("&"),r=0;r<n.length;r++)if(n[r].substring(0,n[r].indexOf("="))==e)return k(n[r].substring(n[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(G){var e=y(N);e&&O&&(e.parentNode.replaceChild(O,e),P&&(E(P,!0),Y.ie&&(O.style.display="block")),T&&T(R)),G=!1}},version:"2.3"}})},{}],58:[function(e,t){t.exports=function(e,t){var n=void 0!==e.textContent?"textContent":"innerText";return void 0!==t&&(e[n]=t),e[n]}},{}],59:[function(e,t,n){function r(e){return e.replace(/^\s*|\s*$/g,"")}n=t.exports=r,n.left=function(e){return e.replace(/^\s*/,"")},n.right=function(e){return e.replace(/\s*$/,"")}},{}],60:[function(e,t){"use strict";function n(e,t){for(var n=0;n<e.length;n++)t(e[n])}function r(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function i(e,t,n){var r=e;return c(t)?(n=t,"string"==typeof e&&(r={uri:e})):r=d(t,{uri:e}),r.callback=n,r}function o(e,t,n){return t=i(e,t,n),s(t)}function s(e){function t(){4===c.readyState&&setTimeout(s,0)}function n(){var e=void 0;if(e=c.response?c.response:c.responseText||a(c),g)try{e=JSON.parse(e)}catch(e){}return e}function i(e){return clearTimeout(p),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,u(e,w)}function s(){if(!f){var t;clearTimeout(p),t=e.useXDR&&void 0===c.status?200:1223===c.status?204:c.status;var r=w,i=null;return 0!==t?(r={body:n(),statusCode:t,method:y,headers:{},url:v,rawRequest:c},c.getAllResponseHeaders&&(r.headers=h(c.getAllResponseHeaders()))):i=new Error("Internal XMLHttpRequest Error"),u(i,r,r.body)}}if(void 0===e.callback)throw new Error("callback argument missing");var l=!1,u=function(t,n,r){l||(l=!0,e.callback(t,n,r))},c=e.xhr||null;c||(c=e.cors||e.useXDR?new o.XDomainRequest:new o.XMLHttpRequest);var d,f,p,v=c.url=e.uri||e.url,y=c.method=e.method||"GET",m=e.body||e.data,b=c.headers=e.headers||{},_=!!e.sync,g=!1,w={body:void 0,headers:{},statusCode:0,method:y,url:v,rawRequest:c};if("json"in e&&e.json!==!1&&(g=!0,b.accept||b.Accept||(b.Accept="application/json"),"GET"!==y&&"HEAD"!==y&&(b["content-type"]||b["Content-Type"]||(b["Content-Type"]="application/json"),m=JSON.stringify(e.json===!0?m:e.json))),c.onreadystatechange=t,c.onload=s,c.onerror=i,c.onprogress=function(){},c.onabort=function(){f=!0},c.ontimeout=i,c.open(y,v,!_,e.username,e.password),_||(c.withCredentials=!!e.withCredentials),!_&&e.timeout>0&&(p=setTimeout(function(){if(!f){f=!0,c.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",i(e)}},e.timeout)),c.setRequestHeader)for(d in b)b.hasOwnProperty(d)&&c.setRequestHeader(d,b[d]);else if(e.headers&&!r(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(c.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(c),c.send(m||null),c}function a(e){if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;return""!==e.responseType||t?null:e.responseXML}function l(){}var u=e("global/window"),c=e("is-function"),h=e("parse-headers"),d=e("xtend");t.exports=o,o.XMLHttpRequest=u.XMLHttpRequest||l,o.XDomainRequest="withCredentials"in new o.XMLHttpRequest?o.XMLHttpRequest:u.XDomainRequest,n(["get","put","post","patch","head","delete"],function(e){o["delete"===e?"del":e]=function(t,n,r){return n=i(t,n,r),n.method=e.toUpperCase(),s(n)}})},{"global/window":52,"is-function":53,"parse-headers":56,xtend:61}],61:[function(e,t){function n(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var i in n)r.call(n,i)&&(e[i]=n[i])}return e}t.exports=n;var r=Object.prototype.hasOwnProperty},{}],62:[function(e,t){"use strict";t.exports="undefined"==typeof window?function(){}:e("./stock-live-player").default},{"./stock-live-player":63}],63:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){"function"!=typeof t&&null!==t||(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t))}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("events"),u=r(l),c=e("@livelyvideo/player-core/lib/player"),h=r(c),d=e("@livelyvideo/player-media-source-mp4-driver/lib/driver"),f=r(d),p=e("@livelyvideo/player-hlsjs-driver/lib/driver"),v=r(p),y=e("@livelyvideo/player-native-hls-driver/lib/driver"),m=r(y),b=e("@livelyvideo/player-flash-rtmp-driver/lib/driver"),_=r(b),g=e("@livelyvideo/player-controls/lib/index"),w=r(g),E=function(e){function t(e,n,r,s){i(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));a.el=e,a.playerEl=document.createElement("div"),a.controlsEl=document.createElement("div"),a.el.appendChild(a.playerEl),a.el.appendChild(a.controlsEl),r=r||{},s=s||{};var l=[];if(r.drivers)for(var u=0;u<r.drivers.length;u++)switch(r.drivers[u]){case"hlsjs":l.push(v.default);break;case"hls":l.push(m.default);break;case"mediaSourceMp4":l.push(f.default);break;case"flashRtmp":l.push(_.default)}else l=[f.default,v.default,m.default,_.default];return s.messages=s.messages||{},r.drivers=l,a.player=new h.default(a.playerEl,n,r),a.controls=new w.default(a.controlsEl,s),a.controls.attach(a.player),a}return s(t,e),a(t,[{key:"destroy",value:function(){this.playerEl.remove(),this.controlsEl.remove(),this.controls.destroy(),this.player.destroy()}}]),t}(u.default);n.default=E},{"@livelyvideo/player-controls/lib/index":6,"@livelyvideo/player-core/lib/player":26,"@livelyvideo/player-flash-rtmp-driver/lib/driver":38,"@livelyvideo/player-hlsjs-driver/lib/driver":42,"@livelyvideo/player-media-source-mp4-driver/lib/driver":45,"@livelyvideo/player-native-hls-driver/lib/driver":48,events:50}]},{},[62])(62)})}).call(t,n(3))},function(e,t){!function(e){"use strict";function t(e){if("string"!=typeof e&&(e=String(e)),!/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))return e.toLowerCase()}function n(e){return"string"!=typeof e&&(e=String(e)),e}function r(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return m.iterable&&(t[Symbol.iterator]=function(){return t}),t}function i(e){this.map={},e instanceof i?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function o(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function s(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function a(e){var t=new FileReader,n=s(t);return t.readAsArrayBuffer(e),n}function l(e){var t=new FileReader,n=s(t);return t.readAsText(e),n}function u(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}function c(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function h(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(m.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(m.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(m.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(m.arrayBuffer&&m.blob&&_(e))this._bodyArrayBuffer=c(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!m.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!g(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=c(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):m.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},m.blob&&(this.blob=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?o(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(a)}),this.text=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return l(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(u(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},m.formData&&(this.formData=function(){return this.text().then(p)}),this.json=function(){return this.text().then(JSON.parse)},this}function d(e){var t=e.toUpperCase();return w.indexOf(t)>-1?t:e}function f(e,t){t=t||{};var n=t.body;if(e instanceof f){if(e.bodyUsed)return;this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new i(e.headers)),this.method=e.method,this.mode=e.mode,n||null==e._bodyInit||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new i(t.headers)),this.method=d(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"!==this.method&&"HEAD"!==this.method||!n)&&this._initBody(n)}function p(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(i))}}),t}function v(e){var t=new i;return e.split(/\r?\n/).forEach(function(e){var n=e.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();t.append(r,i)}}),t}function y(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new i(t.headers),this.url=t.url||"",this._initBody(e)}if(!e.fetch){var m={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(m.arrayBuffer)var b=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],_=function(e){return e&&DataView.prototype.isPrototypeOf(e)},g=ArrayBuffer.isView||function(e){return e&&b.indexOf(Object.prototype.toString.call(e))>-1};i.prototype.append=function(e,r){e=t(e),r=n(r);var i=this.map[e];this.map[e]=i?i+","+r:r},i.prototype.delete=function(e){delete this.map[t(e)]},i.prototype.get=function(e){return e=t(e),this.has(e)?this.map[e]:null},i.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},i.prototype.set=function(e,r){this.map[t(e)]=n(r)},i.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},i.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),r(e)},i.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),r(e)},i.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),r(e)},m.iterable&&(i.prototype[Symbol.iterator]=i.prototype.entries);var w=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];f.prototype.clone=function(){return new f(this,{body:this._bodyInit})},h.call(f.prototype),h.call(y.prototype),y.prototype.clone=function(){return new y(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new i(this.headers),url:this.url})},y.error=function(){var e=new y(null,{status:0,statusText:""});return e.type="error",e};var E=[301,302,303,307,308];y.redirect=function(e,t){if(E.indexOf(t)!==-1)return new y(null,{status:t,headers:{location:e}})},e.Headers=i,e.Request=f,e.Response=y,e.fetch=function(e,t){return new Promise(function(n,r){var i=new f(e,t),o=new XMLHttpRequest;o.onload=function(){var e={status:o.status,statusText:o.statusText,headers:v(o.getAllResponseHeaders()||"")};e.url="responseURL"in o?o.responseURL:e.headers.get("X-Request-URL"),n(new y("response"in o?o.response:o.responseText,e))},o.onerror=function(){r(new TypeError("Network request failed"))},o.ontimeout=function(){r(new TypeError("Network request failed"))},o.open(i.method,i.url,!0),"include"===i.credentials&&(o.withCredentials=!0),"responseType"in o&&m.blob&&(o.responseType="blob"),i.headers.forEach(function(e,t){o.setRequestHeader(t,e)}),o.send(void 0===i._bodyInit?null:i._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:this)},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){f&&f.destroy(),f=new h.default(document.getElementById("chat"),{user:"foobar",room:e,apiHost:"https://"+d+".livelyvideo.tv",websocketHost:"ws://ws-"+d+".livelyvideo.tv",authUrl:"/access-token"})}function s(e){var t;p&&p.destroy(),p=new u.default(document.getElementById("video"),e,{drivers:["mediaSourceMp4","hlsjs","hls","flashRtmp"],hlsjsPath:"/libs/hlsjs/hls.min.js",tfSwfPath:"/libs/thinflash/thin.swf"},{messages:(t={"Full Screen":"Full Screen","Stream is currently offline":"Stream is currently offline",Play:"Play",Pause:"Pause","Toggle play/pause":"Toggle play/pause"},i(t,"Pause","Pause"),i(t,"Popout","Popout"),i(t,"Quality Selector","Quality Selector"),i(t,"Auto","Auto"),i(t,"Mute","Mute"),i(t,"Unmute","Unmute"),t)}),p.player.on("error",function(e){switch(e){case"http-server-unauthorized":case"http-server-forbidden":}})}function a(){fetch("/random-stream").then(function(e){return e.status>399?void console.error("unexpected response status code",{code:e.status}):e.json()}).then(function(e){o(e.userId),s(e.manifest)}).catch(function(e){console.error("fetch failed to load random stream",{err:e})})}n(2);var l=n(1),u=r(l),c=n(0),h=r(c),d="sandbox",f=void 0,p=void 0;a()}]);
//# sourceMappingURL=app.js.map